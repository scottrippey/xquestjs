this.createjs=this.createjs||{},function(){var a=function(){throw"UID cannot be instantiated"};a._nextID=0,a.get=function(){return a._nextID++},createjs.UID=a}(),this.createjs=this.createjs||{},function(){var a=function(){this.initialize()},b=a.prototype;a.initialize=function(a){a.addEventListener=b.addEventListener,a.removeEventListener=b.removeEventListener,a.removeAllEventListeners=b.removeAllEventListeners,a.hasEventListener=b.hasEventListener,a.dispatchEvent=b.dispatchEvent},b._listeners=null,b.initialize=function(){},b.addEventListener=function(a,b){var c=this._listeners;c?this.removeEventListener(a,b):c=this._listeners={};var d=c[a];return d||(d=c[a]=[]),d.push(b),b},b.removeEventListener=function(a,b){var c=this._listeners;if(c){var d=c[a];if(d)for(var e=0,f=d.length;f>e;e++)if(d[e]==b){1==f?delete c[a]:d.splice(e,1);break}}},b.removeAllEventListeners=function(a){a?this._listeners&&delete this._listeners[a]:this._listeners=null},b.dispatchEvent=function(a,b){var c=!1,d=this._listeners;if(a&&d){if("string"==typeof a&&(a={type:a}),d=d[a.type],!d)return c;a.target=b||this;for(var d=d.slice(),e=0,f=d.length;f>e;e++)var g=d[e],c=g.handleEvent?c||g.handleEvent(a):c||g(a)}return!!c},b.hasEventListener=function(a){var b=this._listeners;return!(!b||!b[a])},b.toString=function(){return"[EventDispatcher]"},createjs.EventDispatcher=a}(),this.createjs=this.createjs||{},function(){var a=function(){throw"Ticker cannot be instantiated."};a.useRAF=!1,a.addEventListener=null,a.removeEventListener=null,a.removeAllEventListeners=null,a.dispatchEvent=null,a.hasEventListener=null,a._listeners=null,createjs.EventDispatcher.initialize(a),a._listeners=null,a._pauseable=null,a._paused=!1,a._inited=!1,a._startTime=0,a._pausedTime=0,a._ticks=0,a._pausedTicks=0,a._interval=50,a._lastTime=0,a._times=null,a._tickTimes=null,a._rafActive=!1,a._timeoutID=null,a.addListener=function(b,c){null!=b&&(a.removeListener(b),a._pauseable[a._listeners.length]=null==c?!0:c,a._listeners.push(b))},a.init=function(){a._inited=!0,a._times=[],a._tickTimes=[],a._pauseable=[],a._listeners=[],a._times.push(a._lastTime=a._startTime=a._getTime()),a.setInterval(a._interval)},a.removeListener=function(b){var c=a._listeners;c&&(b=c.indexOf(b),-1!=b&&(c.splice(b,1),a._pauseable.splice(b,1)))},a.removeAllListeners=function(){a._listeners=[],a._pauseable=[]},a.setInterval=function(b){a._interval=b,a._inited&&a._setupTick()},a.getInterval=function(){return a._interval},a.setFPS=function(b){a.setInterval(1e3/b)},a.getFPS=function(){return 1e3/a._interval},a.getMeasuredTickTime=function(b){var c=0,d=a._tickTimes;if(d.length<1)return-1;b=Math.min(d.length,b||0|a.getFPS());for(var e=0;b>e;e++)c+=d[e];return c/b},a.getMeasuredFPS=function(b){return 2>a._times.length?-1:(null==b&&(b=0|a.getFPS()),b=Math.min(a._times.length-1,b),1e3/((a._times[0]-a._times[b])/b))},a.setPaused=function(b){a._paused=b},a.getPaused=function(){return a._paused},a.getTime=function(b){return a._getTime()-a._startTime-(b?a._pausedTime:0)},a.getTicks=function(b){return a._ticks-(b?a._pausedTicks:0)},a._handleAF=function(){a._rafActive=!1,a._setupTick(),a._getTime()-a._lastTime>=.97*(a._interval-1)&&a._tick()},a._handleTimeout=function(){a.timeoutID=null,a._setupTick(),a._tick()},a._setupTick=function(){if(!a._rafActive&&null==a.timeoutID){if(a.useRAF){var b=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(b)return b(a._handleAF),void(a._rafActive=!0)}a.timeoutID=setTimeout(a._handleTimeout,a._interval)}},a._tick=function(){var b=a._getTime();a._ticks++;var c=b-a._lastTime,d=a._paused;d&&(a._pausedTicks++,a._pausedTime+=c),a._lastTime=b;for(var e=a._pauseable,f=a._listeners.slice(),g=f?f.length:0,h=0;g>h;h++){var i=f[h];null==i||d&&e[h]||(i.tick?i.tick(c,d):i instanceof Function&&i(c,d))}for(a.dispatchEvent({type:"tick",paused:d,delta:c,time:b,runTime:b-a._pausedTime}),a._tickTimes.unshift(a._getTime()-b);100<a._tickTimes.length;)a._tickTimes.pop();for(a._times.unshift(b);100<a._times.length;)a._times.pop()};var b=window.performance&&(performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow);a._getTime=function(){return b&&b.call(performance)||(new Date).getTime()},a.init(),createjs.Ticker=a}(),this.createjs=this.createjs||{},function(){var a=function(a,b,c,d,e,f,g,h,i){this.initialize(a,b,c,d,e,f,g,h,i)},b=a.prototype;b.stageX=0,b.stageY=0,b.rawX=0,b.rawY=0,b.type=null,b.nativeEvent=null,b.onMouseMove=null,b.onMouseUp=null,b.target=null,b.pointerID=0,b.primary=!1,b.addEventListener=null,b.removeEventListener=null,b.removeAllEventListeners=null,b.dispatchEvent=null,b.hasEventListener=null,b._listeners=null,createjs.EventDispatcher.initialize(b),b.initialize=function(a,b,c,d,e,f,g,h,i){this.type=a,this.stageX=b,this.stageY=c,this.target=d,this.nativeEvent=e,this.pointerID=f,this.primary=g,this.rawX=null==h?b:h,this.rawY=null==i?c:i},b.clone=function(){return new a(this.type,this.stageX,this.stageY,this.target,this.nativeEvent,this.pointerID,this.primary,this.rawX,this.rawY)},b.toString=function(){return"[MouseEvent (type="+this.type+" stageX="+this.stageX+" stageY="+this.stageY+")]"},createjs.MouseEvent=a}(),this.createjs=this.createjs||{},function(){var a=function(a,b,c,d,e,f){this.initialize(a,b,c,d,e,f)},b=a.prototype;a.identity=null,a.DEG_TO_RAD=Math.PI/180,b.a=1,b.b=0,b.c=0,b.d=1,b.tx=0,b.ty=0,b.alpha=1,b.shadow=null,b.compositeOperation=null,b.initialize=function(a,b,c,d,e,f){return null!=a&&(this.a=a),this.b=b||0,this.c=c||0,null!=d&&(this.d=d),this.tx=e||0,this.ty=f||0,this},b.prepend=function(a,b,c,d,e,f){var g=this.tx;if(1!=a||0!=b||0!=c||1!=d){var h=this.a,i=this.c;this.a=h*a+this.b*c,this.b=h*b+this.b*d,this.c=i*a+this.d*c,this.d=i*b+this.d*d}return this.tx=g*a+this.ty*c+e,this.ty=g*b+this.ty*d+f,this},b.append=function(a,b,c,d,e,f){var g=this.a,h=this.b,i=this.c,j=this.d;return this.a=a*g+b*i,this.b=a*h+b*j,this.c=c*g+d*i,this.d=c*h+d*j,this.tx=e*g+f*i+this.tx,this.ty=e*h+f*j+this.ty,this},b.prependMatrix=function(a){return this.prepend(a.a,a.b,a.c,a.d,a.tx,a.ty),this.prependProperties(a.alpha,a.shadow,a.compositeOperation),this},b.appendMatrix=function(a){return this.append(a.a,a.b,a.c,a.d,a.tx,a.ty),this.appendProperties(a.alpha,a.shadow,a.compositeOperation),this},b.prependTransform=function(b,c,d,e,f,g,h,i,j){if(f%360){var k=f*a.DEG_TO_RAD;f=Math.cos(k),k=Math.sin(k)}else f=1,k=0;return(i||j)&&(this.tx-=i,this.ty-=j),g||h?(g*=a.DEG_TO_RAD,h*=a.DEG_TO_RAD,this.prepend(f*d,k*d,-k*e,f*e,0,0),this.prepend(Math.cos(h),Math.sin(h),-Math.sin(g),Math.cos(g),b,c)):this.prepend(f*d,k*d,-k*e,f*e,b,c),this},b.appendTransform=function(b,c,d,e,f,g,h,i,j){if(f%360){var k=f*a.DEG_TO_RAD;f=Math.cos(k),k=Math.sin(k)}else f=1,k=0;return g||h?(g*=a.DEG_TO_RAD,h*=a.DEG_TO_RAD,this.append(Math.cos(h),Math.sin(h),-Math.sin(g),Math.cos(g),b,c),this.append(f*d,k*d,-k*e,f*e,0,0)):this.append(f*d,k*d,-k*e,f*e,b,c),(i||j)&&(this.tx-=i*this.a+j*this.c,this.ty-=i*this.b+j*this.d),this},b.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);var c=this.a,d=this.c,e=this.tx;return this.a=c*b-this.b*a,this.b=c*a+this.b*b,this.c=d*b-this.d*a,this.d=d*a+this.d*b,this.tx=e*b-this.ty*a,this.ty=e*a+this.ty*b,this},b.skew=function(b,c){return b*=a.DEG_TO_RAD,c*=a.DEG_TO_RAD,this.append(Math.cos(c),Math.sin(c),-Math.sin(b),Math.cos(b),0,0),this},b.scale=function(a,b){return this.a*=a,this.d*=b,this.c*=a,this.b*=b,this.tx*=a,this.ty*=b,this},b.translate=function(a,b){return this.tx+=a,this.ty+=b,this},b.identity=function(){return this.alpha=this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.shadow=this.compositeOperation=null,this},b.invert=function(){var a=this.a,b=this.b,c=this.c,d=this.d,e=this.tx,f=a*d-b*c;return this.a=d/f,this.b=-b/f,this.c=-c/f,this.d=a/f,this.tx=(c*this.ty-d*e)/f,this.ty=-(a*this.ty-b*e)/f,this},b.isIdentity=function(){return 0==this.tx&&0==this.ty&&1==this.a&&0==this.b&&0==this.c&&1==this.d},b.decompose=function(b){null==b&&(b={}),b.x=this.tx,b.y=this.ty,b.scaleX=Math.sqrt(this.a*this.a+this.b*this.b),b.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var c=Math.atan2(-this.c,this.d),d=Math.atan2(this.b,this.a);return c==d?(b.rotation=d/a.DEG_TO_RAD,0>this.a&&0<=this.d&&(b.rotation+=0>=b.rotation?180:-180),b.skewX=b.skewY=0):(b.skewX=c/a.DEG_TO_RAD,b.skewY=d/a.DEG_TO_RAD),b},b.reinitialize=function(a,b,c,d,e,f,g,h,i){return this.initialize(a,b,c,d,e,f),this.alpha=g||1,this.shadow=h,this.compositeOperation=i,this},b.appendProperties=function(a,b,c){return this.alpha*=a,this.shadow=b||this.shadow,this.compositeOperation=c||this.compositeOperation,this},b.prependProperties=function(a,b,c){return this.alpha*=a,this.shadow=this.shadow||b,this.compositeOperation=this.compositeOperation||c,this},b.clone=function(){var b=new a(this.a,this.b,this.c,this.d,this.tx,this.ty);return b.shadow=this.shadow,b.alpha=this.alpha,b.compositeOperation=this.compositeOperation,b},b.toString=function(){return"[Matrix2D (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"},a.identity=new a(1,0,0,1,0,0),createjs.Matrix2D=a}(),this.createjs=this.createjs||{},function(){var a=function(a,b){this.initialize(a,b)},b=a.prototype;b.x=0,b.y=0,b.initialize=function(a,b){this.x=null==a?0:a,this.y=null==b?0:b},b.clone=function(){return new a(this.x,this.y)},b.toString=function(){return"[Point (x="+this.x+" y="+this.y+")]"},createjs.Point=a}(),this.createjs=this.createjs||{},function(){var a=function(a,b,c,d){this.initialize(a,b,c,d)},b=a.prototype;b.x=0,b.y=0,b.width=0,b.height=0,b.initialize=function(a,b,c,d){this.x=null==a?0:a,this.y=null==b?0:b,this.width=null==c?0:c,this.height=null==d?0:d},b.clone=function(){return new a(this.x,this.y,this.width,this.height)},b.toString=function(){return"[Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")]"},createjs.Rectangle=a}(),this.createjs=this.createjs||{},function(){var a=function(a,b,c,d,e,f,g){this.initialize(a,b,c,d,e,f,g)},b=a.prototype;b.target=null,b.overLabel=null,b.outLabel=null,b.downLabel=null,b.play=!1,b._isPressed=!1,b._isOver=!1,b.initialize=function(a,b,c,d,e,f,g){a.addEventListener&&(this.target=a,a.cursor="pointer",this.overLabel=null==c?"over":c,this.outLabel=null==b?"out":b,this.downLabel=null==d?"down":d,this.play=e,this.setEnabled(!0),this.handleEvent({}),f&&(g&&(f.actionsEnabled=!1,f.gotoAndStop&&f.gotoAndStop(g)),a.hitArea=f))},b.setEnabled=function(a){var b=this.target;a?(b.addEventListener("mouseover",this),b.addEventListener("mouseout",this),b.addEventListener("mousedown",this)):(b.removeEventListener("mouseover",this),b.removeEventListener("mouseout",this),b.removeEventListener("mousedown",this))},b.toString=function(){return"[ButtonHelper]"},b.handleEvent=function(a){var b=this.target,c=a.type;"mousedown"==c?(a.addEventListener("mouseup",this),this._isPressed=!0,a=this.downLabel):"mouseup"==c?(this._isPressed=!1,a=this._isOver?this.overLabel:this.outLabel):"mouseover"==c?(this._isOver=!0,a=this._isPressed?this.downLabel:this.overLabel):(this._isOver=!1,a=this._isPressed?this.overLabel:this.outLabel),this.play?b.gotoAndPlay&&b.gotoAndPlay(a):b.gotoAndStop&&b.gotoAndStop(a)},createjs.ButtonHelper=a}(),this.createjs=this.createjs||{},function(){var a=function(a,b,c,d){this.initialize(a,b,c,d)},b=a.prototype;a.identity=null,b.color=null,b.offsetX=0,b.offsetY=0,b.blur=0,b.initialize=function(a,b,c,d){this.color=a,this.offsetX=b,this.offsetY=c,this.blur=d},b.toString=function(){return"[Shadow]"},b.clone=function(){return new a(this.color,this.offsetX,this.offsetY,this.blur)},a.identity=new a("transparent",0,0,0),createjs.Shadow=a}(),this.createjs=this.createjs||{},function(){var a=function(a){this.initialize(a)},b=a.prototype;b.complete=!0,b.onComplete=null,b.addEventListener=null,b.removeEventListener=null,b.removeAllEventListeners=null,b.dispatchEvent=null,b.hasEventListener=null,b._listeners=null,createjs.EventDispatcher.initialize(b),b._animations=null,b._frames=null,b._images=null,b._data=null,b._loadCount=0,b._frameHeight=0,b._frameWidth=0,b._numFrames=0,b._regX=0,b._regY=0,b.initialize=function(a){var b,c,d;if(null!=a){if(a.images&&0<(c=a.images.length))for(d=this._images=[],b=0;c>b;b++){var e=a.images[b];if("string"==typeof e){var f=e,e=new Image;e.src=f}d.push(e),!e.getContext&&!e.complete&&(this._loadCount++,this.complete=!1,function(a){e.onload=function(){a._handleImageLoad()}}(this))}if(null!=a.frames)if(a.frames instanceof Array)for(this._frames=[],d=a.frames,b=0,c=d.length;c>b;b++)f=d[b],this._frames.push({image:this._images[f[4]?f[4]:0],rect:new createjs.Rectangle(f[0],f[1],f[2],f[3]),regX:f[5]||0,regY:f[6]||0});else c=a.frames,this._frameWidth=c.width,this._frameHeight=c.height,this._regX=c.regX||0,this._regY=c.regY||0,this._numFrames=c.count,0==this._loadCount&&this._calculateFrames();if(null!=(c=a.animations)){this._animations=[],this._data={};for(var g in c){if(a={name:g},f=c[g],"number"==typeof f)d=a.frames=[f];else if(f instanceof Array)if(1==f.length)a.frames=[f[0]];else for(a.frequency=f[3],a.next=f[2],d=a.frames=[],b=f[0];b<=f[1];b++)d.push(b);else a.frequency=f.frequency,a.next=f.next,b=f.frames,d=a.frames="number"==typeof b?[b]:b.slice(0);a.next=2>d.length||0==a.next?null:null==a.next||1==a.next?g:a.next,a.frequency||(a.frequency=1),this._animations.push(g),this._data[g]=a}}}},b.getNumFrames=function(a){return null==a?this._frames?this._frames.length:this._numFrames:(a=this._data[a],null==a?0:a.frames.length)},b.getAnimations=function(){return this._animations.slice(0)},b.getAnimation=function(a){return this._data[a]},b.getFrame=function(a){var b;return this.complete&&this._frames&&(b=this._frames[a])?b:null},b.getFrameBounds=function(a){return(a=this.getFrame(a))?new createjs.Rectangle(-a.regX,-a.regY,a.rect.width,a.rect.height):null},b.toString=function(){return"[SpriteSheet]"},b.clone=function(){var b=new a;return b.complete=this.complete,b._animations=this._animations,b._frames=this._frames,b._images=this._images,b._data=this._data,b._frameHeight=this._frameHeight,b._frameWidth=this._frameWidth,b._numFrames=this._numFrames,b._loadCount=this._loadCount,b},b._handleImageLoad=function(){0==--this._loadCount&&(this._calculateFrames(),this.complete=!0,this.onComplete&&this.onComplete(),this.dispatchEvent("complete"))},b._calculateFrames=function(){if(!this._frames&&0!=this._frameWidth){this._frames=[];for(var a=0,b=this._frameWidth,c=this._frameHeight,d=0,e=this._images;d<e.length;d++){for(var f=e[d],g=(f.width+1)/b|0,h=(f.height+1)/c|0,h=0<this._numFrames?Math.min(this._numFrames-a,g*h):g*h,i=0;h>i;i++)this._frames.push({image:f,rect:new createjs.Rectangle(i%g*b,(i/g|0)*c,b,c),regX:this._regX,regY:this._regY});a+=h}this._numFrames=a}},createjs.SpriteSheet=a}(),this.createjs=this.createjs||{},function(){function a(a,b,c){this.f=a,this.params=b,this.path=null==c?!0:c}a.prototype.exec=function(a){this.f.apply(a,this.params)};var b=function(){this.initialize()},c=b.prototype;b.getRGB=function(a,b,c,d){return null!=a&&null==c&&(d=b,c=255&a,b=a>>8&255,a=a>>16&255),null==d?"rgb("+a+","+b+","+c+")":"rgba("+a+","+b+","+c+","+d+")"},b.getHSL=function(a,b,c,d){return null==d?"hsl("+a%360+","+b+"%,"+c+"%)":"hsla("+a%360+","+b+"%,"+c+"%,"+d+")"},b.BASE_64={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,"+":62,"/":63},b.STROKE_CAPS_MAP=["butt","round","square"],b.STROKE_JOINTS_MAP=["miter","round","bevel"],b._ctx=(createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")).getContext("2d"),b.beginCmd=new a(b._ctx.beginPath,[],!1),b.fillCmd=new a(b._ctx.fill,[],!1),b.strokeCmd=new a(b._ctx.stroke,[],!1),c._strokeInstructions=null,c._strokeStyleInstructions=null,c._ignoreScaleStroke=!1,c._fillInstructions=null,c._instructions=null,c._oldInstructions=null,c._activeInstructions=null,c._active=!1,c._dirty=!1,c.initialize=function(){this.clear(),this._ctx=b._ctx},c.isEmpty=function(){return!(this._instructions.length||this._oldInstructions.length||this._activeInstructions.length)},c.draw=function(a){this._dirty&&this._updateInstructions();for(var b=this._instructions,c=0,d=b.length;d>c;c++)b[c].exec(a)},c.drawAsPath=function(a){this._dirty&&this._updateInstructions();for(var b,c=this._instructions,d=0,e=c.length;e>d;d++)((b=c[d]).path||0==d)&&b.exec(a)},c.moveTo=function(b,c){return this._activeInstructions.push(new a(this._ctx.moveTo,[b,c])),this},c.lineTo=function(b,c){return this._dirty=this._active=!0,this._activeInstructions.push(new a(this._ctx.lineTo,[b,c])),this},c.arcTo=function(b,c,d,e,f){return this._dirty=this._active=!0,this._activeInstructions.push(new a(this._ctx.arcTo,[b,c,d,e,f])),this},c.arc=function(b,c,d,e,f,g){return this._dirty=this._active=!0,null==g&&(g=!1),this._activeInstructions.push(new a(this._ctx.arc,[b,c,d,e,f,g])),this},c.quadraticCurveTo=function(b,c,d,e){return this._dirty=this._active=!0,this._activeInstructions.push(new a(this._ctx.quadraticCurveTo,[b,c,d,e])),this},c.bezierCurveTo=function(b,c,d,e,f,g){return this._dirty=this._active=!0,this._activeInstructions.push(new a(this._ctx.bezierCurveTo,[b,c,d,e,f,g])),this},c.rect=function(b,c,d,e){return this._dirty=this._active=!0,this._activeInstructions.push(new a(this._ctx.rect,[b,c,d,e])),this},c.closePath=function(){return this._active&&(this._dirty=!0,this._activeInstructions.push(new a(this._ctx.closePath,[]))),this},c.clear=function(){return this._instructions=[],this._oldInstructions=[],this._activeInstructions=[],this._strokeStyleInstructions=this._strokeInstructions=this._fillInstructions=null,this._active=this._dirty=!1,this},c.beginFill=function(c){return this._active&&this._newPath(),this._fillInstructions=c?[new a(this._setProp,["fillStyle",c],!1),b.fillCmd]:null,this},c.beginLinearGradientFill=function(c,d,e,f,g,h){for(this._active&&this._newPath(),e=this._ctx.createLinearGradient(e,f,g,h),f=0,g=c.length;g>f;f++)e.addColorStop(d[f],c[f]);return this._fillInstructions=[new a(this._setProp,["fillStyle",e],!1),b.fillCmd],this},c.beginRadialGradientFill=function(c,d,e,f,g,h,i,j){for(this._active&&this._newPath(),e=this._ctx.createRadialGradient(e,f,g,h,i,j),f=0,g=c.length;g>f;f++)e.addColorStop(d[f],c[f]);return this._fillInstructions=[new a(this._setProp,["fillStyle",e],!1),b.fillCmd],this},c.beginBitmapFill=function(c,d,e){return this._active&&this._newPath(),c=this._ctx.createPattern(c,d||""),c=new a(this._setProp,["fillStyle",c],!1),this._fillInstructions=e?[c,new a(this._ctx.save,[],!1),new a(this._ctx.transform,[e.a,e.b,e.c,e.d,e.tx,e.ty],!1),b.fillCmd,new a(this._ctx.restore,[],!1)]:[c,b.fillCmd],this},c.endFill=function(){return this.beginFill()},c.setStrokeStyle=function(c,d,e,f,g){return this._active&&this._newPath(),this._strokeStyleInstructions=[new a(this._setProp,["lineWidth",null==c?"1":c],!1),new a(this._setProp,["lineCap",null==d?"butt":isNaN(d)?d:b.STROKE_CAPS_MAP[d]],!1),new a(this._setProp,["lineJoin",null==e?"miter":isNaN(e)?e:b.STROKE_JOINTS_MAP[e]],!1),new a(this._setProp,["miterLimit",null==f?"10":f],!1)],this._ignoreScaleStroke=g,this},c.beginStroke=function(b){return this._active&&this._newPath(),this._strokeInstructions=b?[new a(this._setProp,["strokeStyle",b],!1)]:null,this},c.beginLinearGradientStroke=function(b,c,d,e,f,g){for(this._active&&this._newPath(),d=this._ctx.createLinearGradient(d,e,f,g),e=0,f=b.length;f>e;e++)d.addColorStop(c[e],b[e]);return this._strokeInstructions=[new a(this._setProp,["strokeStyle",d],!1)],this},c.beginRadialGradientStroke=function(b,c,d,e,f,g,h,i){for(this._active&&this._newPath(),d=this._ctx.createRadialGradient(d,e,f,g,h,i),e=0,f=b.length;f>e;e++)d.addColorStop(c[e],b[e]);return this._strokeInstructions=[new a(this._setProp,["strokeStyle",d],!1)],this},c.beginBitmapStroke=function(b,c){this._active&&this._newPath();var d=this._ctx.createPattern(b,c||"");return this._strokeInstructions=[new a(this._setProp,["strokeStyle",d],!1)],this},c.endStroke=function(){return this.beginStroke(),this},c.curveTo=c.quadraticCurveTo,c.drawRect=c.rect,c.drawRoundRect=function(a,b,c,d,e){return this.drawRoundRectComplex(a,b,c,d,e,e,e,e),this},c.drawRoundRectComplex=function(b,c,d,e,f,g,h,i){var j=(e>d?d:e)/2,k=0,l=0,m=0,n=0;0>f&&(f*=k=-1),f>j&&(f=j),0>g&&(g*=l=-1),g>j&&(g=j),0>h&&(h*=m=-1),h>j&&(h=j),0>i&&(i*=n=-1),i>j&&(i=j),this._dirty=this._active=!0;var j=this._ctx.arcTo,o=this._ctx.lineTo;return this._activeInstructions.push(new a(this._ctx.moveTo,[b+d-g,c]),new a(j,[b+d+g*l,c-g*l,b+d,c+g,g]),new a(o,[b+d,c+e-h]),new a(j,[b+d+h*m,c+e+h*m,b+d-h,c+e,h]),new a(o,[b+i,c+e]),new a(j,[b-i*n,c+e+i*n,b,c+e-i,i]),new a(o,[b,c+f]),new a(j,[b-f*k,c-f*k,b+f,c,f]),new a(this._ctx.closePath)),this},c.drawCircle=function(a,b,c){return this.arc(a,b,c,0,2*Math.PI),this},c.drawEllipse=function(b,c,d,e){this._dirty=this._active=!0;var f=.5522848*(d/2),g=.5522848*(e/2),h=b+d,i=c+e;return d=b+d/2,e=c+e/2,this._activeInstructions.push(new a(this._ctx.moveTo,[b,e]),new a(this._ctx.bezierCurveTo,[b,e-g,d-f,c,d,c]),new a(this._ctx.bezierCurveTo,[d+f,c,h,e-g,h,e]),new a(this._ctx.bezierCurveTo,[h,e+g,d+f,i,d,i]),new a(this._ctx.bezierCurveTo,[d-f,i,b,e+g,b,e])),this},c.drawPolyStar=function(b,c,d,e,f,g){this._dirty=this._active=!0,null==f&&(f=0),f=1-f,g=null==g?0:g/(180/Math.PI);var h=Math.PI/e;this._activeInstructions.push(new a(this._ctx.moveTo,[b+Math.cos(g)*d,c+Math.sin(g)*d]));for(var i=0;e>i;i++)g+=h,1!=f&&this._activeInstructions.push(new a(this._ctx.lineTo,[b+Math.cos(g)*d*f,c+Math.sin(g)*d*f])),g+=h,this._activeInstructions.push(new a(this._ctx.lineTo,[b+Math.cos(g)*d,c+Math.sin(g)*d]));return this},c.decodePath=function(a){for(var c=[this.moveTo,this.lineTo,this.quadraticCurveTo,this.bezierCurveTo,this.closePath],d=[2,2,4,6,0],e=0,f=a.length,g=[],h=0,i=0,j=b.BASE_64;f>e;){var k=a.charAt(e),l=j[k],m=l>>3,n=c[m];if(!n||3&l)throw"bad path data (@"+e+"): "+k;for(k=d[m],m||(h=i=0),g.length=0,e++,l=(l>>2&1)+2,m=0;k>m;m++){var o=j[a.charAt(e)],p=o>>5?-1:1,o=(31&o)<<6|j[a.charAt(e+1)];3==l&&(o=o<<6|j[a.charAt(e+2)]),o=p*o/10,m%2?h=o+=h:i=o+=i,g[m]=o,e+=l}n.apply(this,g)}return this},c.clone=function(){var a=new b;return a._instructions=this._instructions.slice(),a._activeInstructions=this._activeInstructions.slice(),a._oldInstructions=this._oldInstructions.slice(),this._fillInstructions&&(a._fillInstructions=this._fillInstructions.slice()),this._strokeInstructions&&(a._strokeInstructions=this._strokeInstructions.slice()),this._strokeStyleInstructions&&(a._strokeStyleInstructions=this._strokeStyleInstructions.slice()),a._active=this._active,a._dirty=this._dirty,a},c.toString=function(){return"[Graphics]"},c.mt=c.moveTo,c.lt=c.lineTo,c.at=c.arcTo,c.bt=c.bezierCurveTo,c.qt=c.quadraticCurveTo,c.a=c.arc,c.r=c.rect,c.cp=c.closePath,c.c=c.clear,c.f=c.beginFill,c.lf=c.beginLinearGradientFill,c.rf=c.beginRadialGradientFill,c.bf=c.beginBitmapFill,c.ef=c.endFill,c.ss=c.setStrokeStyle,c.s=c.beginStroke,c.ls=c.beginLinearGradientStroke,c.rs=c.beginRadialGradientStroke,c.bs=c.beginBitmapStroke,c.es=c.endStroke,c.dr=c.drawRect,c.rr=c.drawRoundRect,c.rc=c.drawRoundRectComplex,c.dc=c.drawCircle,c.de=c.drawEllipse,c.dp=c.drawPolyStar,c.p=c.decodePath,c._updateInstructions=function(){this._instructions=this._oldInstructions.slice(),this._instructions.push(b.beginCmd),this._instructions.push.apply(this._instructions,this._activeInstructions),this._fillInstructions&&this._instructions.push.apply(this._instructions,this._fillInstructions),this._strokeInstructions&&(this._strokeStyleInstructions&&this._instructions.push.apply(this._instructions,this._strokeStyleInstructions),this._instructions.push.apply(this._instructions,this._strokeInstructions),this._ignoreScaleStroke?this._instructions.push(new a(this._ctx.save,[],!1),new a(this._ctx.setTransform,[1,0,0,1,0,0],!1),b.strokeCmd,new a(this._ctx.restore,[],!1)):this._instructions.push(b.strokeCmd))},c._newPath=function(){this._dirty&&this._updateInstructions(),this._oldInstructions=this._instructions,this._activeInstructions=[],this._active=this._dirty=!1},c._setProp=function(a,b){this[a]=b},createjs.Graphics=b}(),this.createjs=this.createjs||{},function(){var a=function(){this.initialize()},b=a.prototype;a.suppressCrossDomainErrors=!1,a._hitTestCanvas=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas"),a._hitTestCanvas.width=a._hitTestCanvas.height=1,a._hitTestContext=a._hitTestCanvas.getContext("2d"),a._nextCacheID=1,b.alpha=1,b.cacheCanvas=null,b.id=-1,b.mouseEnabled=!0,b.name=null,b.parent=null,b.regX=0,b.regY=0,b.rotation=0,b.scaleX=1,b.scaleY=1,b.skewX=0,b.skewY=0,b.shadow=null,b.visible=!0,b.x=0,b.y=0,b.compositeOperation=null,b.snapToPixel=!1,b.onPress=null,b.onClick=null,b.onDoubleClick=null,b.onMouseOver=null,b.onMouseOut=null,b.onTick=null,b.filters=null,b.cacheID=0,b.mask=null,b.hitArea=null,b.cursor=null,b.addEventListener=null,b.removeEventListener=null,b.removeAllEventListeners=null,b.dispatchEvent=null,b.hasEventListener=null,b._listeners=null,createjs.EventDispatcher.initialize(b),b._cacheOffsetX=0,b._cacheOffsetY=0,b._cacheScale=1,b._cacheDataURLID=0,b._cacheDataURL=null,b._matrix=null,b.initialize=function(){this.id=createjs.UID.get(),this._matrix=new createjs.Matrix2D},b.isVisible=function(){return!(!this.visible||!(0<this.alpha&&0!=this.scaleX&&0!=this.scaleY))},b.draw=function(a,b){var c=this.cacheCanvas;if(b||!c)return!1;var d=this._cacheScale;return a.drawImage(c,this._cacheOffsetX,this._cacheOffsetY,c.width/d,c.height/d),!0},b.updateContext=function(a){var b,c=this.mask;c&&c.graphics&&!c.graphics.isEmpty()&&(b=c.getMatrix(c._matrix),a.transform(b.a,b.b,b.c,b.d,b.tx,b.ty),c.graphics.drawAsPath(a),a.clip(),b.invert(),a.transform(b.a,b.b,b.c,b.d,b.tx,b.ty)),b=this._matrix.identity().appendTransform(this.x,this.y,this.scaleX,this.scaleY,this.rotation,this.skewX,this.skewY,this.regX,this.regY),createjs.Stage._snapToPixelEnabled&&this.snapToPixel?a.transform(b.a,b.b,b.c,b.d,b.tx+.5|0,b.ty+.5|0):a.transform(b.a,b.b,b.c,b.d,b.tx,b.ty),a.globalAlpha*=this.alpha,this.compositeOperation&&(a.globalCompositeOperation=this.compositeOperation),this.shadow&&this._applyShadow(a,this.shadow)},b.cache=function(a,b,c,d,e){e=e||1,this.cacheCanvas||(this.cacheCanvas=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")),this.cacheCanvas.width=Math.ceil(c*e),this.cacheCanvas.height=Math.ceil(d*e),this._cacheOffsetX=a,this._cacheOffsetY=b,this._cacheScale=e||1,this.updateCache()},b.updateCache=function(b){var c=this.cacheCanvas,d=this._cacheScale,e=this._cacheOffsetX*d,f=this._cacheOffsetY*d;if(!c)throw"cache() must be called before updateCache()";var g=c.getContext("2d");g.save(),b||g.clearRect(0,0,c.width+1,c.height+1),g.globalCompositeOperation=b,g.setTransform(d,0,0,d,-e,-f),this.draw(g,!0),this._applyFilters(),g.restore(),this.cacheID=a._nextCacheID++},b.uncache=function(){this._cacheDataURL=this.cacheCanvas=null,this.cacheID=this._cacheOffsetX=this._cacheOffsetY=0,this._cacheScale=1},b.getCacheDataURL=function(){return this.cacheCanvas?(this.cacheID!=this._cacheDataURLID&&(this._cacheDataURL=this.cacheCanvas.toDataURL()),this._cacheDataURL):null},b.getStage=function(){for(var a=this;a.parent;)a=a.parent;return a instanceof createjs.Stage?a:null},b.localToGlobal=function(a,b){var c=this.getConcatenatedMatrix(this._matrix);return null==c?null:(c.append(1,0,0,1,a,b),new createjs.Point(c.tx,c.ty))},b.globalToLocal=function(a,b){var c=this.getConcatenatedMatrix(this._matrix);return null==c?null:(c.invert(),c.append(1,0,0,1,a,b),new createjs.Point(c.tx,c.ty))},b.localToLocal=function(a,b,c){return a=this.localToGlobal(a,b),c.globalToLocal(a.x,a.y)},b.setTransform=function(a,b,c,d,e,f,g,h,i){return this.x=a||0,this.y=b||0,this.scaleX=null==c?1:c,this.scaleY=null==d?1:d,this.rotation=e||0,this.skewX=f||0,this.skewY=g||0,this.regX=h||0,this.regY=i||0,this},b.getMatrix=function(a){return(a?a.identity():new createjs.Matrix2D).appendTransform(this.x,this.y,this.scaleX,this.scaleY,this.rotation,this.skewX,this.skewY,this.regX,this.regY).appendProperties(this.alpha,this.shadow,this.compositeOperation)},b.getConcatenatedMatrix=function(a){a?a.identity():a=new createjs.Matrix2D;for(var b=this;null!=b;)a.prependTransform(b.x,b.y,b.scaleX,b.scaleY,b.rotation,b.skewX,b.skewY,b.regX,b.regY).prependProperties(b.alpha,b.shadow,b.compositeOperation),b=b.parent;return a},b.hitTest=function(b,c){var d=a._hitTestContext;d.setTransform(1,0,0,1,-b,-c),this.draw(d);var e=this._testHit(d);return d.setTransform(1,0,0,1,0,0),d.clearRect(0,0,2,2),e},b.set=function(a){for(var b in a)this[b]=a[b];return this},b.clone=function(){var b=new a;return this.cloneProps(b),b},b.toString=function(){return"[DisplayObject (name="+this.name+")]"},b.cloneProps=function(a){a.alpha=this.alpha,a.name=this.name,a.regX=this.regX,a.regY=this.regY,a.rotation=this.rotation,a.scaleX=this.scaleX,a.scaleY=this.scaleY,a.shadow=this.shadow,a.skewX=this.skewX,a.skewY=this.skewY,a.visible=this.visible,a.x=this.x,a.y=this.y,a.mouseEnabled=this.mouseEnabled,a.compositeOperation=this.compositeOperation,this.cacheCanvas&&(a.cacheCanvas=this.cacheCanvas.cloneNode(!0),a.cacheCanvas.getContext("2d").putImageData(this.cacheCanvas.getContext("2d").getImageData(0,0,this.cacheCanvas.width,this.cacheCanvas.height),0,0))},b._applyShadow=function(a,b){b=b||Shadow.identity,a.shadowColor=b.color,a.shadowOffsetX=b.offsetX,a.shadowOffsetY=b.offsetY,a.shadowBlur=b.blur},b._tick=function(a){this.onTick&&this.onTick.apply(this,a);var b=this._listeners;b&&b.tick&&this.dispatchEvent({type:"tick",params:a})},b._testHit=function(b){try{var c=1<b.getImageData(0,0,1,1).data[3]}catch(d){if(!a.suppressCrossDomainErrors)throw"An error has occurred. This is most likely due to security restrictions on reading canvas pixel data with local or cross-domain images."}return c},b._applyFilters=function(){if(this.filters&&0!=this.filters.length&&this.cacheCanvas)for(var a=this.filters.length,b=this.cacheCanvas.getContext("2d"),c=this.cacheCanvas.width,d=this.cacheCanvas.height,e=0;a>e;e++)this.filters[e].applyFilter(b,0,0,c,d)},b._hasMouseHandler=function(a){var b=this._listeners;return!!(1&a&&(this.onPress||this.onClick||this.onDoubleClick||b&&(this.hasEventListener("mousedown")||this.hasEventListener("click")||this.hasEventListener("dblclick")))||2&a&&(this.onMouseOver||this.onMouseOut||this.cursor||b&&(this.hasEventListener("mouseover")||this.hasEventListener("mouseout"))))},createjs.DisplayObject=a}(),this.createjs=this.createjs||{},function(){var a=function(){this.initialize()},b=a.prototype=new createjs.DisplayObject;b.children=null,b.DisplayObject_initialize=b.initialize,b.initialize=function(){this.DisplayObject_initialize(),this.children=[]},b.isVisible=function(){var a=this.cacheCanvas||this.children.length;return!(!this.visible||!(0<this.alpha&&0!=this.scaleX&&0!=this.scaleY&&a))},b.DisplayObject_draw=b.draw,b.draw=function(a,b){if(this.DisplayObject_draw(a,b))return!0;for(var c=this.children.slice(0),d=0,e=c.length;e>d;d++){var f=c[d];f.isVisible()&&(a.save(),f.updateContext(a),f.draw(a),a.restore())}return!0},b.addChild=function(a){if(null==a)return a;var b=arguments.length;if(b>1){for(var c=0;b>c;c++)this.addChild(arguments[c]);return arguments[b-1]}return a.parent&&a.parent.removeChild(a),a.parent=this,this.children.push(a),a},b.addChildAt=function(a,b){var c=arguments.length,d=arguments[c-1];if(0>d||d>this.children.length)return arguments[c-2];if(c>2){for(var e=0;c-1>e;e++)this.addChildAt(arguments[e],d+e);return arguments[c-2]}return a.parent&&a.parent.removeChild(a),a.parent=this,this.children.splice(b,0,a),a},b.removeChild=function(a){var b=arguments.length;if(b>1){for(var c=!0,d=0;b>d;d++)c=c&&this.removeChild(arguments[d]);return c
}return this.removeChildAt(this.children.indexOf(a))},b.removeChildAt=function(a){var b=arguments.length;if(b>1){for(var c=[],d=0;b>d;d++)c[d]=arguments[d];c.sort(function(a,b){return b-a});for(var e=!0,d=0;b>d;d++)e=e&&this.removeChildAt(c[d]);return e}return 0>a||a>this.children.length-1?!1:((b=this.children[a])&&(b.parent=null),this.children.splice(a,1),!0)},b.removeAllChildren=function(){for(var a=this.children;a.length;)a.pop().parent=null},b.getChildAt=function(a){return this.children[a]},b.getChildByName=function(a){for(var b=this.children,c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c];return null},b.sortChildren=function(a){this.children.sort(a)},b.getChildIndex=function(a){return this.children.indexOf(a)},b.getNumChildren=function(){return this.children.length},b.swapChildrenAt=function(a,b){var c=this.children,d=c[a],e=c[b];d&&e&&(c[a]=e,c[b]=d)},b.swapChildren=function(a,b){for(var c,d,e=this.children,f=0,g=e.length;g>f&&(e[f]==a&&(c=f),e[f]==b&&(d=f),!(null!=c&&null!=d));f++);f!=g&&(e[c]=b,e[d]=a)},b.setChildIndex=function(a,b){var c=this.children,d=c.length;if(!(a.parent!=this||0>b||b>=d)){for(var e=0;d>e&&c[e]!=a;e++);e==d||e==b||(c.splice(e,1),e>b&&b--,c.splice(b,0,a))}},b.contains=function(a){for(;a;){if(a==this)return!0;a=a.parent}return!1},b.hitTest=function(a,b){return null!=this.getObjectUnderPoint(a,b)},b.getObjectsUnderPoint=function(a,b){var c=[],d=this.localToGlobal(a,b);return this._getObjectsUnderPoint(d.x,d.y,c),c},b.getObjectUnderPoint=function(a,b){var c=this.localToGlobal(a,b);return this._getObjectsUnderPoint(c.x,c.y)},b.clone=function(b){var c=new a;if(this.cloneProps(c),b)for(var d=c.children=[],e=0,f=this.children.length;f>e;e++){var g=this.children[e].clone(b);g.parent=c,d.push(g)}return c},b.toString=function(){return"[Container (name="+this.name+")]"},b.DisplayObject__tick=b._tick,b._tick=function(a){for(var b=this.children.length-1;b>=0;b--){var c=this.children[b];c._tick&&c._tick(a)}this.DisplayObject__tick(a)},b._getObjectsUnderPoint=function(b,c,d,e){var f=createjs.DisplayObject._hitTestContext,g=this._matrix,h=this._hasMouseHandler(e);if(!this.hitArea&&this.cacheCanvas&&h&&(this.getConcatenatedMatrix(g),f.setTransform(g.a,g.b,g.c,g.d,g.tx-b,g.ty-c),f.globalAlpha=g.alpha,this.draw(f),this._testHit(f)))return f.setTransform(1,0,0,1,0,0),f.clearRect(0,0,2,2),this;for(var i=this.children.length-1;i>=0;i--){var j=this.children[i],k=j.hitArea;if(j.visible&&(k||j.isVisible())&&(!e||j.mouseEnabled)){var l=e&&j._hasMouseHandler(e);if(!(j instanceof a)||k&&l){if((!e||h||l)&&(j.getConcatenatedMatrix(g),k&&(g.appendTransform(k.x,k.y,k.scaleX,k.scaleY,k.rotation,k.skewX,k.skewY,k.regX,k.regY),g.alpha=k.alpha),f.globalAlpha=g.alpha,f.setTransform(g.a,g.b,g.c,g.d,g.tx-b,g.ty-c),(k||j).draw(f),this._testHit(f))){if(f.setTransform(1,0,0,1,0,0),f.clearRect(0,0,2,2),h)return this;if(!d)return j;d.push(j)}}else if(h){if(j=j._getObjectsUnderPoint(b,c))return this}else if(j=j._getObjectsUnderPoint(b,c,d,e),!d&&j)return j}}return null},createjs.Container=a}(),this.createjs=this.createjs||{},function(){var a=function(a){this.initialize(a)},b=a.prototype=new createjs.Container;a._snapToPixelEnabled=!1,b.autoClear=!0,b.canvas=null,b.mouseX=0,b.mouseY=0,b.onMouseMove=null,b.onMouseUp=null,b.onMouseDown=null,b.snapToPixelEnabled=!1,b.mouseInBounds=!1,b.tickOnUpdate=!0,b.mouseMoveOutside=!1,b._pointerData=null,b._pointerCount=0,b._primaryPointerID=null,b._mouseOverIntervalID=null,b.Container_initialize=b.initialize,b.initialize=function(a){this.Container_initialize(),this.canvas="string"==typeof a?document.getElementById(a):a,this._pointerData={},this.enableDOMEvents(!0)},b.update=function(){if(this.canvas){this.autoClear&&this.clear(),a._snapToPixelEnabled=this.snapToPixelEnabled,this.tickOnUpdate&&this._tick(arguments.length?arguments:null);var b=this.canvas.getContext("2d");b.save(),this.updateContext(b),this.draw(b,!1),b.restore()}},b.tick=b.update,b.handleEvent=function(a){"tick"==a.type&&this.update(a)},b.clear=function(){if(this.canvas){var a=this.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,this.canvas.width+1,this.canvas.height+1)}},b.toDataURL=function(a,b){b||(b="image/png");var c,d=this.canvas.getContext("2d"),e=this.canvas.width,f=this.canvas.height;if(a){c=d.getImageData(0,0,e,f);var g=d.globalCompositeOperation;d.globalCompositeOperation="destination-over",d.fillStyle=a,d.fillRect(0,0,e,f)}var h=this.canvas.toDataURL(b);return a&&(d.clearRect(0,0,e+1,f+1),d.putImageData(c,0,0),d.globalCompositeOperation=g),h},b.enableMouseOver=function(a){if(this._mouseOverIntervalID&&(clearInterval(this._mouseOverIntervalID),this._mouseOverIntervalID=null),null==a)a=20;else if(0>=a)return;var b=this;this._mouseOverIntervalID=setInterval(function(){b._testMouseOver()},1e3/Math.min(50,a))},b.enableDOMEvents=function(a){null==a&&(a=!0);var b,c=this._eventListeners;if(!a&&c){for(b in c)a=c[b],a.t.removeEventListener(b,a.f);this._eventListeners=null}else if(a&&!c&&this.canvas){a=window.addEventListener?window:document;var d=this,c=this._eventListeners={};c.mouseup={t:a,f:function(a){d._handleMouseUp(a)}},c.mousemove={t:a,f:function(a){d._handleMouseMove(a)}},c.dblclick={t:a,f:function(a){d._handleDoubleClick(a)}},c.mousedown={t:this.canvas,f:function(a){d._handleMouseDown(a)}};for(b in c)a=c[b],a.t.addEventListener(b,a.f)}},b.clone=function(){var b=new a(null);return this.cloneProps(b),b},b.toString=function(){return"[Stage (name="+this.name+")]"},b._getPointerData=function(a){var b=this._pointerData[a];return b||(b=this._pointerData[a]={x:0,y:0},null!=this._primaryPointerID&&-1!=this._primaryPointerID)||(this._primaryPointerID=a),b},b._handleMouseMove=function(a){a||(a=window.event),this._handlePointerMove(-1,a,a.pageX,a.pageY)},b._handlePointerMove=function(a,b,c,d){if(this.canvas){var e=this._getPointerData(a),f=e.inBounds;this._updatePointerPosition(a,c,d),(f||e.inBounds||this.mouseMoveOutside)&&((this.onMouseMove||this.hasEventListener("stagemousemove"))&&(c=new createjs.MouseEvent("stagemousemove",e.x,e.y,this,b,a,a==this._primaryPointerID,e.rawX,e.rawY),this.onMouseMove&&this.onMouseMove(c),this.dispatchEvent(c)),(d=e.event)&&(d.onMouseMove||d.hasEventListener("mousemove"))&&(c=new createjs.MouseEvent("mousemove",e.x,e.y,d.target,b,a,a==this._primaryPointerID,e.rawX,e.rawY),d.onMouseMove&&d.onMouseMove(c),d.dispatchEvent(c,d.target)))}},b._updatePointerPosition=function(a,b,c){var d=this._getElementRect(this.canvas);b-=d.left,c-=d.top;var e=this.canvas.width,f=this.canvas.height;b/=(d.right-d.left)/e,c/=(d.bottom-d.top)/f,d=this._getPointerData(a),(d.inBounds=b>=0&&c>=0&&e-1>=b&&f-1>=c)?(d.x=b,d.y=c):this.mouseMoveOutside&&(d.x=0>b?0:b>e-1?e-1:b,d.y=0>c?0:c>f-1?f-1:c),d.rawX=b,d.rawY=c,a==this._primaryPointerID&&(this.mouseX=d.x,this.mouseY=d.y,this.mouseInBounds=d.inBounds)},b._getElementRect=function(a){var b;try{b=a.getBoundingClientRect()}catch(c){b={top:a.offsetTop,left:a.offsetLeft,width:a.offsetWidth,height:a.offsetHeight}}var d=(window.pageXOffset||document.scrollLeft||0)-(document.clientLeft||document.body.clientLeft||0),e=(window.pageYOffset||document.scrollTop||0)-(document.clientTop||document.body.clientTop||0),f=window.getComputedStyle?getComputedStyle(a):a.currentStyle;a=parseInt(f.paddingLeft)+parseInt(f.borderLeftWidth);var g=parseInt(f.paddingTop)+parseInt(f.borderTopWidth),h=parseInt(f.paddingRight)+parseInt(f.borderRightWidth),f=parseInt(f.paddingBottom)+parseInt(f.borderBottomWidth);return{left:b.left+d+a,right:b.right+d-h,top:b.top+e+g,bottom:b.bottom+e-f}},b._handleMouseUp=function(a){this._handlePointerUp(-1,a,!1)},b._handlePointerUp=function(a,b,c){var d,e=this._getPointerData(a);(this.onMouseMove||this.hasEventListener("stagemouseup"))&&(d=new createjs.MouseEvent("stagemouseup",e.x,e.y,this,b,a,a==this._primaryPointerID,e.rawX,e.rawY),this.onMouseUp&&this.onMouseUp(d),this.dispatchEvent(d));var f=e.event;f&&(f.onMouseUp||f.hasEventListener("mouseup"))&&(d=new createjs.MouseEvent("mouseup",e.x,e.y,f.target,b,a,a==this._primaryPointerID,e.rawX,e.rawY),f.onMouseUp&&f.onMouseUp(d),f.dispatchEvent(d,f.target)),(f=e.target)&&(f.onClick||f.hasEventListener("click"))&&this._getObjectsUnderPoint(e.x,e.y,null,!0,this._mouseOverIntervalID?3:1)==f&&(d=new createjs.MouseEvent("click",e.x,e.y,f,b,a,a==this._primaryPointerID,e.rawX,e.rawY),f.onClick&&f.onClick(d),f.dispatchEvent(d)),c?(a==this._primaryPointerID&&(this._primaryPointerID=null),delete this._pointerData[a]):e.event=e.target=null},b._handleMouseDown=function(a){this._handlePointerDown(-1,a,!1)},b._handlePointerDown=function(a,b,c,d){var e=this._getPointerData(a);null!=d&&this._updatePointerPosition(a,c,d),(this.onMouseDown||this.hasEventListener("stagemousedown"))&&(c=new createjs.MouseEvent("stagemousedown",e.x,e.y,this,b,a,a==this._primaryPointerID,e.rawX,e.rawY),this.onMouseDown&&this.onMouseDown(c),this.dispatchEvent(c)),(d=this._getObjectsUnderPoint(e.x,e.y,null,this._mouseOverIntervalID?3:1))&&(e.target=d,(d.onPress||d.hasEventListener("mousedown"))&&(c=new createjs.MouseEvent("mousedown",e.x,e.y,d,b,a,a==this._primaryPointerID,e.rawX,e.rawY),d.onPress&&d.onPress(c),d.dispatchEvent(c),(c.onMouseMove||c.onMouseUp||c.hasEventListener("mousemove")||c.hasEventListener("mouseup"))&&(e.event=c)))},b._testMouseOver=function(){if(-1==this._primaryPointerID&&(this.mouseX!=this._mouseOverX||this.mouseY!=this._mouseOverY||!this.mouseInBounds)){var a=null;this.mouseInBounds&&(a=this._getObjectsUnderPoint(this.mouseX,this.mouseY,null,3),this._mouseOverX=this.mouseX,this._mouseOverY=this.mouseY);var b=this._mouseOverTarget;if(b!=a){var c=this._getPointerData(-1);if(b&&(b.onMouseOut||b.hasEventListener("mouseout"))){var d=new createjs.MouseEvent("mouseout",c.x,c.y,b,null,-1,c.rawX,c.rawY);b.onMouseOut&&b.onMouseOut(d),b.dispatchEvent(d)}b&&(this.canvas.style.cursor=""),a&&(a.onMouseOver||a.hasEventListener("mouseover"))&&(d=new createjs.MouseEvent("mouseover",c.x,c.y,a,null,-1,c.rawX,c.rawY),a.onMouseOver&&a.onMouseOver(d),a.dispatchEvent(d)),a&&(this.canvas.style.cursor=a.cursor||""),this._mouseOverTarget=a}}},b._handleDoubleClick=function(a){var b=this._getPointerData(-1),c=this._getObjectsUnderPoint(b.x,b.y,null,this._mouseOverIntervalID?3:1);c&&(c.onDoubleClick||c.hasEventListener("dblclick"))&&(evt=new createjs.MouseEvent("dblclick",b.x,b.y,c,a,-1,!0,b.rawX,b.rawY),c.onDoubleClick&&c.onDoubleClick(evt),c.dispatchEvent(evt))},createjs.Stage=a}(),this.createjs=this.createjs||{},function(){var a=function(a){this.initialize(a)},b=a.prototype=new createjs.DisplayObject;b.image=null,b.snapToPixel=!0,b.sourceRect=null,b.DisplayObject_initialize=b.initialize,b.initialize=function(a){this.DisplayObject_initialize(),"string"==typeof a?(this.image=new Image,this.image.src=a):this.image=a},b.isVisible=function(){var a=this.cacheCanvas||this.image&&(this.image.complete||this.image.getContext||2<=this.image.readyState);return!(!this.visible||!(0<this.alpha&&0!=this.scaleX&&0!=this.scaleY&&a))},b.DisplayObject_draw=b.draw,b.draw=function(a,b){if(this.DisplayObject_draw(a,b))return!0;var c=this.sourceRect;return c?a.drawImage(this.image,c.x,c.y,c.width,c.height,0,0,c.width,c.height):a.drawImage(this.image,0,0),!0},b.clone=function(){var b=new a(this.image);return this.sourceRect&&(b.sourceRect=this.sourceRect.clone()),this.cloneProps(b),b},b.toString=function(){return"[Bitmap (name="+this.name+")]"},createjs.Bitmap=a}(),this.createjs=this.createjs||{},function(){var a=function(a){this.initialize(a)},b=a.prototype=new createjs.DisplayObject;b.onAnimationEnd=null,b.currentFrame=-1,b.currentAnimation=null,b.paused=!0,b.spriteSheet=null,b.snapToPixel=!0,b.offset=0,b.currentAnimationFrame=0,b.addEventListener=null,b.removeEventListener=null,b.removeAllEventListeners=null,b.dispatchEvent=null,b.hasEventListener=null,b._listeners=null,createjs.EventDispatcher.initialize(b),b._advanceCount=0,b._animation=null,b.DisplayObject_initialize=b.initialize,b.initialize=function(a){this.DisplayObject_initialize(),this.spriteSheet=a},b.isVisible=function(){var a=this.cacheCanvas||this.spriteSheet.complete&&0<=this.currentFrame;return!(!this.visible||!(0<this.alpha&&0!=this.scaleX&&0!=this.scaleY&&a))},b.DisplayObject_draw=b.draw,b.draw=function(a,b){if(this.DisplayObject_draw(a,b))return!0;this._normalizeFrame();var c=this.spriteSheet.getFrame(this.currentFrame);if(c){var d=c.rect;return a.drawImage(c.image,d.x,d.y,d.width,d.height,-c.regX,-c.regY,d.width,d.height),!0}},b.play=function(){this.paused=!1},b.stop=function(){this.paused=!0},b.gotoAndPlay=function(a){this.paused=!1,this._goto(a)},b.gotoAndStop=function(a){this.paused=!0,this._goto(a)},b.advance=function(){this._animation?this.currentAnimationFrame++:this.currentFrame++,this._normalizeFrame()},b.getBounds=function(){return this.spriteSheet.getFrameBounds(this.currentFrame)},b.clone=function(){var b=new a(this.spriteSheet);return this.cloneProps(b),b},b.toString=function(){return"[BitmapAnimation (name="+this.name+")]"},b.DisplayObject__tick=b._tick,b._tick=function(a){var b=this._animation?this._animation.frequency:1;!this.paused&&0==(++this._advanceCount+this.offset)%b&&this.advance(),this.DisplayObject__tick(a)},b._normalizeFrame=function(){var a,b=this._animation,c=this.currentFrame,d=this.paused;if(b)if(a=b.frames.length,this.currentAnimationFrame>=a){var e=b.next;this._dispatchAnimationEnd(b,c,d,e,a-1)||(e?this._goto(e):(this.paused=!0,this.currentAnimationFrame=b.frames.length-1,this.currentFrame=b.frames[this.currentAnimationFrame]))}else this.currentFrame=b.frames[this.currentAnimationFrame];else a=this.spriteSheet.getNumFrames(),c>=a&&!this._dispatchAnimationEnd(b,c,d,a-1)&&(this.currentFrame=0)},b._dispatchAnimationEnd=function(a,b,c,d,e){var f=a?a.name:null;return this.onAnimationEnd&&this.onAnimationEnd(this,f,d),this.dispatchEvent({type:"animationend",name:f,next:d}),!c&&this.paused&&(this.currentAnimationFrame=e),this.paused!=c||this._animation!=a||this.currentFrame!=b},b.DisplayObject_cloneProps=b.cloneProps,b.cloneProps=function(a){this.DisplayObject_cloneProps(a),a.onAnimationEnd=this.onAnimationEnd,a.currentFrame=this.currentFrame,a.currentAnimation=this.currentAnimation,a.paused=this.paused,a.offset=this.offset,a._animation=this._animation,a.currentAnimationFrame=this.currentAnimationFrame},b._goto=function(a){if(isNaN(a)){var b=this.spriteSheet.getAnimation(a);b&&(this.currentAnimationFrame=0,this._animation=b,this.currentAnimation=a,this._normalizeFrame())}else this.currentAnimation=this._animation=null,this.currentFrame=a},createjs.BitmapAnimation=a}(),this.createjs=this.createjs||{},function(){var a=function(a){this.initialize(a)},b=a.prototype=new createjs.DisplayObject;b.graphics=null,b.DisplayObject_initialize=b.initialize,b.initialize=function(a){this.DisplayObject_initialize(),this.graphics=a?a:new createjs.Graphics},b.isVisible=function(){var a=this.cacheCanvas||this.graphics&&!this.graphics.isEmpty();return!(!this.visible||!(0<this.alpha&&0!=this.scaleX&&0!=this.scaleY&&a))},b.DisplayObject_draw=b.draw,b.draw=function(a,b){return this.DisplayObject_draw(a,b)?!0:(this.graphics.draw(a),!0)},b.clone=function(b){return b=new a(b&&this.graphics?this.graphics.clone():this.graphics),this.cloneProps(b),b},b.toString=function(){return"[Shape (name="+this.name+")]"},createjs.Shape=a}(),this.createjs=this.createjs||{},function(){var a=function(a,b,c){this.initialize(a,b,c)},b=a.prototype=new createjs.DisplayObject;a._workingContext=(createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")).getContext("2d"),b.text="",b.font=null,b.color="#000",b.textAlign="left",b.textBaseline="top",b.maxWidth=null,b.outline=!1,b.lineHeight=0,b.lineWidth=null,b.DisplayObject_initialize=b.initialize,b.initialize=function(a,b,c){this.DisplayObject_initialize(),this.text=a,this.font=b,this.color=c?c:"#000"},b.isVisible=function(){var a=this.cacheCanvas||null!=this.text&&""!==this.text;return!(!this.visible||!(0<this.alpha&&0!=this.scaleX&&0!=this.scaleY&&a))},b.DisplayObject_draw=b.draw,b.draw=function(a,b){return this.DisplayObject_draw(a,b)?!0:(this.outline?a.strokeStyle=this.color:a.fillStyle=this.color,a.font=this.font,a.textAlign=this.textAlign||"start",a.textBaseline=this.textBaseline||"alphabetic",this._drawText(a),!0)},b.getMeasuredWidth=function(){return this._getWorkingContext().measureText(this.text).width},b.getMeasuredLineHeight=function(){return 1.2*this._getWorkingContext().measureText("M").width},b.getMeasuredHeight=function(){return this._drawText()*(this.lineHeight||this.getMeasuredLineHeight())},b.clone=function(){var b=new a(this.text,this.font,this.color);return this.cloneProps(b),b},b.toString=function(){return"[Text (text="+(20<this.text.length?this.text.substr(0,17)+"...":this.text)+")]"},b.DisplayObject_cloneProps=b.cloneProps,b.cloneProps=function(a){this.DisplayObject_cloneProps(a),a.textAlign=this.textAlign,a.textBaseline=this.textBaseline,a.maxWidth=this.maxWidth,a.outline=this.outline,a.lineHeight=this.lineHeight,a.lineWidth=this.lineWidth},b._getWorkingContext=function(){var b=a._workingContext;return b.font=this.font,b.textAlign=this.textAlign||"start",b.textBaseline=this.textBaseline||"alphabetic",b},b._drawText=function(a){var b=!!a;b||(a=this._getWorkingContext());for(var c=String(this.text).split(/(?:\r\n|\r|\n)/),d=this.lineHeight||this.getMeasuredLineHeight(),e=0,f=0,g=c.length;g>f;f++){var h=a.measureText(c[f]).width;if(null==this.lineWidth||h<this.lineWidth)b&&this._drawTextLine(a,c[f],e*d);else{for(var h=c[f].split(/(\s)/),i=h[0],j=1,k=h.length;k>j;j+=2)a.measureText(i+h[j]+h[j+1]).width>this.lineWidth?(b&&this._drawTextLine(a,i,e*d),e++,i=h[j+1]):i+=h[j]+h[j+1];b&&this._drawTextLine(a,i,e*d)}e++}return e},b._drawTextLine=function(a,b,c){this.outline?a.strokeText(b,0,c,this.maxWidth||65535):a.fillText(b,0,c,this.maxWidth||65535)},createjs.Text=a}(),this.createjs=this.createjs||{},function(){var a=function(){throw"SpriteSheetUtils cannot be instantiated"};a._workingCanvas=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas"),a._workingContext=a._workingCanvas.getContext("2d"),a.addFlippedFrames=function(b,c,d,e){if(c||d||e){var f=0;c&&a._flip(b,++f,!0,!1),d&&a._flip(b,++f,!1,!0),e&&a._flip(b,++f,!0,!0)}},a.extractFrame=function(b,c){isNaN(c)&&(c=b.getAnimation(c).frames[0]);var d=b.getFrame(c);if(!d)return null;var e=d.rect,f=a._workingCanvas;return f.width=e.width,f.height=e.height,a._workingContext.drawImage(d.image,e.x,e.y,e.width,e.height,0,0,e.width,e.height),d=new Image,d.src=f.toDataURL("image/png"),d},a.mergeAlpha=function(a,b,c){c||(c=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")),c.width=Math.max(b.width,a.width),c.height=Math.max(b.height,a.height);var d=c.getContext("2d");return d.save(),d.drawImage(a,0,0),d.globalCompositeOperation="destination-in",d.drawImage(b,0,0),d.restore(),c},a._flip=function(b,c,d,e){for(var f=b._images,g=a._workingCanvas,h=a._workingContext,i=f.length/c,j=0;i>j;j++){var k=f[j];k.__tmp=j,h.setTransform(1,0,0,1,0,0),h.clearRect(0,0,g.width+1,g.height+1),g.width=k.width,g.height=k.height,h.setTransform(d?-1:1,0,0,e?-1:1,d?k.width:0,e?k.height:0),h.drawImage(k,0,0);var l=new Image;l.src=g.toDataURL("image/png"),l.width=k.width,l.height=k.height,f.push(l)}for(h=b._frames,g=h.length/c,j=0;g>j;j++){var k=h[j],m=k.rect.clone(),l=f[k.image.__tmp+i*c],n={image:l,rect:m,regX:k.regX,regY:k.regY};d&&(m.x=l.width-m.x-m.width,n.regX=m.width-k.regX),e&&(m.y=l.height-m.y-m.height,n.regY=m.height-k.regY),h.push(n)}for(d="_"+(d?"h":"")+(e?"v":""),e=b._animations,b=b._data,f=e.length/c,j=0;f>j;j++){for(h=e[j],k=b[h],i={name:h+d,frequency:k.frequency,next:k.next,frames:[]},k.next&&(i.next+=d),h=k.frames,k=0,l=h.length;l>k;k++)i.frames.push(h[k]+g*c);b[i.name]=i,e.push(i.name)}},createjs.SpriteSheetUtils=a}(),this.createjs=this.createjs||{},function(){var a=function(){this.initialize()},b=a.prototype;a.ERR_DIMENSIONS="frame dimensions exceed max spritesheet dimensions",a.ERR_RUNNING="a build is already running",b.maxWidth=2048,b.maxHeight=2048,b.spriteSheet=null,b.scale=1,b.padding=1,b.timeSlice=.3,b.progress=-1,b.onComplete=null,b.onProgress=null,b.addEventListener=null,b.removeEventListener=null,b.removeAllEventListeners=null,b.dispatchEvent=null,b.hasEventListener=null,b._listeners=null,createjs.EventDispatcher.initialize(b),b._frames=null,b._animations=null,b._data=null,b._nextFrameIndex=0,b._index=0,b._timerID=null,b._scale=1,b.initialize=function(){this._frames=[],this._animations={}},b.addFrame=function(b,c,d,e,f,g){if(this._data)throw a.ERR_RUNNING;return c=c||b.bounds||b.nominalBounds,!c&&b.getBounds&&(c=b.getBounds()),c?(d=d||1,this._frames.push({source:b,sourceRect:c,scale:d,funct:e,params:f,scope:g,index:this._frames.length,height:c.height*d})-1):null},b.addAnimation=function(b,c,d,e){if(this._data)throw a.ERR_RUNNING;this._animations[b]={frames:c,next:d,frequency:e}},b.addMovieClip=function(b,c,d){if(this._data)throw a.ERR_RUNNING;var e=b.frameBounds,f=c||b.bounds||b.nominalBounds;if(!f&&b.getBounds&&(f=b.getBounds()),!f&&!e)return null;c=this._frames.length;for(var g=b.timeline.duration,h=0;g>h;h++)this.addFrame(b,e&&e[h]?e[h]:f,d,function(a){var b=this.actionsEnabled;this.actionsEnabled=!1,this.gotoAndStop(a),this.actionsEnabled=b},[h],b);h=b.timeline._labels,b=[];for(var i in h)b.push({index:h[i],label:i});if(b.length)for(b.sort(function(a,b){return a.index-b.index}),h=0,i=b.length;i>h;h++){d=b[h].label;for(var e=c+(h==i-1?g:b[h+1].index),f=[],j=c+b[h].index;e>j;j++)f.push(j);this.addAnimation(d,f,!0)}},b.build=function(){if(this._data)throw a.ERR_RUNNING;for(this._startBuild();this._drawNext(););return this._endBuild(),this.spriteSheet},b.buildAsync=function(b){if(this._data)throw a.ERR_RUNNING;this.timeSlice=b,this._startBuild();var c=this;this._timerID=setTimeout(function(){c._run()},50-50*Math.max(.01,Math.min(.99,this.timeSlice||.3)))},b.stopAsync=function(){clearTimeout(this._timerID),this._data=null},b.clone=function(){throw"SpriteSheetBuilder cannot be cloned."},b.toString=function(){return"[SpriteSheetBuilder]"},b._startBuild=function(){var b=this.padding||0;this.progress=0,this.spriteSheet=null,this._index=0,this._scale=this.scale;var c=[];this._data={images:[],frames:c,animations:this._animations};var d=this._frames.slice();if(d.sort(function(a,b){return a.height<=b.height?-1:1}),d[d.length-1].height+2*b>this.maxHeight)throw a.ERR_DIMENSIONS;for(var e=0,f=0,g=0;d.length;){var h=this._fillRow(d,e,g,c,b);if(h.w>f&&(f=h.w),e+=h.h,!h.h||!d.length){var i=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");i.width=this._getSize(f,this.maxWidth),i.height=this._getSize(e,this.maxHeight),this._data.images[g]=i,h.h||(f=e=0,g++)}}},b._getSize=function(a,b){for(var c=4;Math.pow(2,++c)<a;);return Math.min(b,Math.pow(2,c))},b._fillRow=function(b,c,d,e,f){var g=this.maxWidth,h=this.maxHeight;c+=f;for(var h=h-c,i=f,j=0,k=b.length-1;k>=0;k--){var l=b[k],m=this._scale*l.scale,n=l.sourceRect,o=l.source,p=Math.floor(m*n.x-f),q=Math.floor(m*n.y-f),r=Math.ceil(m*n.height+2*f),n=Math.ceil(m*n.width+2*f);if(n>g)throw a.ERR_DIMENSIONS;r>h||i+n>g||(l.img=d,l.rect=new createjs.Rectangle(i,c,n,r),j=j||r,b.splice(k,1),e[l.index]=[i,c,n,r,d,Math.round(-p+m*o.regX-f),Math.round(-q+m*o.regY-f)],i+=n)}return{w:i,h:j}},b._endBuild=function(){this.spriteSheet=new createjs.SpriteSheet(this._data),this._data=null,this.progress=1,this.onComplete&&this.onComplete(this),this.dispatchEvent("complete")},b._run=function(){for(var a=50*Math.max(.01,Math.min(.99,this.timeSlice||.3)),b=(new Date).getTime()+a,c=!1;b>(new Date).getTime();)if(!this._drawNext()){c=!0;break}if(c)this._endBuild();else{var d=this;this._timerID=setTimeout(function(){d._run()},50-a)}a=this.progress=this._index/this._frames.length,this.onProgress&&this.onProgress(this,a),this.dispatchEvent({type:"progress",progress:a})},b._drawNext=function(){var a=this._frames[this._index],b=a.scale*this._scale,c=a.rect,d=a.sourceRect,e=this._data.images[a.img].getContext("2d");return a.funct&&a.funct.apply(a.scope,a.params),e.save(),e.beginPath(),e.rect(c.x,c.y,c.width,c.height),e.clip(),e.translate(Math.ceil(c.x-d.x*b),Math.ceil(c.y-d.y*b)),e.scale(b,b),a.source.draw(e),e.restore(),++this._index<this._frames.length},createjs.SpriteSheetBuilder=a}(),this.createjs=this.createjs||{},function(){var a=function(a){this.initialize(a)},b=a.prototype=new createjs.DisplayObject;b.htmlElement=null,b._oldMtx=null,b.DisplayObject_initialize=b.initialize,b.initialize=function(a){"string"==typeof a&&(a=document.getElementById(a)),this.DisplayObject_initialize(),this.mouseEnabled=!1,this.htmlElement=a,a=a.style,a.position="absolute",a.transformOrigin=a.WebkitTransformOrigin=a.msTransformOrigin=a.MozTransformOrigin=a.OTransformOrigin="0% 0%"},b.isVisible=function(){return null!=this.htmlElement},b.draw=function(){if(null!=this.htmlElement){var a=this.getConcatenatedMatrix(this._matrix),b=this.htmlElement.style;if(!this.visible)return!0;b.visibility="visible";var c=this._oldMtx||{};return c.alpha!=a.alpha&&(b.opacity=""+a.alpha,c.alpha=a.alpha),(c.tx!=a.tx||c.ty!=a.ty||c.a!=a.a||c.b!=a.b||c.c!=a.c||c.d!=a.d)&&(b.transform=b.WebkitTransform=b.OTransform=b.msTransform=["matrix("+a.a,a.b,a.c,a.d,a.tx+.5|0,(a.ty+.5|0)+")"].join(),b.MozTransform=["matrix("+a.a,a.b,a.c,a.d,(a.tx+.5|0)+"px",(a.ty+.5|0)+"px)"].join(),this._oldMtx=a.clone()),!0}},b.cache=function(){},b.uncache=function(){},b.updateCache=function(){},b.hitTest=function(){},b.localToGlobal=function(){},b.globalToLocal=function(){},b.localToLocal=function(){},b.clone=function(){throw"DOMElement cannot be cloned."},b.toString=function(){return"[DOMElement (name="+this.name+")]"},b.DisplayObject__tick=b._tick,b._tick=function(a){this.htmlElement.style.visibility="hidden",this.DisplayObject__tick(a)},createjs.DOMElement=a}(),this.createjs=this.createjs||{},function(){var a=function(){this.initialize()},b=a.prototype;b.initialize=function(){},b.getBounds=function(){return new createjs.Rectangle(0,0,0,0)},b.applyFilter=function(){},b.toString=function(){return"[Filter]"},b.clone=function(){return new a},createjs.Filter=a}(),this.createjs=this.createjs||{},function(){var a=function(){throw"Touch cannot be instantiated"};a.isSupported=function(){return"ontouchstart"in window||window.navigator.msPointerEnabled},a.enable=function(b,c,d){return b&&b.canvas&&a.isSupported()?(b.__touch={pointers:{},multitouch:!c,preventDefault:!d,count:0},"ontouchstart"in window?a._IOS_enable(b):window.navigator.msPointerEnabled&&a._IE_enable(b),!0):!1},a.disable=function(b){b&&("ontouchstart"in window?a._IOS_disable(b):window.navigator.msPointerEnabled&&a._IE_disable(b))},a._IOS_enable=function(b){var c=b.canvas,d=b.__touch.f=function(c){a._IOS_handleEvent(b,c)};c.addEventListener("touchstart",d,!1),c.addEventListener("touchmove",d,!1),c.addEventListener("touchend",d,!1),c.addEventListener("touchcancel",d,!1)},a._IOS_disable=function(a){var b=a.canvas;b&&(a=a.__touch.f,b.removeEventListener("touchstart",a,!1),b.removeEventListener("touchmove",a,!1),b.removeEventListener("touchend",a,!1),b.removeEventListener("touchcancel",a,!1))},a._IOS_handleEvent=function(a,b){if(a){a.__touch.preventDefault&&b.preventDefault&&b.preventDefault();for(var c=b.changedTouches,d=b.type,e=0,f=c.length;f>e;e++){var g=c[e],h=g.identifier;g.target==a.canvas&&("touchstart"==d?this._handleStart(a,h,b,g.pageX,g.pageY):"touchmove"==d?this._handleMove(a,h,b,g.pageX,g.pageY):("touchend"==d||"touchcancel"==d)&&this._handleEnd(a,h,b))}}},a._IE_enable=function(b){var c=b.canvas,d=b.__touch.f=function(c){a._IE_handleEvent(b,c)};c.addEventListener("MSPointerDown",d,!1),window.addEventListener("MSPointerMove",d,!1),window.addEventListener("MSPointerUp",d,!1),window.addEventListener("MSPointerCancel",d,!1),b.__touch.preventDefault&&(c.style.msTouchAction="none"),b.__touch.activeIDs={}},a._IE_disable=function(a){var b=a.__touch.f;window.removeEventListener("MSPointerMove",b,!1),window.removeEventListener("MSPointerUp",b,!1),window.removeEventListener("MSPointerCancel",b,!1),a.canvas&&a.canvas.removeEventListener("MSPointerDown",b,!1)},a._IE_handleEvent=function(a,b){if(a){a.__touch.preventDefault&&b.preventDefault&&b.preventDefault();var c=b.type,d=b.pointerId,e=a.__touch.activeIDs;"MSPointerDown"==c?b.srcElement==a.canvas&&(e[d]=!0,this._handleStart(a,d,b,b.pageX,b.pageY)):e[d]&&("MSPointerMove"==c?this._handleMove(a,d,b,b.pageX,b.pageY):("MSPointerUp"==c||"MSPointerCancel"==c)&&(delete e[d],this._handleEnd(a,d,b)))}},a._handleStart=function(a,b,c,d,e){var f=a.__touch;if(f.multitouch||!f.count){var g=f.pointers;g[b]||(g[b]=!0,f.count++,a._handlePointerDown(b,c,d,e))}},a._handleMove=function(a,b,c,d,e){a.__touch.pointers[b]&&a._handlePointerMove(b,c,d,e)},a._handleEnd=function(a,b,c){var d=a.__touch,e=d.pointers;e[b]&&(d.count--,a._handlePointerUp(b,c,!0),delete e[b])},createjs.Touch=a}(),function(){var a=this.createjs=this.createjs||{},a=a.EaselJS=a.EaselJS||{};a.version="0.6.1",a.buildDate="Tue, 14 May 2013 21:43:02 GMT"}(),function(){function a(a,b,c){for(var d=(c||0)-1,e=a?a.length:0;++d<e;)if(a[d]===b)return d;return-1}function b(b,c){var d=typeof c;if(b=b.cache,"boolean"==d||null==c)return b[c]?0:-1;"number"!=d&&"string"!=d&&(d="object");var e="number"==d?c:s+c;return b=(b=b[d])&&b[e],"object"==d?b&&a(b,c)>-1?0:-1:b?0:-1}function c(a){var b=this.cache,c=typeof a;if("boolean"==c||null==a)b[a]=!0;else{"number"!=c&&"string"!=c&&(c="object");var d="number"==c?a:s+a,e=b[c]||(b[c]={});"object"==c?(e[d]||(e[d]=[])).push(a):e[d]=!0}}function d(a){return a.charCodeAt(0)}function e(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||"undefined"==typeof c)return 1;if(d>c||"undefined"==typeof d)return-1}return a.index-b.index}function f(a){var b=-1,d=a.length,e=a[0],f=a[d/2|0],g=a[d-1];if(e&&"object"==typeof e&&f&&"object"==typeof f&&g&&"object"==typeof g)return!1;var h=i();h["false"]=h["null"]=h["true"]=h.undefined=!1;var j=i();for(j.array=a,j.cache=h,j.push=c;++b<d;)j.push(a[b]);return j}function g(a){return"\\"+W[a]}function h(){return p.pop()||[]}function i(){return q.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function j(){}function k(a){a.length=0,p.length<u&&p.push(a)}function l(a){var b=a.cache;b&&l(b),a.array=a.cache=a.criteria=a.object=a.number=a.string=a.value=null,q.length<u&&q.push(a)}function m(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);for(var d=-1,e=c-b||0,f=Array(0>e?0:e);++d<e;)f[d]=a[b+d];return f}function n(c){function p(a){return a&&"object"==typeof a&&!Xd(a)&&yd.call(a,"__wrapped__")?a:new q(a)}function q(a,b){this.__chain__=!!b,this.__wrapped__=a}function u(a,b,c,d,e){if(c){var f=c(a);if("undefined"!=typeof f)return f}var g=Ab(a);if(!g)return a;var i=Ed.call(a);if(!S[i])return a;var j=Ud[i];switch(i){case L:case M:return new j(+a);case O:case R:return new j(a);case Q:return f=j(a.source,A.exec(a)),f.lastIndex=a.lastIndex,f}var l=Xd(a);if(b){var n=!d;d||(d=h()),e||(e=h());for(var o=d.length;o--;)if(d[o]==a)return e[o];f=l?j(a.length):{}}else f=l?m(a):ce({},a);return l&&(yd.call(a,"index")&&(f.index=a.index),yd.call(a,"input")&&(f.input=a.input)),b?(d.push(a),e.push(f),(l?Tb:fe)(a,function(a,g){f[g]=u(a,b,c,d,e)}),n&&(k(d),k(e)),f):f}function W(a,b,c){if("function"!=typeof a)return Tc;if("undefined"==typeof b)return a;var d=a.__bindData__||Vd.funcNames&&!a.name;if("undefined"==typeof d){var e=F&&wd.call(a);Vd.funcNames||!e||B.test(e)||(d=!0),(Vd.funcNames||!d)&&(d=!Vd.funcDecomp||F.test(e),Wd(a,d))}if(d!==!0&&d&&1&d[1])return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return Dc(a,b)}function Y(a,b,c,d){for(var e=(d||0)-1,f=a?a.length:0,g=[];++e<f;){var h=a[e];if(h&&"object"==typeof h&&"number"==typeof h.length&&(Xd(h)||jb(h))){b||(h=Y(h,b,c));
var i=-1,j=h.length,k=g.length;for(g.length+=j;++i<j;)g[k++]=h[i]}else c||g.push(h)}return g}function Z(a,b,c,d,e,f){if(c){var g=c(a,b);if("undefined"!=typeof g)return!!g}if(a===b)return 0!==a||1/a==1/b;var i=typeof a,j=typeof b;if(!(a!==a||a&&V[i]||b&&V[j]))return!1;if(null==a||null==b)return a===b;var l=Ed.call(a),m=Ed.call(b);if(l==J&&(l=P),m==J&&(m=P),l!=m)return!1;switch(l){case L:case M:return+a==+b;case O:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case Q:case R:return a==nd(b)}var n=l==K;if(!n){if(yd.call(a,"__wrapped__ ")||yd.call(b,"__wrapped__"))return Z(a.__wrapped__||a,b.__wrapped__||b,c,d,e,f);if(l!=P)return!1;var o=a.constructor,p=b.constructor;if(o!=p&&!(zb(o)&&o instanceof o&&zb(p)&&p instanceof p))return!1}var q=!e;e||(e=h()),f||(f=h());for(var r=e.length;r--;)if(e[r]==a)return f[r]==b;var s=0;if(g=!0,e.push(a),f.push(b),n){if(r=a.length,s=b.length,g=s==a.length,!g&&!d)return g;for(;s--;){var t=r,u=b[s];if(d)for(;t--&&!(g=Z(a[t],u,c,d,e,f)););else if(!(g=Z(a[s],u,c,d,e,f)))break}return g}return ee(b,function(b,h,i){return yd.call(i,h)?(s++,g=yd.call(a,h)&&Z(a[h],b,c,d,e,f)):void 0}),g&&!d&&ee(a,function(a,b,c){return yd.call(c,b)?g=--s>-1:void 0}),q&&(k(e),k(f)),g}function _(a,b,c,d,e){(Xd(b)?Tb:fe)(b,function(b,f){var g,h,i=b,j=a[f];if(b&&((h=Xd(b))||ge(b))){for(var k=d.length;k--;)if(g=d[k]==b){j=e[k];break}if(!g){var l;c&&(i=c(j,b),(l="undefined"!=typeof i)&&(j=i)),l||(j=h?Xd(j)?j:[]:ge(j)?j:{}),d.push(b),e.push(j),l||_(j,b,c,d,e)}}else c&&(i=c(j,b),"undefined"==typeof i&&(i=b)),"undefined"!=typeof i&&(j=i);a[f]=j})}function bb(c,d,e){var g=-1,i=gb(),j=c?c.length:0,m=[],n=!d&&j>=t&&i===a,o=e||n?h():m;if(n){var p=f(o);p?(i=b,o=p):(n=!1,o=e?o:(k(o),m))}for(;++g<j;){var q=c[g],r=e?e(q,g,c):q;(d?!g||o[o.length-1]!==r:i(o,r)<0)&&((e||n)&&o.push(r),m.push(q))}return n?(k(o.array),l(o)):e&&k(o),m}function cb(a){return function(b,c,d){var e={};c=p.createCallback(c,d,3);var f=-1,g=b?b.length:0;if("number"==typeof g)for(;++f<g;){var h=b[f];a(e,h,c(h,f,b),b)}else fe(b,function(b,d,f){a(e,b,c(b,d,f),f)});return e}}function db(a,b,c,d,e,f){var g=1&b,h=2&b,i=4&b,j=8&b,k=16&b,l=32&b,m=a;if(!h&&!zb(a))throw new od;k&&!c.length&&(b&=-17,k=c=!1),l&&!d.length&&(b&=-33,l=d=!1);var n=a&&a.__bindData__;if(n)return!g||1&n[1]||(n[4]=e),!g&&1&n[1]&&(b|=8),!i||4&n[1]||(n[5]=f),k&&Ad.apply(n[2]||(n[2]=[]),c),l&&Ad.apply(n[3]||(n[3]=[]),d),n[1]|=b,db.apply(null,n);if(g&&!(h||i||l)&&(Vd.fastBind||Hd&&k)){if(k){var o=[e];Ad.apply(o,c)}var p=k?Hd.apply(a,o):Hd.call(a,e)}else p=function(){var n=arguments,o=g?e:this;if((i||k||l)&&(n=Rd.call(n),k&&Fd.apply(n,c),l&&Ad.apply(n,d),i&&n.length<f))return b|=16,db(a,j?b:-4&b,n,null,e,f);if(h&&(a=o[m]),this instanceof p){o=eb(a.prototype);var q=a.apply(o,n);return Ab(q)?q:o}return a.apply(o,n)};return Wd(p,Rd.call(arguments)),p}function eb(a){return Ab(a)?Id(a):{}}function fb(a){return $d[a]}function gb(){var b=(b=p.indexOf)===nc?a:b;return b}function hb(a){var b,c;return a&&Ed.call(a)==P&&(b=a.constructor,!zb(b)||b instanceof b)?(ee(a,function(a,b){c=b}),"undefined"==typeof c||yd.call(a,c)):!1}function ib(a){return _d[a]}function jb(a){return a&&"object"==typeof a&&"number"==typeof a.length&&Ed.call(a)==J||!1}function kb(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c=b,b=!1),u(a,b,"function"==typeof c&&W(c,d,1))}function lb(a,b,c){return u(a,!0,"function"==typeof b&&W(b,c,1))}function mb(a,b,c){var d;return b=p.createCallback(b,c,3),fe(a,function(a,c,e){return b(a,c,e)?(d=c,!1):void 0}),d}function nb(a,b,c){var d;return b=p.createCallback(b,c,3),pb(a,function(a,c,e){return b(a,c,e)?(d=c,!1):void 0}),d}function ob(a,b,c){var d=[];ee(a,function(a,b){d.push(b,a)});var e=d.length;for(b=W(b,c,3);e--&&b(d[e--],d[e],a)!==!1;);return a}function pb(a,b,c){var d=Zd(a),e=d.length;for(b=W(b,c,3);e--;){var f=d[e];if(b(a[f],f,a)===!1)break}return a}function qb(a){var b=[];return ee(a,function(a,c){zb(a)&&b.push(c)}),b.sort()}function rb(a,b){return a?yd.call(a,b):!1}function sb(a){for(var b=-1,c=Zd(a),d=c.length,e={};++b<d;){var f=c[b];e[a[f]]=f}return e}function tb(a){return a===!0||a===!1||Ed.call(a)==L}function ub(a){return a?"object"==typeof a&&Ed.call(a)==M:!1}function vb(a){return a?1===a.nodeType:!1}function wb(a){var b=!0;if(!a)return b;var c=Ed.call(a),d=a.length;return c==K||c==R||c==J||c==P&&"number"==typeof d&&zb(a.splice)?!d:(fe(a,function(){return b=!1}),b)}function xb(a,b,c,d){return Z(a,b,"function"==typeof c&&W(c,d,2))}function yb(a){return Kd(a)&&!Ld(parseFloat(a))}function zb(a){return"function"==typeof a}function Ab(a){return!(!a||!V[typeof a])}function Bb(a){return Db(a)&&a!=+a}function Cb(a){return null===a}function Db(a){return"number"==typeof a||Ed.call(a)==O}function Eb(a){return a?"object"==typeof a&&Ed.call(a)==Q:!1}function Fb(a){return"string"==typeof a||Ed.call(a)==R}function Gb(a){return"undefined"==typeof a}function Hb(a){var b=arguments,c=2;if(!Ab(a))return a;if("number"!=typeof b[2]&&(c=b.length),c>3&&"function"==typeof b[c-2])var d=W(b[--c-1],b[c--],2);else c>2&&"function"==typeof b[c-1]&&(d=b[--c]);for(var e=Rd.call(arguments,1,c),f=-1,g=h(),i=h();++f<c;)_(a,e[f],d,g,i);return k(g),k(i),a}function Ib(a,b,c){var d=gb(),e="function"==typeof b,f={};if(e)b=p.createCallback(b,c,3);else var g=Y(arguments,!0,!1,1);return ee(a,function(a,c,h){(e?!b(a,c,h):d(g,c)<0)&&(f[c]=a)}),f}function Jb(a){for(var b=-1,c=Zd(a),d=c.length,e=fd(d);++b<d;){var f=c[b];e[b]=[f,a[f]]}return e}function Kb(a,b,c){var d={};if("function"!=typeof b)for(var e=-1,f=Y(arguments,!0,!1,1),g=Ab(a)?f.length:0;++e<g;){var h=f[e];h in a&&(d[h]=a[h])}else b=p.createCallback(b,c,3),ee(a,function(a,c,e){b(a,c,e)&&(d[c]=a)});return d}function Lb(a,b,c,d){var e=Xd(a);if(b=W(b,d,4),null==c)if(e)c=[];else{var f=a&&a.constructor,g=f&&f.prototype;c=eb(g)}return(e?Tb:fe)(a,function(a,d,e){return b(c,a,d,e)}),c}function Mb(a){for(var b=-1,c=Zd(a),d=c.length,e=fd(d);++b<d;)e[b]=a[c[b]];return e}function Nb(a){for(var b=arguments,c=-1,d=Y(b,!0,!1,1),e=b[2]&&b[2][b[1]]===a?1:d.length,f=fd(e);++c<e;)f[c]=a[d[c]];return f}function Ob(a,b,c){var d=-1,e=gb(),f=a?a.length:0,g=!1;return c=(0>c?Nd(0,f+c):c)||0,Xd(a)?g=e(a,b,c)>-1:"number"==typeof f?g=(Fb(a)?a.indexOf(b,c):e(a,b,c))>-1:fe(a,function(a){return++d>=c?!(g=a===b):void 0}),g}function Pb(a,b,c){var d=!0;b=p.createCallback(b,c,3);var e=-1,f=a?a.length:0;if("number"==typeof f)for(;++e<f&&(d=!!b(a[e],e,a)););else fe(a,function(a,c,e){return d=!!b(a,c,e)});return d}function Qb(a,b,c){var d=[];b=p.createCallback(b,c,3);var e=-1,f=a?a.length:0;if("number"==typeof f)for(;++e<f;){var g=a[e];b(g,e,a)&&d.push(g)}else fe(a,function(a,c,e){b(a,c,e)&&d.push(a)});return d}function Rb(a,b,c){b=p.createCallback(b,c,3);var d=-1,e=a?a.length:0;if("number"!=typeof e){var f;return fe(a,function(a,c,d){return b(a,c,d)?(f=a,!1):void 0}),f}for(;++d<e;){var g=a[d];if(b(g,d,a))return g}}function Sb(a,b,c){var d;return b=p.createCallback(b,c,3),Ub(a,function(a,c,e){return b(a,c,e)?(d=a,!1):void 0}),d}function Tb(a,b,c){var d=-1,e=a?a.length:0;if(b=b&&"undefined"==typeof c?b:W(b,c,3),"number"==typeof e)for(;++d<e&&b(a[d],d,a)!==!1;);else fe(a,b);return a}function Ub(a,b,c){var d=a?a.length:0;if(b=b&&"undefined"==typeof c?b:W(b,c,3),"number"==typeof d)for(;d--&&b(a[d],d,a)!==!1;);else{var e=Zd(a);d=e.length,fe(a,function(a,c,f){return c=e?e[--d]:--d,b(f[c],c,f)})}return a}function Vb(a,b){var c=Rd.call(arguments,2),d=-1,e="function"==typeof b,f=a?a.length:0,g=fd("number"==typeof f?f:0);return Tb(a,function(a){g[++d]=(e?b:a[b]).apply(a,c)}),g}function Wb(a,b,c){var d=-1,e=a?a.length:0;if(b=p.createCallback(b,c,3),"number"==typeof e)for(var f=fd(e);++d<e;)f[d]=b(a[d],d,a);else f=[],fe(a,function(a,c,e){f[++d]=b(a,c,e)});return f}function Xb(a,b,c){var e=-1/0,f=e;if(!b&&Xd(a))for(var g=-1,h=a.length;++g<h;){var i=a[g];i>f&&(f=i)}else b=!b&&Fb(a)?d:p.createCallback(b,c,3),Tb(a,function(a,c,d){var g=b(a,c,d);g>e&&(e=g,f=a)});return f}function Yb(a,b,c){var e=1/0,f=e;if(!b&&Xd(a))for(var g=-1,h=a.length;++g<h;){var i=a[g];f>i&&(f=i)}else b=!b&&Fb(a)?d:p.createCallback(b,c,3),Tb(a,function(a,c,d){var g=b(a,c,d);e>g&&(e=g,f=a)});return f}function Zb(a,b){var c=-1,d=a?a.length:0;if("number"==typeof d)for(var e=fd(d);++c<d;)e[c]=a[c][b];return e||Wb(a,b)}function $b(a,b,c,d){if(!a)return c;var e=arguments.length<3;b=W(b,d,4);var f=-1,g=a.length;if("number"==typeof g)for(e&&(c=a[++f]);++f<g;)c=b(c,a[f],f,a);else fe(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)});return c}function _b(a,b,c,d){var e=arguments.length<3;return b=W(b,d,4),Ub(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)}),c}function ac(a,b,c){return b=p.createCallback(b,c,3),Qb(a,function(a,c,d){return!b(a,c,d)})}function bc(a,b,c){var d=a?a.length:0;if("number"!=typeof d&&(a=Mb(a)),null==b||c)return a?a[Wc(d-1)]:o;var e=cc(a);return e.length=Od(Nd(0,b),e.length),e}function cc(a){var b=-1,c=a?a.length:0,d=fd("number"==typeof c?c:0);return Tb(a,function(a){var c=Wc(++b);d[b]=d[c],d[c]=a}),d}function dc(a){var b=a?a.length:0;return"number"==typeof b?b:Zd(a).length}function ec(a,b,c){var d;b=p.createCallback(b,c,3);var e=-1,f=a?a.length:0;if("number"==typeof f)for(;++e<f&&!(d=b(a[e],e,a)););else fe(a,function(a,c,e){return!(d=b(a,c,e))});return!!d}function fc(a,b,c){var d=-1,f=a?a.length:0,g=fd("number"==typeof f?f:0);for(b=p.createCallback(b,c,3),Tb(a,function(a,c,e){var f=g[++d]=i();f.criteria=b(a,c,e),f.index=d,f.value=a}),f=g.length,g.sort(e);f--;){var h=g[f];g[f]=h.value,l(h)}return g}function gc(a){return a&&"number"==typeof a.length?m(a):Mb(a)}function hc(a){for(var b=-1,c=a?a.length:0,d=[];++b<c;){var e=a[b];e&&d.push(e)}return d}function ic(c){var d=-1,e=gb(),g=c?c.length:0,h=Y(arguments,!0,!0,1),i=[],j=g>=t&&e===a;if(j){var k=f(h);k?(e=b,h=k):j=!1}for(;++d<g;){var m=c[d];e(h,m)<0&&i.push(m)}return j&&l(h),i}function jc(a,b,c){var d=-1,e=a?a.length:0;for(b=p.createCallback(b,c,3);++d<e;)if(b(a[d],d,a))return d;return-1}function kc(a,b,c){var d=a?a.length:0;for(b=p.createCallback(b,c,3);d--;)if(b(a[d],d,a))return d;return-1}function lc(a,b,c){var d=0,e=a?a.length:0;if("number"!=typeof b&&null!=b){var f=-1;for(b=p.createCallback(b,c,3);++f<e&&b(a[f],f,a);)d++}else if(d=b,null==d||c)return a?a[0]:o;return m(a,0,Od(Nd(0,d),e))}function mc(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c=d&&d[b]===a?null:b,b=!1),null!=c&&(a=Wb(a,c,d)),Y(a,b)}function nc(b,c,d){if("number"==typeof d){var e=b?b.length:0;d=0>d?Nd(0,e+d):d||0}else if(d){var f=wc(b,c);return b[f]===c?f:-1}return a(b,c,d)}function oc(a,b,c){var d=0,e=a?a.length:0;if("number"!=typeof b&&null!=b){var f=e;for(b=p.createCallback(b,c,3);f--&&b(a[f],f,a);)d++}else d=null==b||c?1:b||d;return m(a,0,Od(Nd(0,e-d),e))}function pc(c){for(var d=arguments,e=d.length,g=-1,i=h(),j=-1,m=gb(),n=c?c.length:0,o=[],p=h();++g<e;){var q=d[g];i[g]=m===a&&(q?q.length:0)>=t&&f(g?d[g]:p)}a:for(;++j<n;){var r=i[0];if(q=c[j],(r?b(r,q):m(p,q))<0){for(g=e,(r||p).push(q);--g;)if(r=i[g],(r?b(r,q):m(d[g],q))<0)continue a;o.push(q)}}for(;e--;)r=i[e],r&&l(r);return k(i),k(p),o}function qc(a,b,c){var d=0,e=a?a.length:0;if("number"!=typeof b&&null!=b){var f=e;for(b=p.createCallback(b,c,3);f--&&b(a[f],f,a);)d++}else if(d=b,null==d||c)return a?a[e-1]:o;return m(a,Nd(0,e-d))}function rc(a,b,c){var d=a?a.length:0;for("number"==typeof c&&(d=(0>c?Nd(0,d+c):Od(c,d-1))+1);d--;)if(a[d]===b)return d;return-1}function sc(a){for(var b=arguments,c=0,d=b.length,e=a?a.length:0;++c<d;)for(var f=-1,g=b[c];++f<e;)a[f]===g&&(Dd.call(a,f--,1),e--);return a}function tc(a,b,c){a=+a||0,c="number"==typeof c?c:+c||1,null==b&&(b=a,a=0);for(var d=-1,e=Nd(0,td((b-a)/(c||1))),f=fd(e);++d<e;)f[d]=a,a+=c;return f}function uc(a,b,c){var d=-1,e=a?a.length:0,f=[];for(b=p.createCallback(b,c,3);++d<e;){var g=a[d];b(g,d,a)&&(f.push(g),Dd.call(a,d--,1),e--)}return f}function vc(a,b,c){if("number"!=typeof b&&null!=b){var d=0,e=-1,f=a?a.length:0;for(b=p.createCallback(b,c,3);++e<f&&b(a[e],e,a);)d++}else d=null==b||c?1:Nd(0,b);return m(a,d)}function wc(a,b,c,d){var e=0,f=a?a.length:e;for(c=c?p.createCallback(c,d,1):Tc,b=c(b);f>e;){var g=e+f>>>1;c(a[g])<b?e=g+1:f=g}return e}function xc(){return bb(Y(arguments,!0,!0))}function yc(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c=d&&d[b]===a?null:b,b=!1),null!=c&&(c=p.createCallback(c,d,3)),bb(a,b,c)}function zc(a){return ic(a,Rd.call(arguments,1))}function Ac(){for(var a=arguments.length>1?arguments:arguments[0],b=-1,c=a?Xb(Zb(a,"length")):0,d=fd(0>c?0:c);++b<c;)d[b]=Zb(a,b);return d}function Bc(a,b){for(var c=-1,d=a?a.length:0,e={};++c<d;){var f=a[c];b?e[f]=b[c]:f&&(e[f[0]]=f[1])}return e}function Cc(a,b){if(!zb(b))throw new od;return function(){return--a<1?b.apply(this,arguments):void 0}}function Dc(a,b){return arguments.length>2?db(a,17,Rd.call(arguments,2),null,b):db(a,1,null,null,b)}function Ec(a){for(var b=arguments.length>1?Y(arguments,!0,!1,1):qb(a),c=-1,d=b.length;++c<d;){var e=b[c];a[e]=db(a[e],1,null,null,a)}return a}function Fc(a,b){return arguments.length>2?db(b,19,Rd.call(arguments,2),null,a):db(b,3,null,null,a)}function Gc(){for(var a=arguments,b=a.length;b--;)if(!zb(a[b]))throw new od;return function(){for(var b=arguments,c=a.length;c--;)b=[a[c].apply(this,b)];return b[0]}}function Hc(a,b,c){var d=typeof a;if(null==a||"function"==d)return W(a,b,c);if("object"!=d)return function(b){return b[a]};var e=Zd(a),f=e[0],g=a[f];return 1!=e.length||g!==g||Ab(g)?function(b){for(var c=e.length,d=!1;c--&&(d=Z(b[e[c]],a[e[c]],null,!0)););return d}:function(a){var b=a[f];return g===b&&(0!==g||1/g==1/b)}}function Ic(a,b){return b="number"==typeof b?b:+b||a.length,db(a,4,null,null,null,b)}function Jc(a,b,c){var d,e,f,g,h,i,j,k=0,l=!1,m=!0;if(!zb(a))throw new od;if(b=Nd(0,b)||0,c===!0){var n=!0;m=!1}else Ab(c)&&(n=c.leading,l="maxWait"in c&&(Nd(b,c.maxWait)||0),m="trailing"in c?c.trailing:m);var p=function(){var c=b-(zd()-g);if(0>=c){e&&ud(e);var l=j;e=i=j=o,l&&(k=zd(),f=a.apply(h,d))}else i=Cd(p,c)},q=function(){i&&ud(i),e=i=j=o,(m||l!==b)&&(k=zd(),f=a.apply(h,d))};return function(){if(d=arguments,g=zd(),h=this,j=m&&(i||!n),l===!1)var c=n&&!i;else{e||n||(k=g);var o=l-(g-k);0>=o?(e&&(e=ud(e)),k=g,f=a.apply(h,d)):e||(e=Cd(q,o))}return i||b===l||(i=Cd(p,b)),c&&(f=a.apply(h,d)),f}}function Kc(a){if(!zb(a))throw new od;var b=Rd.call(arguments,1);return Cd(function(){a.apply(o,b)},1)}function Lc(a,b){if(!zb(a))throw new od;var c=Rd.call(arguments,2);return Cd(function(){a.apply(o,c)},b)}function Mc(a,b){if(!zb(a))throw new od;var c=function(){var d=c.cache,e=b?b.apply(this,arguments):s+arguments[0];return yd.call(d,e)?d[e]:d[e]=a.apply(this,arguments)};return c.cache={},c}function Nc(a){var b,c;if(!zb(a))throw new od;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}}function Oc(a){return db(a,16,Rd.call(arguments,1))}function Pc(a){return db(a,32,null,Rd.call(arguments,1))}function Qc(a,b,c){var d=!0,e=!0;if(!zb(a))throw new od;c===!1?d=!1:Ab(c)&&(d="leading"in c?c.leading:d,e="trailing"in c?c.trailing:e),T.leading=d,T.maxWait=b,T.trailing=e;var f=Jc(a,b,T);return f}function Rc(a,b){if(!zb(b))throw new od;return function(){var c=[a];return Ad.apply(c,arguments),b.apply(this,c)}}function Sc(a){return null==a?"":nd(a).replace(be,fb)}function Tc(a){return a}function Uc(a,b){var c=a,d=!b||zb(c);b||(c=q,b=a,a=p),Tb(qb(b),function(e){var f=a[e]=b[e];d&&(c.prototype[e]=function(){var b=this.__wrapped__,d=[b];Ad.apply(d,arguments);var e=f.apply(a,d);return b&&"object"==typeof b&&b===e?this:(e=new c(e),e.__chain__=this.__chain__,e)})})}function Vc(){return c._=rd,this}function Wc(a,b,c){var d=null==a,e=null==b;null==c&&("boolean"==typeof a&&e?(c=a,a=1):e||"boolean"!=typeof b||(c=b,e=!0)),d&&e&&(b=1),a=+a||0,e?(b=a,a=0):b=+b||0;var f=Qd();return c||a%1||b%1?Od(a+f*(b-a+parseFloat("1e-"+((f+"").length-1))),b):a+vd(f*(b-a+1))}function Xc(a,b){if(a){var c=a[b];return zb(c)?a[b]():c}}function Yc(a,b,c){var d=p.templateSettings;a||(a=""),c=de({},c,d);var e,f=de({},c.imports,d.imports),h=Zd(f),i=Mb(f),j=0,k=c.interpolate||E,l="__p += '",m=md((c.escape||E).source+"|"+k.source+"|"+(k===C?z:E).source+"|"+(c.evaluate||E).source+"|$","g");a.replace(m,function(b,c,d,f,h,i){return d||(d=f),l+=a.slice(j,i).replace(G,g),c&&(l+="' +\n__e("+c+") +\n'"),h&&(e=!0,l+="';\n"+h+";\n__p += '"),d&&(l+="' +\n((__t = ("+d+")) == null ? '' : __t) +\n'"),j=i+b.length,b}),l+="';\n";var n=c.variable,q=n;q||(n="obj",l="with ("+n+") {\n"+l+"\n}\n"),l=(e?l.replace(w,""):l).replace(x,"$1").replace(y,"$1;"),l="function("+n+") {\n"+(q?"":n+" || ("+n+" = {});\n")+"var __t, __p = '', __e = _.escape"+(e?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+l+"return __p\n}";var r="\n/*\n//# sourceURL="+(c.sourceURL||"/lodash/template/source["+I++ +"]")+"\n*/";try{var s=id(h,"return "+l+r).apply(o,i)}catch(t){throw t.source=l,t}return b?s(b):(s.source=l,s)}function Zc(a,b,c){a=(a=+a)>-1?a:0;var d=-1,e=fd(a);for(b=W(b,c,1);++d<a;)e[d]=b(d);return e}function $c(a){return null==a?"":nd(a).replace(ae,ib)}function _c(a){var b=++r;return nd(null==a?"":a)+b}function ad(a){return a=new q(a),a.__chain__=!0,a}function bd(a,b){return b(a),a}function cd(){return this.__chain__=!0,this}function dd(){return nd(this.__wrapped__)}function ed(){return this.__wrapped__}c=c?ab.defaults(X.Object(),c,ab.pick(X,H)):X;var fd=c.Array,gd=c.Boolean,hd=c.Date,id=c.Function,jd=c.Math,kd=c.Number,ld=c.Object,md=c.RegExp,nd=c.String,od=c.TypeError,pd=[],qd=ld.prototype,rd=c._,sd=md("^"+nd(qd.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),td=jd.ceil,ud=c.clearTimeout,vd=jd.floor,wd=id.prototype.toString,xd=sd.test(xd=ld.getPrototypeOf)&&xd,yd=qd.hasOwnProperty,zd=sd.test(zd=hd.now)&&zd||function(){return+new hd},Ad=pd.push,Bd=c.setImmediate,Cd=c.setTimeout,Dd=pd.splice,Ed=qd.toString,Fd=pd.unshift,Gd=function(){try{var a={},b=sd.test(b=ld.defineProperty)&&b,c=b(a,a,a)&&b}catch(d){}return c}(),Hd=sd.test(Hd=Ed.bind)&&Hd,Id=sd.test(Id=ld.create)&&Id,Jd=sd.test(Jd=fd.isArray)&&Jd,Kd=c.isFinite,Ld=c.isNaN,Md=sd.test(Md=ld.keys)&&Md,Nd=jd.max,Od=jd.min,Pd=c.parseInt,Qd=jd.random,Rd=pd.slice,Sd=sd.test(c.attachEvent),Td=Hd&&!/\n|true/.test(Hd+Sd),Ud={};Ud[K]=fd,Ud[L]=gd,Ud[M]=hd,Ud[N]=id,Ud[P]=ld,Ud[O]=kd,Ud[Q]=md,Ud[R]=nd,q.prototype=p.prototype;var Vd=p.support={};Vd.fastBind=Hd&&!Td,Vd.funcDecomp=!sd.test(c.WinRTError)&&F.test(n),Vd.funcNames="string"==typeof id.name,p.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:C,variable:"",imports:{_:p}},Id||(eb=function(a){if(Ab(a)){j.prototype=a;var b=new j;j.prototype=null}return b||{}});var Wd=Gd?function(a,b){U.value=b,Gd(a,"__bindData__",U)}:j,Xd=Jd||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&Ed.call(a)==K||!1},Yd=function(a){var b,c=a,d=[];if(!c)return d;if(!V[typeof a])return d;for(b in c)yd.call(c,b)&&d.push(b);return d},Zd=Md?function(a){return Ab(a)?Md(a):[]}:Yd,$d={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},_d=sb($d),ae=md("("+Zd(_d).join("|")+")","g"),be=md("["+Zd($d).join("")+"]","g"),ce=function(a,b,c){var d,e=a,f=e;if(!e)return f;var g=arguments,h=0,i="number"==typeof c?2:g.length;if(i>3&&"function"==typeof g[i-2])var j=W(g[--i-1],g[i--],2);else i>2&&"function"==typeof g[i-1]&&(j=g[--i]);for(;++h<i;)if(e=g[h],e&&V[typeof e])for(var k=-1,l=V[typeof e]&&Zd(e),m=l?l.length:0;++k<m;)d=l[k],f[d]=j?j(f[d],e[d]):e[d];return f},de=function(a,b,c){var d,e=a,f=e;if(!e)return f;for(var g=arguments,h=0,i="number"==typeof c?2:g.length;++h<i;)if(e=g[h],e&&V[typeof e])for(var j=-1,k=V[typeof e]&&Zd(e),l=k?k.length:0;++j<l;)d=k[j],"undefined"==typeof f[d]&&(f[d]=e[d]);return f},ee=function(a,b,c){var d,e=a,f=e;if(!e)return f;if(!V[typeof e])return f;b=b&&"undefined"==typeof c?b:W(b,c,3);for(d in e)if(b(e[d],d,a)===!1)return f;return f},fe=function(a,b,c){var d,e=a,f=e;if(!e)return f;if(!V[typeof e])return f;b=b&&"undefined"==typeof c?b:W(b,c,3);for(var g=-1,h=V[typeof e]&&Zd(e),i=h?h.length:0;++g<i;)if(d=h[g],b(e[d],d,a)===!1)return f;return f},ge=function(a){if(!a||Ed.call(a)!=P)return!1;var b=a.valueOf,c="function"==typeof b&&(c=xd(b))&&xd(c);return c?a==c||xd(a)==c:hb(a)},he=cb(function(a,b,c){yd.call(a,c)?a[c]++:a[c]=1}),ie=cb(function(a,b,c){(yd.call(a,c)?a[c]:a[c]=[]).push(b)}),je=cb(function(a,b,c){a[c]=b}),ke=Qb;Td&&$&&"function"==typeof Bd&&(Kc=function(a){if(!zb(a))throw new od;return Bd.apply(c,arguments)});var le=8==Pd(v+"08")?Pd:function(a,b){return Pd(Fb(a)?a.replace(D,""):a,b||0)};return p.after=Cc,p.assign=ce,p.at=Nb,p.bind=Dc,p.bindAll=Ec,p.bindKey=Fc,p.chain=ad,p.compact=hc,p.compose=Gc,p.countBy=he,p.createCallback=Hc,p.curry=Ic,p.debounce=Jc,p.defaults=de,p.defer=Kc,p.delay=Lc,p.difference=ic,p.filter=Qb,p.flatten=mc,p.forEach=Tb,p.forEachRight=Ub,p.forIn=ee,p.forInRight=ob,p.forOwn=fe,p.forOwnRight=pb,p.functions=qb,p.groupBy=ie,p.indexBy=je,p.initial=oc,p.intersection=pc,p.invert=sb,p.invoke=Vb,p.keys=Zd,p.map=Wb,p.max=Xb,p.memoize=Mc,p.merge=Hb,p.min=Yb,p.omit=Ib,p.once=Nc,p.pairs=Jb,p.partial=Oc,p.partialRight=Pc,p.pick=Kb,p.pluck=Zb,p.pull=sc,p.range=tc,p.reject=ac,p.remove=uc,p.rest=vc,p.shuffle=cc,p.sortBy=fc,p.tap=bd,p.throttle=Qc,p.times=Zc,p.toArray=gc,p.transform=Lb,p.union=xc,p.uniq=yc,p.values=Mb,p.where=ke,p.without=zc,p.wrap=Rc,p.zip=Ac,p.zipObject=Bc,p.collect=Wb,p.drop=vc,p.each=Tb,p.eachRight=Ub,p.extend=ce,p.methods=qb,p.object=Bc,p.select=Qb,p.tail=vc,p.unique=yc,p.unzip=Ac,Uc(p),p.clone=kb,p.cloneDeep=lb,p.contains=Ob,p.escape=Sc,p.every=Pb,p.find=Rb,p.findIndex=jc,p.findKey=mb,p.findLast=Sb,p.findLastIndex=kc,p.findLastKey=nb,p.has=rb,p.identity=Tc,p.indexOf=nc,p.isArguments=jb,p.isArray=Xd,p.isBoolean=tb,p.isDate=ub,p.isElement=vb,p.isEmpty=wb,p.isEqual=xb,p.isFinite=yb,p.isFunction=zb,p.isNaN=Bb,p.isNull=Cb,p.isNumber=Db,p.isObject=Ab,p.isPlainObject=ge,p.isRegExp=Eb,p.isString=Fb,p.isUndefined=Gb,p.lastIndexOf=rc,p.mixin=Uc,p.noConflict=Vc,p.parseInt=le,p.random=Wc,p.reduce=$b,p.reduceRight=_b,p.result=Xc,p.runInContext=n,p.size=dc,p.some=ec,p.sortedIndex=wc,p.template=Yc,p.unescape=$c,p.uniqueId=_c,p.all=Pb,p.any=ec,p.detect=Rb,p.findWhere=Rb,p.foldl=$b,p.foldr=_b,p.include=Ob,p.inject=$b,fe(p,function(a,b){p.prototype[b]||(p.prototype[b]=function(){var b=[this.__wrapped__],c=this.__chain__;Ad.apply(b,arguments);var d=a.apply(p,b);return c?new q(d,c):d})}),p.first=lc,p.last=qc,p.sample=bc,p.take=lc,p.head=lc,fe(p,function(a,b){var c="sample"!==b;p.prototype[b]||(p.prototype[b]=function(b,d){var e=this.__chain__,f=a(this.__wrapped__,b,d);return e||null!=b&&(!d||c&&"function"==typeof b)?new q(f,e):f})}),p.VERSION="2.2.1",p.prototype.chain=cd,p.prototype.toString=dd,p.prototype.value=ed,p.prototype.valueOf=ed,Tb(["join","pop","shift"],function(a){var b=pd[a];p.prototype[a]=function(){var a=this.__chain__,c=b.apply(this.__wrapped__,arguments);return a?new q(c,a):c}}),Tb(["push","reverse","sort","unshift"],function(a){var b=pd[a];p.prototype[a]=function(){return b.apply(this.__wrapped__,arguments),this}}),Tb(["concat","slice","splice"],function(a){var b=pd[a];p.prototype[a]=function(){return new q(b.apply(this.__wrapped__,arguments),this.__chain__)}}),p}var o,p=[],q=[],r=0,s=+new Date+"",t=75,u=40,v=" 	\f\n\r\u2028\u2029",w=/\b__p \+= '';/g,x=/\b(__p \+=) '' \+/g,y=/(__e\(.*?\)|\b__t\)) \+\n'';/g,z=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,A=/\w*$/,B=/^function[ \n\r\t]+\w/,C=/<%=([\s\S]+?)%>/g,D=RegExp("^["+v+"]*0+(?=.$)"),E=/($^)/,F=/\bthis\b/,G=/['\n\r\t\u2028\u2029\\]/g,H=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setImmediate","setTimeout"],I=0,J="[object Arguments]",K="[object Array]",L="[object Boolean]",M="[object Date]",N="[object Function]",O="[object Number]",P="[object Object]",Q="[object RegExp]",R="[object String]",S={};S[N]=!1,S[J]=S[K]=S[L]=S[M]=S[O]=S[P]=S[Q]=S[R]=!0;var T={leading:!1,maxWait:0,trailing:!1},U={configurable:!1,enumerable:!1,value:null,writable:!1},V={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},W={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},X=V[typeof window]&&window||this,Y=V[typeof exports]&&exports&&!exports.nodeType&&exports,Z=V[typeof module]&&module&&!module.nodeType&&module,$=Z&&Z.exports===Y&&Y,_=V[typeof global]&&global;!_||_.global!==_&&_.window!==_||(X=_);var ab=n();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(X._=ab,define(function(){return ab})):Y&&Z?$?(Z.exports=ab)._=ab:Y._=ab:X._=ab}.call(this),function(a){function b(a){return e[125613361*(a&-a)>>27&31]}function c(a,b){return b>a?-1:a>b?1:a>=b?0:0/0}var d=[1,1,3,5,9,15,25,41,67,109,177,287,465,753,1219,1973,3193,5167,8361,13529,21891,35421,57313,92735,150049,242785,392835,635621,1028457,1664079,2692537,4356617,7049155,11405773,18454929,29860703,48315633,78176337,126491971,204668309,331160281,535828591,866988873];a.smoothsort=function(){function a(a,c,g){if(1===arguments.length&&(c=0,g=a.length-1),g>d[32])throw{error:"Maximum length exceeded for smoothsort implementation."};for(var h,i=c,j=1,k=1;g>i;)3===(3&j)?(f(a,k,i),j>>>=2,k+=2):(d[k-1]>=g-i?e(a,j,k,i,!1):f(a,k,i),1===k?(j<<=1,k--):(j<<=k-1,k=1)),j|=1,i++;for(e(a,j,k,i,!1);1!==k||1!==j;)1>=k?(h=b(-2&j),j>>>=h,k+=h):(j<<=2,j^=7,k-=2,e(a,j>>>1,k+1,i-d[k]-1,!0),e(a,j,k,i-1,!0)),i--}function e(a,c,e,h,i){for(var j,k,l,m,n,o=a[h];!(1===c||(j=h-d[e],g(k=a[j],o)<=0)||!i&&e>1&&(l=h-1,m=h-1-d[e-2],g(a[l],k)>=0||g(a[m],k)>=0));)a[h]=k,h=j,n=b(-2&c),c>>>=n,e+=n,i=!1;i||(a[h]=o,f(a,e,h))}function f(a,b,c){for(var e,f,h,i,j=a[c];b>1&&(e=c-1,f=c-1-d[b-2],h=a[e],i=a[f],!(g(j,i)>=0&&g(j,h)>=0));)g(i,h)>=0?(a[c]=i,c=f,b--):(a[c]=h,c=e,b-=2);a[c]=j}var g=c;return a.compare=function(b){return arguments.length?(g=b,a):g},a};var e=[0,1,28,2,29,14,24,3,30,22,20,15,25,17,4,8,31,27,13,23,21,19,16,7,26,12,18,6,11,5,10,9]}("undefined"!=typeof exports?exports:window),Smart={},function(){function a(a){for(var b in a)this[b]!==a[b]&&(this[b]=a[b]);return this}Smart.Class=function(b,c){c||(c=b);var d=c.hasOwnProperty("initialize")&&c.initialize;return d||(d=function(){this.initialize&&this.initialize.apply(this,arguments)}),d.prototype=b,d.extend=a,d.implement=function(b){return a.call(this.prototype,b)},c!==b&&d.implement(c),d}}(),function(){function a(a,b,c,d){return b>a?a=b:a>c&&(a=c),a.toFixed(d)}Smart.Color={parseRGB:function(a){if("string"!=typeof a)return null;a=a.replace(/\s+/g,"");var b=a.match(/^#?([A-Fa-f0-9]{2})([A-Fa-f0-9]{2})([A-Fa-f0-9]{2})$/);if(b)return b.slice(1).map(function(a){return parseInt(a,16)});var c=a.match(/^#?([A-Fa-f0-9])([A-Fa-f0-9])([A-Fa-f0-9])$/);if(c)return c.slice(1).map(function(a){return parseInt(a,16)});var d=a.match(/^rgba?\((\d{1,3}),(\d{1,3}),(\d{1,3})(?:,(\d?\.?\d*))?\)$/);return d?d.slice(1,d[4]?5:4).map(function(a){return parseFloat(a)}):null},toRGB:function(b){return 4===b.length?"rgba("+a(b[0],0,255,0)+","+a(b[1],0,255,0)+","+a(b[2],0,255,0)+","+a(b[3],0,1,2)+")":3===b.length?"rgb("+a(b[0],0,255,0)+","+a(b[1],0,255,0)+","+a(b[2],0,255,0)+")":null},parseHSL:function(a){if("string"!=typeof a)return null;a=a.replace(/\s+/g,"");var b=a.match(/^hsla?\((\d{1,3}),(\d{1,3})%,(\d{1,3})%(?:,(\d?\.?\d*))?\)$/);return b?b.slice(1,b[4]?5:4).map(function(a){return parseFloat(a)}):null},toHSL:function(b){var c=b[0];return 0>c?c=360- -c%360:c>=360&&(c%=360),4===b.length?"hsla("+c.toFixed(0)+","+a(b[1],0,100,0)+"%,"+a(b[2],0,100,0)+"%,"+a(b[3],0,1,2)+")":3===b.length?"hsl("+c.toFixed(0)+","+a(b[1],0,100,0)+"%,"+a(b[2],0,100,0)+"%)":null}},_.extend(Smart.Color,{_shift:function(a,b,c){return a=Smart.Color.parseHSL(a),a[c]+=b,Smart.Color.toHSL(a)},darken:function(a,b){return this._shift(a,-b,2)},lighten:function(a,b){return this._shift(a,b,2)},spin:function(a,b){return this._shift(a,b,0)},saturate:function(a,b){return this._shift(a,b,1)},desaturate:function(a,b){return this._shift(a,-b,1)}})}(),Smart.Disposable=Smart.Class({onDispose:function(a){if(null===this._onDispose)throw new Error("Object is already disposed!");void 0===this._onDispose?this._onDispose=[a]:this._onDispose.push(a)},dispose:function(){if(null===this._onDispose)throw new Error("Object is already disposed!");this._onDispose&&(this._onDispose.forEach(function(a){a.call(this)},this),this._onDispose=null)}}),Smart.Drawing=Smart.Class({addCommand:null}),function(){var a=["moveTo","lineTo","arc","arcTo","quadraticCurveTo","bezierCurveTo","beginPath","closePath","fill","stroke","rect","fillRect","strokeRect","clearRect","fillText","strokeText","scale","rotate","translate","transform","drawImage","save","restore"],b=["strokeStyle","fillStyle","lineWidth","lineCap","lineJoin","miterLimit"];a.forEach(function(a){Smart.Drawing.prototype[a]=function(){var b=arguments;return this.addCommand(function(c){c[a].apply(c,b)}),this}}),b.forEach(function(a){Smart.Drawing.prototype[a]=function(b){return this.addCommand(function(c){c[a]=b}),this}})}(),function(){_.extend(Smart.Drawing.prototype,{endPath:function(a){return a.fillStyle&&(this.fillStyle(a.fillStyle),this.fill()),a.strokeStyle&&(this.strokeStyle(a.strokeStyle),this.lineWidth(a.lineWidth||1),a.lineCap&&this.lineCap(a.lineCap),a.lineJoin&&this.lineJoin(a.lineJoin),a.miterLimit&&this.miterLimit(a.miterLimit),this.stroke()),this},roundRect:function(a,b,c,d,e){var f=Math.PI/2,g=3*f,h=0,i=f,j=Math.PI,k=a+e,l=a+c-e,m=b+e,n=b+d-e;return this.arc(l,m,e,g,h).arc(l,n,e,h,i).arc(k,n,e,i,j).arc(k,m,e,j,g).lineTo(l,b),this},circle:function(a,b,c){return this.arc(a,b,c,0,2*Math.PI),this},star:function(a,b,c,d,e,f){var g=Smart.Drawing.createStarPolygon(a,b,c,d,e,f);return this.polygon(g,!1),this},polygon:function(a){var b=a[0];this.moveTo(b[0],b[1]);for(var c=1,d=a.length;d>c;c++){var e=a[c];this.lineTo(e[0],e[1])}return this},drawingQueue:function(a){return this.addCommand(function(b){a.draw(b)}),this},fillPattern:function(a,b,c,d,e,f,g){return f&&g?this.save().translate(f,g).fillStyle(a).fillRect(b-f,c-g,d,e).restore():this.fillStyle(a).fillRect(b,c,d,e),this}})}(),function(){_.extend(Smart.Drawing,{createStarPolygon:function(a,b,c,d,e,f){if("object"==typeof a){var g=a;a=g.x,b=g.y,c=g.radius,d=g.sides,e=g.pointSize,f=g.angle}if(!c||!d)return null;a||(a=0),b||(b=0),e||(e=0),f||(f=0),e=1-e,f/=180/Math.PI;for(var h=Math.PI/d,i=[],j=0;d>j;j++)f+=h,1!=e&&i.push([a+Math.cos(f)*c*e,b+Math.sin(f)*c*e]),f+=h,i.push([a+Math.cos(f)*c,b+Math.sin(f)*c]);return i},polygonFromAngles:function(a,b,c,d){for(var e=[],f=90,g=Math.PI/-180,h=0,i=d.length;i>h;h++){var j=(d[h]+f)*g,k=Math.cos(j)*c,l=Math.sin(j)*c;e.push([k+a,l+b])}return e},createImage:function(a,b,c){var d=this._createCanvas(a,b),e=d.getContext("2d"),f=new Smart.DrawingContext(e);return c(f),d},createPattern:function(a,b,c){var d=this._createCanvas(a,b),e=d.getContext("2d"),f=new Smart.DrawingContext(e);c(f);var g=e.createPattern(d,"repeat");return g},_createCanvas:function(a,b){var c=document.createElement("canvas");return c.width=a,c.height=b,c}})}(),Smart.DrawingContext=Smart.Class(new Smart.Drawing,{initialize:function(a){this.context=a},addCommand:function(a){a(this.context)},setContext:function(a){this.context=a}}),Smart.DrawingQueue=Smart.Class(new Smart.Drawing,{initialize:function(){this._commands=[]},addCommand:function(a){this._commands.push(a)},draw:function(a){this._commands.forEach(function(b){b(a)})},clear:function(){this._commands.length=0}}),Smart.Events=Smart.Class({addEvent:function(a,b){this.$events||(this.$events={}),this.$events[a]||(this.$events[a]=[]),this.$events[a].push(b)},fireEvent:function(a,b){var c=this.$events&&this.$events[a];if(c){b||(b=[]);for(var d=0,e=c.length;e>d;d++)c[d].apply(null,b)}},implementEvents:function(a){return _.forOwn(a,function(a,b){this[b]=function(b){this.addEvent(a,b)}},this),this}}),Smart.Physics={applyVelocity:function(a,b,c){b.x&&(a.x+=b.x*c),b.y&&(a.y+=b.y*c)},applyAcceleration:function(a,b,c){if(b.x||b.y){var d=c*c/2;b.x&&(a.x+=b.x*d),b.y&&(a.y+=b.y*d)}},applyAccelerationToVelocity:function(a,b){a.x+=b.x,a.y+=b.y},applyFrictionToVelocity:function(a,b,c){var d=.5,e=Math.pow(1-b,c);
a.x<d&&a.x>-d?a.x=0:a.x*=e,a.y<d&&a.y>-d?a.y=0:a.y*=e},bounceOffWalls:function(a,b,c,d,e){var f=this.checkBounds(a,b,d);return f&&this.bounceOffWall(f,a,c,e),f},checkBounds:function(a,b,c){var d=a.x-b-c.x;if(0>d)return{edge:"left",distance:d};var e=a.x+b-(c.x+c.width);if(e>0)return{edge:"right",distance:e};var f=a.y-b-c.y;if(0>f)return{edge:"top",distance:f};var g=a.y+b-(c.y+c.height);return g>0?{edge:"bottom",distance:g}:null},bounceOffWall:function(a,b,c,d){switch(a.edge){case"left":b.x-=2*a.distance,c.x*=-1;break;case"right":b.x-=2*a.distance,c.x*=-1;break;case"top":b.y-=2*a.distance,c.y*=-1;break;case"bottom":b.y-=2*a.distance,c.y*=-1}d&&(c.x*=1-d,c.y*=1-d)},bounceOffPoint:function(a,b,c,d,e){var f={x:a.x-c.x,y:a.y-c.y},g=Smart.Point.hypotenuse(b),h=Smart.Point.hypotenuse(f),i=g/h,j=d/h;b.x=f.x*i,b.y=f.y*i,a.x=c.x+f.x*j,a.y=c.y+f.y*j,e&&(b.x*=1-e,b.y*=1-e)},sortByLocation:function(a){return Smart.Sort.smoothSort(a,Smart.Physics._compareLocations)},_compareLocations:function(a,b){return a.location.x-b.location.x},detectCollisions:function(a,b,c,d){for(var e=a.length-1,f=b.length-1,g=a[e],h=b[f];e>=0&&f>=0;){var i=g.location.x-h.location.x;if(i>c)e--,g=a[e];else if(-c>i)f--,h=b[f];else{for(var j=f;j>=0&&(i=g.location.x-h.location.x,!(-c>i));){var k=g.location.y-h.location.y;if(k>=-c&&c>=k){var l=Math.sqrt(i*i+k*k);c>=l&&d(g,h,e,j,l)}j--,h=b[j]}h=b[f],e--,g=a[e]}}},findClosestPoint:function(a,b){for(var c=-1,d=Number.MAX_VALUE,e=b.length;e--;){var f=b[e],g=f.x-a.x;if(!(Math.abs(g)>=d)){var h=f.y-a.y;if(!(Math.abs(h)>=d)){var i=Smart.Point.hypotenuseXY(g,h);d>i&&(d=i,c=e)}}}return c},trajectory:function(a,b,c,d){var e,f=c,g=d,h=b,i=a,j={x:h.x-i.x,y:h.y-i.y},k=function(a){return a*a},l=k(f.x)+k(f.y)-k(g),m=2*(f.x*j.x+f.y*j.y),n=k(j.x)+k(j.y),o=Smart.Physics.solveQuadratic(l,m,n);e=0===o.length||o[0]<=0&&o[1]<=0?1:o[0]>0&&o[0]<o[1]?o[0]:o[1];var p={x:j.x+f.x*e,y:j.y+f.y*e};return Smart.Point.scaleVector(p,d)},solveQuadratic:function(a,b,c){var d=b*b-4*a*c;if(0>d)return[];var e=2*a,f=-b/e,g=Math.sqrt(d)/e;return[f+g,f-g]}},function(){var a=Math.PI/180;Smart.Point={subtract:function(a,b){return{x:a.x-b.x,y:a.y-b.y}},multiply:function(a,b){return{x:a.x*b,y:a.y*b}},clonePoint:function(a){return{x:a.x,y:a.y}},hypotenuse:function(a){return Math.sqrt(a.x*a.x+a.y*a.y)},hypotenuseXY:function(a,b){return Math.sqrt(a*a+b*b)},pointIsInBounds:function(a,b){return b.x<=a.x&&a.x<=b.x+b.width&&b.y<=a.y&&a.y<=b.y+b.height},distanceTest:function(a,b,c){var d,e;if(d=a.x-b.x,Math.abs(d)<=c&&(e=a.y-b.y,Math.abs(e)<=c)){var f={x:d,y:e};if(f.distance=Smart.Point.hypotenuse(f),f.distance<=c)return f}return null},rotate:function(b,c){var d=c*a,e=Math.cos(d),f=Math.sin(d),g=b.x*e-b.y*f,h=b.x*f+b.y*e;b.x=g,b.y=h},fromAngle:function(b,c){var d=b*a;return{x:Math.cos(d)*c,y:Math.sin(d)*c}},scaleVector:function(a,b){var c=b/Smart.Point.hypotenuse(a);return{x:a.x*c,y:a.y*c}},angleFromVector:function(b){return 180-Math.atan2(b.x,b.y)/a}}}(),Smart.Sort={smoothSort:function(a,b){return this._smoothsort||(this._smoothsort=new window.smoothsort),this._smoothsort.compare(b),this._smoothsort(a),a},smoothSortByProperty:function(a,b){var c=function(a,c){return a=a[b],c=c[b],c>a?-1:a>c?1:0};return Smart.Sort.smoothSort(a,c)}},Smart.Animation=Smart.Class({initialize:function(){this._actions=[],this._position=0,this._animEvent={position:0,loops:0,keyframe:0,stillRunning:!1,clearCurrentActions:function(a){this._clearCurrentActions=void 0===a||a},_clearCurrentActions:!1,stopUpdate:function(a){this._stopUpdate=void 0===a||a},_stopUpdate:!1}},update:function(a){this._position+=a;var b=this._animEvent;b.position=this._position,b.stillRunning=!1;for(var c=0;c<this._actions.length;c++)if(this._actions[c](b,this),b._clearCurrentActions&&(b._clearCurrentActions=!1,b.position=this._position=0,this._actions.splice(0,c+1),c=-1),b._stopUpdate){b._stopUpdate=!1;break}return b.stillRunning===!1&&this._actions.length&&(this._actions.length=0),b},addAction:function(a){return this._actions.push(a),this},queue:function(a){return this.addAction(function(b){b.stillRunning===!0?b.stopUpdate():a&&a(b)===!1?(b.stopUpdate(),b.stillRunning=!0):b.clearCurrentActions()})},cancelAnimation:function(){this._actions.length=0}}),_.extend(Smart.Animation.prototype,{move:function(a,b){var c=function(d){return(c=Smart.Keyframes.fromFunction(b)||Smart.Keyframes.fromPoints(b)||Smart.Keyframes.fromPoints([Smart.Point.clonePoint(a),b]))(d)};return this.addAction(function(b){var d=c(b.position);a.x=d.x,a.y=d.y})},fade:function(a,b){var c=function(d){return(c=Smart.Keyframes.fromFunction(b)||Smart.Keyframes.fromNumbers(b)||Smart.Keyframes.fromNumbers([void 0!==a.alpha?a.alpha:1,b]))(d)};return this.addAction(function(b){a.alpha=c(b.position)})},color:function(a,b){var c=function(d){return(c=Smart.Keyframes.fromFunction(b)||Smart.Keyframes.fromColors(b)||Smart.Keyframes.fromColors([a.color,b]))(d)};return this.addAction(function(b){a.color=c(b.position)})},scale:function(a,b){var c=function(d){return(c=Smart.Keyframes.fromFunction(b)||Smart.Keyframes.fromNumbers(b)||Smart.Keyframes.fromNumbers([void 0!==a.scaleX?a.scaleX:1,b]))(d)};return this.addAction(function(b){a.scaleX=a.scaleY=c(b.position)})},rotate:function(a,b){var c=function(d){return(c=Smart.Keyframes.fromFunction(b)||Smart.Keyframes.fromNumbers(b)||Smart.Keyframes.fromNumbers([void 0!==a.rotation?a.rotation:1,b]))(d)};return this.addAction(function(b){a.rotation=c(b.position)})},tween:function(a,b){var c=Smart.Keyframes.fromFunction(b)||Smart.Keyframes.fromNumbers(b)||Smart.Keyframes.fromNumbers([b]);return this.addAction(function(b){a(c(b.position))})},queueDispose:function(a){return this.queue(function(){a.dispose()})}}),_.extend(Smart.Animation.prototype,{defaultEasing:"swing",ease:function(a){return a=Smart.Animation.Easing.from(a||this.defaultEasing),this.addAction(function(b){var c=b.position;b.position=0>=c?0:c>=1?1:.5>=c?a(2*c)/2:1-a(2*(1-c))/2})},easeIn:function(a){return a=Smart.Animation.Easing.from(a||this.defaultEasing),this.addAction(function(b){var c=b.position;b.position=0>=c?0:c>=1?1:a(c)})},easeOut:function(a){return a=Smart.Animation.Easing.from(a||this.defaultEasing),this.addAction(function(b){var c=b.position;b.position=0>=c?0:c>=1?1:1-a(1-c)})}}),Smart.Animation.Easing={from:function(a){return"function"==typeof a?a:Smart.Animation.Easing[a]},linear:function(a){return a},quad:function(a){return a*a},cube:function(a){return Math.pow(a,3)},quart:function(a){return Math.pow(a,4)},quint:function(a){return Math.pow(a,5)},sine:function(a){return(Math.cos(a*Math.PI)-1)/-2},swing:function(a){return a-Math.sin(a*Math.PI)/Math.PI}},_.extend(Smart.Animation.prototype,{duration:function(a){return this.addAction(function(b){b.position>=a?b.position=1:(b.position=b.position/a,b.stillRunning=!0)})},loop:function(a,b){return void 0===b&&(b=Number.MAX_VALUE),this.addAction(function(c){for(;c.position>=a;)c.position-=a,c.loops++;c.loops>=b?(c.loops=b,c.position=1):(c.position=c.position/a,c.stillRunning=!0)})},continuous:function(a){return this.addAction(function(b){b.position=b.position/a,b.stillRunning=!0})},delay:function(a){return this.queue(function(b){return b.position>=a})},savePosition:function(){return this.addAction(function(a){a.savedPosition=a.position})},restorePosition:function(){return this.addAction(function(a){a.position=a.savedPosition})}}),Smart.Animations=Smart.Class({addAnimation:function(a){return a||(a=new Smart.Animation),this.animations?this.animations.push(a):this.animations=[a],a},update:function(a){if(this.animations)for(var b=this.animations.length;b--;){var c=this.animations[b].update(a);if(!c.stillRunning){var d=this.animations.pop();b<this.animations.length&&(this.animations[b]=d)}}}}),Smart.Interpolate={from:function(a,b){var c=typeof a;if(c!==typeof b)return null;if("number"===c)return Smart.Interpolate.numbers(a,b);if("string"===c)return Smart.Interpolate.colors(a,b);if("object"===c){if("number"==typeof c.length)return Smart.Interpolate.arrays(a,b);if("x"in c&&"y"in c)return Smart.Interpolate.points(a,b)}},numbers:function(a,b){var c=b-a;return function(b){return a+b*c}},points:function(a,b){return function(c){return{x:a.x+c*(b.x-a.x),y:a.y+c*(b.y-a.y)}}},colors:function(a,b){var c=Smart.Color.parseHSL(a);if(c){var d=Smart.Color.parseHSL(b),e=Smart.Interpolate.arrays(c,d);return function(a){return Smart.Color.toHSL(e(a))}}var f=Smart.Color.parseRGB(a);if(f){var g=Smart.Color.parseRGB(b),h=Smart.Interpolate.arrays(f,g);return function(a){return Smart.Color.toRGB(h(a))}}return null},arrays:function(a,b){for(var c=Math.min(a.length,b.length),d=new Array(c),e=c;e--;)d[e]=Smart.Interpolate.from(a[e],b[e]);return function(a){for(var b=new Array(c),e=c;e--;)b[e]=d[e](a);return b}},keyframes:function(a,b){var c=a.length-1;if(1===c&&b)return b(a[0],a[1]);var d,e=-1;return function(f){if(0>=f)return a[0];if(f>=1)return a[c+1];var g=f*c,h=Math.floor(g);if(!b)return a[h];e!==h&&(e=h,d=b(a[h],a[h+1]));var i=g-h;return d(i)}}},Smart.Keyframes={fromFunction:function(a){return _.isFunction(a)?a:null},fromNumbers:function(a){return _.isArray(a)?Smart.Interpolate.keyframes(a,Smart.Interpolate.numbers):null},fromPoints:function(a){return _.isArray(a)?Smart.Interpolate.keyframes(a,Smart.Interpolate.points):null},fromColors:function(a){return _.isArray(a)?Smart.Interpolate.keyframes(a,Smart.Interpolate.colors):null},step:function(a){return _.isArray(a)?Smart.Interpolate.keyframes(a,!1):null}};var console=window.console||{},noop=function(){};_.forEach(["log","debug","warn","error","assert"],function(a){!a in console&&(console[a]=noop)}),_.extend(createjs.Graphics.prototype,{beginStyle:function(a){var b=this;return a.fillColor&&b.beginFill(a.fillColor),a.strokeColor&&b.beginStroke(a.strokeColor),a.strokeWidth&&b.setStrokeStyle(a.strokeWidth,a.strokeCaps,a.strokeJoints,a.strokeMiter),this},endStyle:function(a){var b=this;return a.fillColor&&b.endFill(),a.strokeColor&&b.endStroke(),this},drawPolygon:function(a){var b=this,c=a[0][0],d=a[0][1];b.moveTo(c,d);for(var e=1,f=a.length;f>e;e++){var g=a[e][0],h=a[e][1];b.lineTo(g,h)}return b.lineTo(c,d),this}}),_.extend(createjs.DisplayObject.prototype,Smart.Disposable.prototype),_.extend(createjs.DisplayObject.prototype,{moveTo:function(a,b){this.x=a,this.y=b},scaleTo:function(a,b){void 0===b&&(b=a),this.scaleX=a,this.scaleY=b},toggleVisible:function(a){void 0===a&&(a=!this.visible),this.visible=a}}),_.mixin({eliminate:function(a,b){var c=a.indexOf(b);-1!==c&&a.splice(c,1)}}),XQuestGame={},XQuestGame.BaseScene=Smart.Class(new Smart.Disposable,{initialize:function(){},BaseScene_initialize:function(){this.debugStats={sceneItems:[]},this._setupEvents(),this._setupPhases()},_setupEvents:function(){this._events=new Smart.Events},_setupPhases:function(){this.phases={input:[],move:[],act:[],draw:[]}},updateScene:function(a){if(!this.scenePaused){var b=this.getDefaultInputState&&this.getDefaultInputState()||{};_.forEachRight(this.phases.input,function(c){c.onInput(a,b)}),_.forEachRight(this.phases.move,function(c){c.onMove(a,b)}),_.forEachRight(this.phases.act,function(b){b.onAct(a)})}_.forEachRight(this.phases.draw,function(b){b.onDraw(a)})},addSceneItem:function(a){a.onInput&&this.phases.input.push(a),a.onMove&&this.phases.move.push(a),a.onAct&&this.phases.act.push(a),a.onDraw&&this.phases.draw.push(a),this.debugStats.sceneItems.push(a)},removeSceneItem:function(a){a.onInput&&_.eliminate(this.phases.input,a),a.onMove&&_.eliminate(this.phases.move,a),a.onAct&&_.eliminate(this.phases.act,a),a.onDraw&&_.eliminate(this.phases.draw,a),_.eliminate(this.debugStats.sceneItems,a)},implementSceneEvents:function(a){_.forOwn(a,function(a,b){this[b]=function(b){this._events.addEvent(a,b)}},this)},fireSceneEvent:function(a,b){this._events.fireEvent(a,b)}}),function(){var a={onNewGame:"NewGame",onNewLevel:"NewLevel",onPlayerKilled:"PlayerKilled",onGameOver:"GameOver",onNextLevel:"NextLevel",onAllCrystalsGathered:"AllCrystalsGathered",onGamePaused:"GamePaused",onPowerupChanged:"PowerupChanged"};XQuestGame.ArcadeGame=Smart.Class(new XQuestGame.BaseScene,{player:null,levelGraphics:null,activePowerups:null,scenePaused:!1,stats:null,powerCrystals:null,initialize:function(a){this.BaseScene_initialize(),this.addSceneItem(this),this.gfx=a,this.addSceneItem(this.gfx),this.game=this,this._events=new Smart.Events,this.stats={},this._setupLevelGraphics(),this._setupPlayer(),this._setupEnemyFactory(),this._setupCrystals(),this._setupPowerCrystals(),this._setupProjectiles(),this._setupHUD(),this.activePowerups={}},_setupLevelGraphics:function(){this.levelGraphics=this.game.gfx.createLevelGraphics()},_setupPlayer:function(){this.player=new XQuestGame.Player(this.game),this.game.addSceneItem(this.player)},_setupEnemyFactory:function(){this.enemies=new XQuestGame.EnemyFactory(this.game),this.addSceneItem(this.enemies)},_setupCrystals:function(){this.crystals=new XQuestGame.CrystalFactory(this.game)},_setupPowerCrystals:function(){this.powerCrystals=new XQuestGame.PowerupFactory(this.game)},_setupProjectiles:function(){this.projectiles=new XQuestGame.Projectiles(this.game)},_setupHUD:function(){this.hud=new XQuestGame.Hud(this.game),this.addSceneItem(this.hud)},debug:function(){var a=new XQuestGame.GameDebugger(this.game);return this.debug=function(){return a},this.debug()},startArcadeGame:function(){this.currentLevel=1,this.stats.lives=Balance.player.lives,this.stats.bombs=Balance.bombs.startCount,this._events.fireEvent(a.onNewGame),this._showLevelNumber(),this._arrangeNewLevel(),this._startLevel()},_showLevelNumber:function(){var a="Level "+this.currentLevel,b=this.game.gfx.addText(a,{textBaseline:"top"});b.flyIn(1.5).flyOut(2)},_arrangeNewLevel:function(){this.game.levelGraphics.closeGate(),this.game.levelGraphics.setGateWidth(Balance.level.gateWidth),this._events.fireEvent(a.onNewLevel),this.game.crystals.startLevel(),this.game.enemies.startLevel(),this.game.powerCrystals.startLevel()},_startLevel:function(){var a=this.game.gfx.getGamePoint("middle");this.game.player.movePlayerTo(a.x,a.y),this.game.player.cancelVelocity(),this.game.player.showPlayer(!0),this.followPlayer=!0,this.game.gfx.followPlayer(this.game.player.location)},onAct:function(a){this._updateActivePowerups(a),this.followPlayer&&this.game.gfx.followPlayer(this.game.player.location)},getDefaultInputState:function(){var a={primaryWeapon:!1,secondaryWeapon:!1,engaged:!1,accelerationX:0,accelerationY:0};return a},killPlayer:function(){this.game.player.killPlayer(),this._events.fireEvent(a.onPlayerKilled),this.game.enemies.clearAllEnemies(),this.game.powerCrystals.clearAllPowerCrystals(),0===this.game.stats.lives?this._gameOver():this._loseALife()},_loseALife:function(){this.game.stats.lives--,this._animateBackToCenter().queue(function(){this._startLevel()}.bind(this))},_gameOver:function(){this._animateBackToCenter(),this._events.fireEvent(a.onGameOver),this.game.gfx.addAnimation((new Smart.Animation).queue(function(){this.game.gfx.addText("Game Over").flyIn(2).delay(2).flyOut(2)}.bind(this)).delay(5).queue(function(){this.game.gfx.addText("Highest Level: "+this.currentLevel).flyIn(2).delay(2).flyOut(2)}.bind(this)).delay(5).queue(function(){this.game.gfx.addText("Starting a new game in 5 seconds...").flyIn(2).delay(2).flyOut(2)}.bind(this)).delay(5).queue(function(){this.startArcadeGame()}.bind(this)))},levelUp:function(){this.game.player.showPlayer(!1),this.game.enemies.killAllEnemies(),this.game.powerCrystals.clearAllPowerCrystals(),this.currentLevel++,this._showLevelNumber(),this._arrangeNewLevel(),this._animateBackToCenter().queue(function(){this._startLevel()}.bind(this)),this._events.fireEvent(a.onNextLevel)},_animateBackToCenter:function(){var a=this.game.gfx.getGamePoint("visibleMiddle"),b=this.game.gfx.getGamePoint("middle");this.followPlayer=!1;var c=(new Smart.Animation).duration(2).ease().tween(function(a){this.game.gfx.followPlayer(a)}.bind(this),Smart.Keyframes.fromPoints([a,b]));return this.game.gfx.addAnimation(c),c},crystalsGathered:function(b){0===b&&(this.game.levelGraphics.openGate(),this._events.fireEvent(a.onAllCrystalsGathered))},pauseGame:function(b){b=void 0!==b?b:!this.scenePaused,this.scenePaused!==b&&(this.scenePaused=b,this.game.player.cancelVelocity(),this._events.fireEvent(a.onGamePaused,[this.scenePaused]))},activatePowerup:function(b){this.game.activePowerups[b]="newPowerup";var c=b+"!",d=this.game.gfx.addText(c,"powerupActive");d.start("left").flyIn(1.5,"middle").flyOut(2,"right"),this._events.fireEvent(a.onPowerupChanged,[b,!0])},powerupDeactivated:function(b){this._events.fireEvent(a.onPowerupChanged,[b,!1]);var c=b+" inactive",d=this.game.gfx.addText(c,"powerupDeactive");return d.start("left").flyIn(1.5,"middle").flyOut(2,"right")},_updateActivePowerups:function(a){var b=Balance.powerups,c={},d="deactivating";_.forOwn(this.game.activePowerups,function(e,f){if("newPowerup"===e){var g=a.runTime+1e3*b[f].duration;c[f]=g}else e===d||e<=a.runTime&&(c[f]=d)}),_.forOwn(c,function(a,b){a===d&&this.game.powerupDeactivated(b).queue(function(){delete this.game.activePowerups[b]}.bind(this)),this.game.activePowerups[b]=a},this)},toggleFPS:function(){if(this.fpsText)this.fpsText.dispose(),this.fpsText=null;else{var a={color:"red",fontSize:"40px",textAlign:"left",textBaseline:"top"};this.fpsText=this.game.gfx.addText("FPS",a),this.fpsText.moveTo(0,0),this.fpsText.onTick=function(){var a=createjs.Ticker.getMeasuredFPS(),b=1e3/createjs.Ticker.getMeasuredTickTime();this.text="FPS: "+b.toFixed(2)+" ["+a.toFixed(2)+"]"}}},toggleDebugStats:function(){if(this.debugStatsText)this.debugStatsText.dispose(),this.debugStatsText=null;else{var a={color:"red",fontSize:"40px",textAlign:"right",textBaseline:"top"};this.debugStatsText=this.game.gfx.addText("FPS",a);var b=Balance.level.bounds;this.debugStatsText.moveTo(b.visibleWidth,0);var c=this.game.debugStats.gameItems,d=this.game.gfx.debugStats.allGraphics;this.debugStatsText.onTick=function(){this.text="Game Items: "+c.length+"\nGraphics: "+d.length}}}}),_.forOwn(a,function(a,b){XQuestGame.ArcadeGame.prototype[b]=function(b){this._events.addEvent(a,b)}})}(),XQuestGame.BombCrystal=Smart.Class({initialize:function(a){this.game=a,this.location=this.game.gfx.createBombCrystalGraphic(),this.radius=Balance.bombCrystals.radius},spawnBomb:function(a){this.location.moveTo(a.x,a.y)},gatherBombCrystal:function(){this.location.gatherBombCrystal(this.game.gfx,this.game.player.location)}}),XQuestGame.Player=Smart.Class({location:null,radius:null,initialize:function(a){this.game=a,this.velocity={x:0,y:0},this.engaged=!1,this.previousState={},this._setupPlayerGraphics()},_setupPlayerGraphics:function(){this.playerGraphics=this.game.gfx.createPlayerGraphics(),this.location=this.playerGraphics,this.radius=Balance.player.radius},movePlayerTo:function(a,b){this.playerGraphics.moveTo(a,b)},cancelVelocity:function(){this.velocity.x=0,this.velocity.y=0},_handleInputs:function(a,b){var c=this.previousState;if(this.playerActive){if(this.previousState=b,b.accelerationX||b.accelerationY){var d={x:b.accelerationX||0,y:b.accelerationY||0},e=2,f=this.velocity.x<=0==b.accelerationX<=0,g=this.velocity.y<=0==b.accelerationY<=0;f||(d.x*=e),g||(d.y*=e),Smart.Physics.applyAcceleration(this.playerGraphics,d,a.deltaSeconds),Smart.Physics.applyAccelerationToVelocity(this.velocity,d)}if(this.engaged=b.engaged,b.primaryWeapon){var h=c.primaryWeapon===!1;h&&(this.primaryWeaponDownTime=a.runTime,this.game.activePowerups.tripleShot?this.game.projectiles.addTripleShot(Balance.powerups.tripleShot):this.game.projectiles.addBullet())}if(b.primaryWeapon){var i;i=this.game.activePowerups.rapidFire?Balance.powerups.rapidFire.shotsPerSecond:Balance.bullets.shotsPerSecond;var j=1e3/i;this.nextRapidFire?this.nextRapidFire<=a.runTime&&(this.nextRapidFire+=j,this.game.activePowerups.tripleShot?this.game.projectiles.addTripleShot(Balance.powerups.tripleShot):this.game.projectiles.addBullet()):this.nextRapidFire=a.runTime+j}else this.nextRapidFire=null;if(b.secondaryWeapon){var h=c.secondaryWeapon===!1;h&&(this.game.projectiles.releaseABomb(),this.cancelVelocity())}}},onMove:function(a,b){this._handleInputs(a,b),this._movePlayer(a)},_movePlayer:function(a){if(Smart.Physics.applyVelocity(this.playerGraphics,this.velocity,a.deltaSeconds),this.playerActive){this.engaged||Smart.Physics.applyFrictionToVelocity(this.velocity,Balance.player.looseFriction,a.deltaSeconds);var b=this.game.levelGraphics.levelCollision(this.location,this.radius);b&&(b.insideGate?b.insideGateDistance>=2*this.radius?(this.cancelVelocity(),this.game.levelUp()):b.touchingGate&&Smart.Physics.bounceOffPoint(this.location,this.velocity,b.touchingGate,this.radius,Balance.player.bounceDampening):this.game.activePowerups.invincible?Smart.Physics.bounceOffWall(b,this.location,this.velocity,Balance.player.bounceDampening):this.game.killPlayer())}},onAct:function(){if(this.playerActive){var a=!1;this.game.enemies.killEnemiesOnCollision([this],this.radius,function(){this.game.activePowerups.invincible||(a=!0)}.bind(this)),a&&this.game.killPlayer()}},killPlayer:function(){this.playerActive=!1,this.playerGraphics.killPlayerGraphics(this.game.gfx,this.velocity)},showPlayer:function(a){this.playerActive=a,a?(this.playerGraphics.restorePlayerGraphics(),this.game.gfx.addAnimation((new Smart.Animation).duration(1).easeOut().scale(this.playerGraphics,[0,1])).update(0)):this.game.gfx.addAnimation((new Smart.Animation).duration(.5).easeOut().scale(this.playerGraphics,[1,0]).queue(function(){this.playerGraphics.toggleVisible(!1)}.bind(this)))},getKickBack:function(){return Smart.Point.multiply(this.velocity,Balance.player.kickBack)}}),XQuestGame.PowerCrystal=Smart.Class({initialize:function(a){var b=Balance.powerCrystals;this.game=a,this.game.addSceneItem(this),this.location=this.game.gfx.createPowerCrystalGraphic(),this.radius=b.radius,this.turnSpeed=b.turnSpeed()},spawn:function(a){var b=Balance.powerCrystals;this.location.moveTo(a.x,a.y),this.velocity={x:b.speed,y:0},Smart.Point.rotate(this.velocity,b.spawnAngle()),2===a.side&&(this.velocity.x*=-1)},onMove:function(a){var b=this;Smart.Point.rotate(b.velocity,b.turnSpeed*a.deltaSeconds),Smart.Physics.applyVelocity(b.location,b.velocity,a.deltaSeconds),Smart.Physics.bounceOffWalls(b.location,b.radius,b.velocity,Balance.level.bounds)},gatherPowerCrystal:function(){this.location.gatherPowerCrystal(this.game.gfx,this.game.player.location).queue(function(){this.game.removeSceneItem(this)}.bind(this))},clearPowerCrystal:function(){this.location.clearPowerCrystal(this.game.gfx).queue(function(){this.game.removeSceneItem(this)}.bind(this))}}),XQuestGame.BaseEnemy=Smart.Class({game:null,enemyGraphics:null,location:null,radius:null,velocity:null,setupBaseEnemyGraphics:function(a,b,c){this.game=a,this.game.addSceneItem(this),this.enemyGraphics=this.game.gfx.createEnemyGraphics(b),this.location=this.enemyGraphics,this.radius=c},applyVelocityAndBounce:function(a){Smart.Physics.applyVelocity(this.location,this.velocity,a.deltaSeconds),Smart.Physics.bounceOffWalls(this.location,this.radius,this.velocity,Balance.level.bounds)},shouldChangeDirection:function(a,b){var c=void 0===this.nextChange;return c||this.nextChange<=a.runTime?(this.nextChange=a.runTime+1e3*b(),!c):!1},takeDamage:function(a,b){b&&(this.velocity.x+=b.x,this.velocity.y+=b.y),a>=1&&(this.enemyGraphics.killEnemy(this.game.gfx,this.velocity),this.game.removeSceneItem(this))},clearEnemy:function(){this.game.gfx.addAnimation((new Smart.Animation).duration(2).easeIn().scale(this.enemyGraphics,0).queue(function(){this.enemyGraphics.dispose(),this.game.removeSceneItem(this)}.bind(this)))}}),XQuestGame.Locust=Smart.Class(new XQuestGame.BaseEnemy,{initialize:function(a){var b=Balance.enemies.locust;this.setupBaseEnemyGraphics(a,"Locust",b.radius)},spawn:function(a){var b=Balance.enemies.locust;this.location.moveTo(a.x,a.y),this.velocity=Smart.Point.fromAngle((2===a.side?180:0)+_.random(-20,20),b.speed),this._changeTurnSpeed()},_changeTurnSpeed:function(){var a=Balance.enemies.locust;this.turnSpeed=a.turnSpeed()},onMove:function(a){var b=a.deltaSeconds*this.turnSpeed;Smart.Point.rotate(this.velocity,b),Smart.Physics.applyVelocity(this.location,this.velocity,a.deltaSeconds),Smart.Physics.bounceOffWalls(this.location,this.radius,this.velocity,Balance.level.bounds)},onAct:function(a){var b=Balance.enemies.locust;this.shouldChangeDirection(a,b.movementInterval)&&this._changeTurnSpeed(),this.enemyGraphics.rotation=Smart.Point.angleFromVector(this.velocity)}}),XQuestGame.Mantis=Smart.Class(new XQuestGame.BaseEnemy,{initialize:function(a){var b=Balance.enemies.mantis;this.setupBaseEnemyGraphics(a,"Mantis",b.radius)},spawn:function(a){this.location.moveTo(a.x,a.y),this._changeDirection()},onMove:function(a){this.applyVelocityAndBounce(a)},onAct:function(a){var b=Balance.enemies.mantis;this.shouldChangeDirection(a,b.movementInterval)&&this._changeDirection()},_changeDirection:function(){var a=Balance.enemies.mantis;this.velocity=Smart.Point.fromAngle(360*Math.random(),a.speed)}}),XQuestGame.Slug=Smart.Class(new XQuestGame.BaseEnemy,{initialize:function(a){var b=Balance.enemies.slug;this.setupBaseEnemyGraphics(a,"Slug",b.radius)},spawn:function(a){this.location.moveTo(a.x,a.y),this._changeDirection()},onMove:function(a){this.applyVelocityAndBounce(a)},onAct:function(a){var b=Balance.enemies.slug;this.shouldChangeDirection(a,b.movementInterval)&&this._changeDirection()},_changeDirection:function(){var a=Balance.enemies.slug;this.velocity=Smart.Point.fromAngle(360*Math.random(),a.speed)}}),XQuestGame.CrystalFactory=Smart.Class({initialize:function(a){this.game=a,this.game.addSceneItem(this),this.crystals=[]},startLevel:function(){this.crystals.forEach(function(a){a.dispose()},this),this.crystals=[];var a=Balance.crystals.spawnQuantity(this.game),b=Balance.crystals.radius;for(this.game.stats.crystalCount=a;a--;){var c=this.game.gfx.createCrystalGraphic(),d=this.game.gfx.getSafeSpawn(b);c.moveTo(d.x,d.y),c.location=c,this.crystals.push(c)}Smart.Physics.sortByLocation(this.crystals)},onAct:function(){var a=this.game.player;this._gatherOnCollision([a],a.radius)},_gatherOnCollision:function(a,b){var c=b+Balance.crystals.radius,d=0;Smart.Physics.detectCollisions(this.crystals,a,c,function(a,b,c){a.gatherCrystal(this.game.gfx,this.game.player.location),this.crystals.splice(c,1),d++}.bind(this)),d&&(this.game.crystalsGathered(this.crystals.length,d),this.game.stats.crystalCount-=d)},gatherClosestCrystal:function(a){if(this.crystals.length){var b=Smart.Physics.findClosestPoint(a,this.crystals),c=this.crystals[b];c.gatherCrystal(this.game.gfx,this.game.player.location),this.crystals.splice(b,1),this.game.crystalsGathered(this.crystals.length,1),this.game.stats.crystalCount-=1}}}),XQuestGame.EnemyFactory=Smart.Class({initialize:function(a){this.game=a,this.enemies=[]},startLevel:function(){var a=this.game.currentLevel,b=Math.floor(a/2),c=Balance.enemies.roster;this.enemyPool=b>=c.length?c:a%2===0?[c[b]]:c.slice(0,b+1)},onAct:function(a){null==this.nextEnemySpawn?this._calculateNextEnemySpawn(a.runTime):this.nextEnemySpawn<=a.runTime&&(this.spawnNextEnemy(),this._calculateNextEnemySpawn(a.runTime)),this.enemies.length>=2&&Smart.Physics.sortByLocation(this.enemies)},_calculateNextEnemySpawn:function(a){var b=Balance.enemies.spawnRate();this.nextEnemySpawn=a+1e3*b},spawnNextEnemy:function(){var a;if(1===this.enemyPool.length)a=0;else{var b=1-Math.pow(Math.random(),Balance.enemies.spawnDifficulty);a=Math.floor(b*this.enemyPool.length)}var c=this.enemyPool[a],d=new c(this.game);this.enemies.push(d);var e=this.getRandomSpawn(d.radius);d.spawn(e),this.game.gfx.addAnimation((new Smart.Animation).duration(1).easeOut("quint").scale(d.location,[0,1])).update(0)},getRandomSpawn:function(a){var b=Balance.level.bounds,c=Math.floor(2*Math.random())?1:2,d={x:1===c?b.x+a:b.x+b.width-a,y:b.y+b.height/2,side:c};return d},killEnemiesOnCollision:function(a,b,c){var d=this.enemies,e=b+Balance.enemies.maxRadius;Smart.Physics.detectCollisions(d,a,e,function(a,b,d,e,f){if(!a.isDead){var g=f<=a.radius+b.radius;if(g){var h=b.hitPoints||1,i=b.getKickBack&&b.getKickBack(a,f)||null,j=a.takeDamage(h,i);j||(a.isDead=!0),c&&c(a,b,d,e,f)}}}.bind(this));for(var f=d.length;f--;)d[f].isDead&&this.enemies.splice(f,1)},killAllEnemies:function(){this.enemies.forEach(function(a){a.takeDamage(Number.POSITIVE_INFINITY,null)},this),this.enemies.length=0},clearAllEnemies:function(){this.enemies.forEach(function(a){a.clearEnemy()}),this.enemies.length=0},findClosestEnemy:function(a){var b=this.enemies.map(function(a){return a.location}),c=Smart.Physics.findClosestPoint(a,b);return this.enemies[c]}}),XQuestGame.GameDebugger=Smart.Class({initialize:function(a){this.game=a},gatherClosestCrystal:function(){this.game.crystals.gatherClosestCrystal(this.game.player.location)},spawnEnemy:function(){this.game.enemies.spawnNextEnemy()},activatePowerup:function(a){this.game.activatePowerup(a)},addBomb:function(){this.game.stats.bombs++},killPlayer:function(){this.game.killPlayer()},spawnPowerCrystal:function(){this.game.powerCrystals.createPowerCrystal()},toggleFPS:function(){this.game.toggleFPS()},toggleDebugStats:function(){this.game.toggleDebugStats()}}),XQuestGame.Hud=Smart.Class({initialize:function(a){this.game=a,this._setupGraphics(),this._layout()},_setupGraphics:function(){this.game.gfx.enableTouchClicks(),this.hudOverlay=this.game.gfx.createHUDOverlay(),this.hudLivesIcon=this.game.gfx.createPlayerHUDIcon(),this.hudLivesText=this.game.gfx.addText("","hudText"),this.hudCrystalsIcon=this.game.gfx.createCrystalHUDIcon(),this.hudCrystalsText=this.game.gfx.addText("","hudText"),this.hudBombsIcon=this.game.gfx.createBombCrystalHUDIcon(),this.hudBombsText=this.game.gfx.addText("","hudText"),this.hudPauseButton=this.game.gfx.createPauseButtonHUD(),this.hudPauseButton.addEventListener("click",function(){this.game.pauseGame()}.bind(this))},_layout:function(){var a=Balance.level.bounds,b=a.hudHeight/2,c=50,d=c;d+=this.hudLivesIcon.visibleRadius,this.hudLivesIcon.moveTo(d,b),d+=this.hudLivesIcon.visibleRadius,this.hudLivesText.moveTo(d,b),d+=c,d+=this.hudBombsIcon.visibleRadius,this.hudBombsIcon.moveTo(d,b),d+=this.hudBombsIcon.visibleRadius,this.hudBombsText.moveTo(d,b),d+=c,d+=this.hudCrystalsIcon.visibleRadius,this.hudCrystalsIcon.moveTo(d,b),d+=this.hudCrystalsIcon.visibleRadius,this.hudCrystalsText.moveTo(d,b),d+=c;var e=a.visibleWidth/2;this.hudPauseButton.moveTo(e-this.hudPauseButton.width/2,b-this.hudPauseButton.height/2)},onAct:function(){this.hudLivesText.text=" x "+this.game.stats.lives,this.hudCrystalsText.text=" x "+this.game.stats.crystalCount,this.hudBombsText.text=" x "+this.game.stats.bombs}}),XQuestGame.PowerupFactory=Smart.Class({initialize:function(a){this.game=a,this.game.addSceneItem(this),this.powerCrystals=[]},onMove:function(a){this._shouldSpawn(a)&&this.createPowerCrystal()},_shouldSpawn:function(a){var b=Balance.powerCrystals,c=void 0===this.nextSpawn,d=!c&&this.nextSpawn<=a.runTime;return(c||d)&&(this.nextSpawn=a.runTime+1e3*b.spawnRate()),d},onAct:function(){this.powerCrystals.length>=2&&Smart.Physics.sortByLocation(this.powerCrystals);var a=this.game.player;if(this._gatherOnCollision([a],a.radius),this.bombCrystals&&this.bombCrystals.length){this.bombCrystals.length>=2&&Smart.Physics.sortByLocation(this.bombCrystals);var b=Balance.player.radius+Balance.bombCrystals.radius;Smart.Physics.detectCollisions(this.bombCrystals,[this.game.player],b,function(a,b,c){this.bombCrystals.splice(c,1),a.gatherBombCrystal(),this.game.stats.bombs++}.bind(this))}},createPowerCrystal:function(){var a=new XQuestGame.PowerCrystal(this.game),b=this.game.enemies.getRandomSpawn(a.radius);a.spawn(b),this.powerCrystals.push(a)},_nextPowerup:function(){var a=Balance.powerups,b=0;_.forOwn(a,function(a,c){c in this.game.activePowerups||(b+=a.frequency)},this);var c;if(0!==b){var d=Math.random()*b;_.forOwn(a,function(a,b){return b in this.game.activePowerups?void 0:(d-=a.frequency,0>=d?(c=b,!1):void 0)
},this)}else{c=null;var e=null;_.forOwn(a,function(a,b){var d=this.game.activePowerups[b];(null===e||e>d)&&(e=d,c=b)},this)}return c},_gatherOnCollision:function(a,b){var c=b+Balance.powerCrystals.radius;Smart.Physics.detectCollisions(this.powerCrystals,a,c,function(a,b,c){this.powerCrystals.splice(c,1),a.gatherPowerCrystal();var d=this._nextPowerup();this.game.activatePowerup(d)}.bind(this))},startLevel:function(){for(var a=Balance.bombCrystals.spawnQuantity(this.game);a--;)this.createBombCrystal()},createBombCrystal:function(){var a=new XQuestGame.BombCrystal(this.game),b=this.game.gfx.getSafeSpawn(a.radius);a.spawnBomb(b),this.bombCrystals||(this.bombCrystals=[]),this.bombCrystals.push(a)},clearAllPowerCrystals:function(){_.forEach(this.powerCrystals,function(a){a.clearPowerCrystal()},this),this.powerCrystals.length=0}}),XQuestGame.Projectiles=Smart.Class({initialize:function(a){this.game=a,this.game.addSceneItem(this),this.bullets=[],this.bomb=null},onMove:function(a){this._moveBullets(a)},onAct:function(){this._bulletsKillEnemies(),this._bombsKillEnemies()},addTripleShot:function(a){var b=a.angle;this.addBullet(),this.addBullet(b),this.addBullet(-b)},addBullet:function(a){var b=this.game.gfx.createPlayerBullet(),c=this.game.player;b.moveTo(c.location.x,c.location.y);var d;if(this.game.activePowerups.autoAim){var e=Balance.powerups.autoAim,f=this.game.enemies.findClosestEnemy(c.location);f&&(d=Smart.Physics.trajectory(c.location,f.location,f.velocity,e.bulletSpeed))}d||(d={x:c.velocity.x*Balance.bullets.speed,y:c.velocity.y*Balance.bullets.speed}),b.velocity=d,a&&Smart.Point.rotate(b.velocity,a),b.location=b,b.radius=Balance.bullets.radius,this.bullets.push(b)},_moveBullets:function(a){for(var b=Balance.level.bounds,c=this.bullets.length;c--;){var d=this.bullets[c];Smart.Physics.applyVelocity(d,d.velocity,a.deltaSeconds),Smart.Point.pointIsInBounds(d,b)||(d.dispose(),this.bullets.splice(c,1))}},_bulletsKillEnemies:function(){if(this.bullets.length){this.bullets.length>=2&&Smart.Physics.sortByLocation(this.bullets),this.game.enemies.killEnemiesOnCollision(this.bullets,Balance.bullets.radius,function(a,b){b.shouldDisappear=!0});for(var a=this.bullets.length;a--;){var b=this.bullets[a];b.shouldDisappear&&(b.dispose(),this.bullets.splice(a,1))}}},releaseABomb:function(){var a=this.game.stats.bombs>0&&null===this.bomb;return a&&(this.game.stats.bombs--,this._createBomb()),a},_createBomb:function(){var a=this.game.player,b=this.game.gfx.createBombGraphic();return this.bomb=b,b.onDispose(function(){this.bomb=null}.bind(this)),b.location.moveTo(a.location.x,a.location.y),b},_bombsKillEnemies:function(){this.bomb&&this.game.enemies.killEnemiesOnCollision([this.bomb],this.bomb.radius)}});var Balance={merge:function(a){_.merge(Balance,a)}};Balance.merge({randomBetween:function(a,b){return function(){return Math.floor(a+Math.random()*(b-a+1))}},randomFloatBetween:function(a,b){return function(){return a+Math.random()*(b-a)}}}),Balance.merge({gameModeOverrides:{arcade:{},test:{fullView:!0,enemySpawnRate:Balance.randomBetween(1,1),bombCrystalsSpawnQuantity:function(){return 3},powerupSpawnRate:Balance.randomBetween(5,5)}},setGameMode:function(a){var b="object"==typeof a?a:Balance.gameModeOverrides[a]||{};Balance.merge({level:{bounds:function(){var a=40,c=40,d=1200,e=675,f=800,g=450;return b.fullView&&(f=c+d+c,g=a+c+e+c),{hudHeight:a,padding:c,x:c,y:a+c,visibleWidth:f,visibleHeight:g,width:d,height:e,totalWidth:c+d+c,totalHeight:a+c+e+c}}(),gateWidth:200},player:{radius:12,kickBack:2,looseFriction:.8,bounceDampening:0,lives:5},bullets:{radius:2,kickBack:.5,speed:3,shotsPerSecond:1},bombs:{startCount:3,speed:1300,kickBack:.3},crystals:{radius:10,spawnQuantity:function(a){return Math.min(12+a.currentLevel,40)}},powerCrystals:{radius:15,speed:300,spawnAngle:Balance.randomBetween(-70,70),turnSpeed:Balance.randomBetween(-40,40),spawnRate:b.powerupSpawnRate||Balance.randomBetween(20,40)},bombCrystals:{radius:10,spawnQuantity:b.bombCrystalsSpawnQuantity||function(a){return(a.currentLevel+1)%2}},powerups:{rapidFire:{duration:60,frequency:20,shotsPerSecond:10},tripleShot:{duration:60,frequency:20,angle:10},autoAim:{duration:30,frequency:20,bulletSpeed:500},invincible:{duration:20,frequency:10}},enemies:{maxRadius:13,safeSpawnDistance:130,spawnRate:b.enemySpawnRate||Balance.randomBetween(1,2),spawnDifficulty:1.5,roster:b.enemyRoster||[XQuestGame.Slug,XQuestGame.Locust,XQuestGame.Mantis],slug:{radius:13,speed:80,movementInterval:Balance.randomBetween(3,10)},locust:{radius:11,speed:150,movementInterval:Balance.randomBetween(3,5),turnSpeed:Balance.randomBetween(-100,100)},mantis:{radius:12,speed:50,movementInterval:Balance.randomBetween(3,6)}}}),this._fireUpdate(b)}}),Balance.merge({onUpdate:function(a){this._onUpdate?this._onUpdate.push(a):this._onUpdate=[a]},_fireUpdate:function(a){this._onUpdate&&_.forEach(this._onUpdate,function(b){b(a)})}}),function(){var a={onMenuExit:"MenuExit"};XQuestGame.MenuSceneInputs={menuUp:"menuUp",menuDown:"menuDown",menuLeft:"menuLeft",menuRight:"menuRight",menuInvoke:"menuInvoke",menuBack:"menuBack"},XQuestGame.MenuScene=Smart.Class(new XQuestGame.BaseScene,{initialize:function(a,b){this.MenuScene_initialize(a,b)},MenuScene_initialize:function(a,b){this.BaseScene_initialize(),this.menuScene=this,this.menuScene.host=b,this.addSceneItem(this),this.gfx=a,this.addSceneItem(this.gfx),this.menuStack=[];var c=this.gfx.getGamePoint("middle");this.gfx.followPlayer(c)},_setupBackButton:function(){var a=this.menuScene.gfx.createMenuButton("Back");a.addButtonEvents({invoke:this.goBack.bind(this)});var b=this.menuScene.gfx.getHudPoint("top");a.moveTo(b.x,b.y+a.visibleHeight),this.backButton=a,this.backButton.visible=!1},_updateBackButton:function(){this.backButton&&(this.backButton.visible=this.menuStack.length>=2)},addMenu:function(a){this.currentMenu&&this.currentMenu.menuLeave(!1),this.menuStack.push(a),this.currentMenu=a,this._updateBackButton(),this.currentMenu.menuEnter(!1),this.scenePaused=!1},goBack:function(){this.menuStack.length<=1||(this.menuStack.pop().menuLeave(!0),this.currentMenu=this.menuStack[this.menuStack.length-1],this.currentMenu.menuEnter(!0),this._updateBackButton())},exitMenu:function(b){this.menuStack.length=0,this.currentMenu.menuLeave(!0).queue(function(){this.fireSceneEvent(a.onMenuExit),b(),this.dispose(),this.scenePaused=!0}.bind(this))},onMove:function(a,b){this.currentMenu.menuInput(b),b.menuBack&&this.menuStack.length>=2&&this.goBack()}}),XQuestGame.MenuScene.prototype.implementSceneEvents(a)}(),function(){XQuestGame.BaseMenu=Smart.Class(new Smart.Events,{initialize:function(a){this.BaseMenu_initialize(a)},BaseMenu_initialize:function(a){this.menuScene=a,this.activeRowIndex=0,this.rows=this.getRows(),this._setActiveRowIndex(this.activeRowIndex)},getRows:function(){return[]},createMenuButton:function(a,b){var c=this.menuScene.gfx.createMenuButton(a);return c.addButtonEvents({invoke:b,hoverEnter:this._setActiveRow.bind(this,c),hoverLeave:this._setActiveRowIndex.bind(this,-1)}),c.invoke=b,c},menuEnter:function(a){this._enterRows(this.rows,a)},menuLeave:function(a){return this._leaveRows(this.rows,a)},_enterRows:function(a,b){var c=20,d=30,e=.25,f=1,g=a[0].visibleHeight,h=b,i=this.menuScene.gfx.getHudPoint(h?"top":"bottom");i.y+=g*(h?-2:2);for(var j=this.menuScene.gfx.getHudPoint("middle"),k=(a.length-1)*(g+c),l=j.y-k/2,m=0,n=a.length;n>m;m++){var o=a[m],p=j.x,q=l;o.moveTo(i.x,i.y),o.rotation=d*(m%2===0?1:-1),o.animation=this.menuScene.gfx.addAnimation().delay(e*(h?n-m:m)).duration(f).easeOut("quint").move(o,{x:p,y:q}).rotate(o,0),l+=o.visibleHeight+c}},_leaveRows:function(a,b){var c=30,d=.1,e=.5,f=b,g=a[0].visibleHeight,h=this.menuScene.gfx.getHudPoint(f?"bottom":"top");h.y+=g*(f?2:-2);for(var i,j=0,k=a.length;k>j;j++){var l=a[j];l.animation&&l.animation.cancelAnimation(),l.animation=this.menuScene.gfx.addAnimation().delay(d*(f?k-j:j)).duration(e).easeOut("quint").move(l,h).rotate(c),b&&l.animation.queueDispose(l),i=l.animation}return i},menuInput:function(a){a.menuUp||a.menuLeft?this._moveActiveRowIndex(-1):(a.menuDown||a.menuRight)&&this._moveActiveRowIndex(1),a.menuInvoke&&this._invokeActiveRow()},_moveActiveRowIndex:function(a){var b=this.activeRowIndex+a;0>b&&(b+=this.rows.length),b>=this.rows.length&&(b-=this.rows.length),this._setActiveRowIndex(b)},_setActiveRow:function(a){var b=this.rows.indexOf(a);this._setActiveRowIndex(b)},_setActiveRowIndex:function(a){for(var b=this.rows,c=0,d=b.length;d>c;c++)b[c].setActive(c===a);this.activeRowIndex=a},_getActiveRow:function(){return this.rows[this.activeRowIndex]||null},_invokeActiveRow:function(){var a=this._getActiveRow();a&&a.invoke()}})}(),function(){var a={onStartGame:"onStartGame"},b={onResumeGame:"onResumeGame"};XQuestGame.CommonMenus={StartMenu:Smart.Class((new XQuestGame.BaseMenu).implementEvents(a),{getRows:function(){return[this.createMenuButton("Start Game",this._onStartGame.bind(this)),this.createMenuButton("Graphics Test",this._showGraphicsTest.bind(this))]},_onStartGame:function(){this.menuScene.exitMenu(function(){this.fireEvent(a.onStartGame)}.bind(this))},_showGameOptions:function(){this.menuScene.addMenu(new XQuestGame.CommonMenus.GameOptions(this.menuScene))},_showGraphicsTest:function(){this.menuScene.addMenu(new XQuestGame.CommonMenus.GraphicsTestMenu(this.menuScene))}}),PauseMenu:Smart.Class((new XQuestGame.BaseMenu).implementEvents(b),{getRows:function(){return[this.createMenuButton("Resume Game",this._onResumeGame.bind(this))]},_onResumeGame:function(){this.menuScene.exitMenu(function(){this.fireEvent(b.onResumeGame)}.bind(this))}}),GameOptions:Smart.Class(new XQuestGame.BaseMenu,{getRows:function(){return[this.createMenuButton("Option 1",function(){}),this.createMenuButton("Option 2",function(){}),this.createMenuButton("Option 3",function(){}),this.createMenuButton("Option 4",function(){})]}})}}(),XQuestGame.CommonMenus.GraphicsTestMenu=Smart.Class(new XQuestGame.BaseMenu,{getRows:function(){var a=this.menuScene.goBack.bind(this.menuScene),b=this.createMenuButton("Player",a),c=this.createMenuButton("Objects",a),d=this.createMenuButton("Enemies",a),e=b.visibleHeight/2;return b.addChild(this.menuScene.gfx.createPlayerGraphics()).moveTo(-e,e),c.addChild(this.menuScene.gfx.createCrystalGraphic()).moveTo(3*-e,e),c.addChild(this.menuScene.gfx.createPowerCrystalGraphic()).moveTo(2*-e,e),c.addChild(this.menuScene.gfx.createBombCrystalGraphic()).moveTo(-e,e),d.addChild(this.menuScene.gfx.createEnemyGraphics("Slug")).moveTo(3*-e,e),d.addChild(this.menuScene.gfx.createEnemyGraphics("Locust")).moveTo(2*-e,e),d.addChild(this.menuScene.gfx.createEnemyGraphics("Mantis")).moveTo(-e,e),[b,c,d]}});var EaselJSGraphics=Smart.Class({initialize:function(a){this.canvas=a,this.debugStats={allGraphics:[]},this._setupLayers(),this._setupAnimations()},_setupLayers:function(){function a(a){var c=a.addChild,d=a.removeChild;a.addChild=function(a){c.apply(this,arguments),b.push(a)},a.removeChild=function(a){d.apply(this,arguments),_.eliminate(b,a)}}this.layers={background:new createjs.Stage(this.canvas),objects:new createjs.Stage(this.canvas),characters:new createjs.Stage(this.canvas),hud:new createjs.Stage(this.canvas)};var b=this.debugStats.allGraphics;_.forOwn(this.layers,function(b){a(b),b.autoClear=!1}),this.layers.hud.enableMouseOver()},showBackgroundStars:function(a){a?(this.backgroundStars||(this.backgroundStars=new EaselJSGraphics.BackgroundGraphics),this.layers.background.addChild(this.backgroundStars)):this.backgroundStars&&this.layers.background.removeChild(this.backgroundStars)},_setupAnimations:function(){this.animations=new Smart.Animations},onMove:function(a){this.animations.update(a.deltaSeconds)},onDraw:function(a){this.layers.background.update(a),this.layers.objects.update(a),this.layers.characters.update(a),this.layers.hud.update(a)},followPlayer:function(a){var b=Balance.level.bounds;this._maxOffset||(this._maxOffset={x:b.totalWidth-b.visibleWidth,y:b.totalHeight-b.visibleHeight}),this._offset={x:Math.min(Math.max(0,a.x-b.visibleWidth/2),this._maxOffset.x),y:Math.min(Math.max(0,a.y-b.visibleHeight/2),this._maxOffset.y)},this.layers.background.x=-this._offset.x,this.layers.objects.x=-this._offset.x,this.layers.characters.x=-this._offset.x,this.layers.background.y=-this._offset.y,this.layers.objects.y=-this._offset.y,this.layers.characters.y=-this._offset.y},getSafeSpawn:function(a){var b,c,d=this.getGamePoint("left"),e=this.getGamePoint("right"),f=Balance.enemies.safeSpawnDistance;do b=this.getGamePoint("random",a),c=!Smart.Point.distanceTest(d,b,f)&&!Smart.Point.distanceTest(e,b,f);while(!c);return b},getGamePoint:function(a,b){if("string"!=typeof a)return a;void 0==b&&(b=0);var c=Balance.level.bounds;switch(a){case"random":return{x:c.x+b+(c.width-b-b)*Math.random(),y:c.y+b+(c.height-b-b)*Math.random()};case"visibleMiddle":return{x:this._offset.x+c.visibleWidth/2,y:this._offset.y+c.visibleHeight/2};case"middle":return{x:c.x+c.width/2,y:c.y+c.height/2};case"top":return{x:c.x+c.width/2,y:c.y+b};case"bottom":return{x:c.x+c.width/2,y:c.y+c.height-b};case"left":return{x:c.x+b,y:c.y+c.height/2};case"right":return{x:c.x+c.width-b,y:c.y+c.height/2};default:throw"Invalid gamePoint: "+a}},getHudPoint:function(a){if("string"!=typeof a)return a;var b=Balance.level.bounds;switch(a){case"middle":return{x:b.visibleWidth/2,y:b.visibleHeight/2};case"top":return{x:b.visibleWidth/2,y:0};case"bottom":return{x:b.visibleWidth/2,y:b.visibleHeight};case"left":return{x:0,y:b.visibleHeight/2};case"right":return{x:b.visibleWidth,y:b.visibleHeight/2}}return null},createLevelGraphics:function(){var a=new EaselJSGraphics.LevelGraphics;return this.layers.background.addChild(a),a},createPlayerGraphics:function(){var a=new EaselJSGraphics.PlayerGraphics;return this.layers.characters.addChild(a),a},createPlayerHUDIcon:function(){var a=new EaselJSGraphics.PlayerGraphics,b=.7;return a.scaleTo(b),a.visibleRadius*=b,this.layers.hud.addChild(a),a},createPlayerBullet:function(){var a=new EaselJSGraphics.BulletGraphics;return this.layers.objects.addChild(a),a.onDispose(function(){this.layers.objects.removeChild(a)}.bind(this)),a},createEnemyGraphics:function(a){var b=null;switch(a){case"Slug":b=new EaselJSGraphics.SlugGraphics;break;case"Locust":b=new EaselJSGraphics.LocustGraphics;break;case"Mantis":b=new EaselJSGraphics.MantisGraphics}if(null==b)throw new Error("Unknown enemy: "+a);return this.layers.characters.addChild(b),b.onDispose(function(){this.layers.characters.removeChild(b)}.bind(this)),b},createCrystalGraphic:function(){var a=new EaselJSGraphics.CrystalGraphic;return this.layers.objects.addChild(a),a.onDispose(function(){this.layers.objects.removeChild(a)}.bind(this)),a},createCrystalHUDIcon:function(){var a=new EaselJSGraphics.CrystalGraphic,b=.7;return a.scaleTo(b),a.visibleRadius*=b,this.layers.hud.addChild(a),a},createPowerCrystalGraphic:function(){var a=new EaselJSGraphics.PowerCrystalGraphic;return this.layers.characters.addChild(a),a.onDispose(function(){this.layers.characters.removeChild(a)}.bind(this)),a},createBombCrystalGraphic:function(){var a=new EaselJSGraphics.BombCrystalGraphic;return this.layers.objects.addChild(a),a.onDispose(function(){this.layers.objects.removeChild(a)}.bind(this)),a},createBombCrystalHUDIcon:function(){var a=new EaselJSGraphics.BombCrystalGraphic,b=.7;return a.scaleTo(b),a.visibleRadius*=b,this.layers.hud.addChild(a),a.onDispose(function(){this.layers.hud.removeChild(a)}.bind(this)),a},createBombGraphic:function(){var a=new EaselJSGraphics.BombGraphic;return this.layers.objects.addChild(a),a.onDispose(function(){this.layers.objects.removeChild(a)}.bind(this)),a},createExplosion:function(a,b,c){var d=new EaselJSGraphics.ExplosionGraphic(a,b,c);this.layers.objects.addChild(d),d.onDispose(function(){this.layers.objects.removeChild(d)}.bind(this))},addAnimation:function(a){return this.animations.addAnimation(a)},addText:function(a,b){var c=new EaselJSGraphics.TextGraphic;return c.setGfx(this),c.setText(a,b),this.layers.hud.addChild(c),c.onDispose(function(){this.layers.hud.removeChild(c)}.bind(this)),c},enableTouchClicks:function(){createjs.Touch.enable(this.layers.hud)},createHUDOverlay:function(){var a=new EaselJSGraphics.HudGraphics.HudOverlay;return this.layers.hud.addChild(a),a.onDispose(function(){this.layers.hud.removeChild(a)}.bind(this)),a},createPauseButtonHUD:function(){var a=new EaselJSGraphics.HudGraphics.HudPauseButton(this);return this.layers.hud.addChild(a),a.onDispose(function(){this.layers.hud.removeChild(a)}.bind(this)),a},createMenuButton:function(a){var b=new EaselJSGraphics.MenuGraphics.MenuButton(this);return b.setText(a),b.addButtonEvents=function(a){a.invoke&&this.addEventListener("click",a.invoke),a.hoverEnter&&this.addEventListener("mouseover",a.hoverEnter),a.hoverLeave&&this.addEventListener("mouseout",a.hoverLeave)},this.layers.hud.addChild(b),b.onDispose(function(){this.layers.hud.removeChild(b)}.bind(this)),b}}),EaselJSTimer=Smart.Class({addTickHandler:function(a){createjs.Ticker.useRAF=!0,createjs.Ticker.setFPS(60),createjs.Ticker.addEventListener("tick",function(b){b.deltaSeconds=b.delta/1e3,a(b)})},dispose:function(){createjs.Ticker.removeAllEventListeners()}});EaselJSGraphics.Drawing=Smart.Class(new createjs.DisplayObject,{setup:null,drawStatic:null,drawEffects:null,DisplayObject_initialize:createjs.DisplayObject.prototype.initialize,DisplayObject_draw:createjs.DisplayObject.prototype.draw,sharedDrawingContext:new Smart.DrawingContext(null),initialize:function(){this.Drawing_initialize.apply(this,arguments)},Drawing_initialize:function(){this.DisplayObject_initialize(),this.setup&&this.setup.apply(this,arguments),this.drawStatic&&(this.drawingQueue=new Smart.DrawingQueue,this.drawStatic(this.drawingQueue))},onTick:function(a){this.tickEvent=a},draw:function(a,b){var c=this.DisplayObject_draw(a,b);return!c&&this.drawingQueue&&this.drawingQueue.draw(a),this._anim&&this._anim.update(this.tickEvent.deltaSeconds),this.drawEffects&&!b&&this.tickEvent&&(this.sharedDrawingContext.setContext(a),this.drawEffects(this.sharedDrawingContext,this.tickEvent)),!0},addAnimation:function(){var a=new Smart.Animation;if(this._anim)throw"Multiple animations not yet supported";return this._anim=a,a}});var Graphics;Balance.onUpdate(function(){Graphics={merge:function(a){_.merge(Graphics,a)}},Graphics.merge({player:{radius:Balance.player.radius,outerStrokeStyle:{lineWidth:.25*Balance.player.radius,strokeStyle:"white"},innerRadius:Balance.player.radius-2,innerStyle:{fillStyle:"hsl(60, 100%, 50%)"},innerStarPoints:3,innerStarSize:.7,spinRate:108,explosionOptions:{count:200,speed:800,style:{fillStyle:"hsl(60, 100%, 50%)"},radius:6}},bullets:{radius:Balance.bullets.radius,strokeStyle:{strokeWidth:2,strokeColor:"white"}},crystals:{radius:Balance.crystals.radius,style:{fillColor:"yellow"},sides:6,pointSize:.5,spinRate:-36,spinRateGathered:360,gatherDuration:1},powerCrystals:{radius:Balance.powerCrystals.radius,style:{strokeColor:"white",strokeWidth:2},radiusInner:.5*Balance.powerCrystals.radius,styleInner:{fillColor:"yellow",strokeWidth:2},sides:5,pointSize:.3,spinRate:108,gatherDuration:2},bombCrystals:{radius:Balance.bombCrystals.radius,style:{strokeColor:"yellow",strokeWidth:2},radiusInner:.5*Balance.bombCrystals.radius,styleInner:{fillColor:"white",strokeWidth:2},sides:3,pointSize:.3,spinRate:108,gatherDuration:2},bombs:{style:{fillColor:"white"}},level:{cornerRadius:16,strokeStyle:{strokeWidth:8,strokeColor:"#999999"},gateElectricityFrequency:1e3/30},gate:{strokeStyle:{strokeWidth:2.5,strokeColor:"#FF0000"},segments:9,deviation:.2},background:{backgroundColor:"black",starColors:["#FFFFFF","#666666","#999999","#CCCCCC"],starCount:500}})}),EaselJSGraphics.PlayerGraphics=Smart.Class(new EaselJSGraphics.Drawing,{drawStatic:function(a){var b=Graphics.player;this.radius=b.radius,a.beginPath().circle(0,0,b.radius).endPath(b.outerStrokeStyle),a.beginPath().star(0,0,b.innerRadius,b.innerStarPoints,b.innerStarSize,0).endPath(b.innerStyle)},drawEffects:function(a,b){var c=Graphics.player;this.rotation+=c.spinRate*b.deltaSeconds},killPlayerGraphics:function(a,b){var c=Graphics.player;this.toggleVisible(!1),a.createExplosion(this,b,c.explosionOptions)},restorePlayerGraphics:function(){this.toggleVisible(!0)}}),EaselJSGraphics.BaseEnemyGraphics=Smart.Class(new EaselJSGraphics.Drawing,{drawCircleCircle:function(a,b){var c=b.outerRadius,d=b.outerStyle,e=b.innerRadius,f=b.innerStyle;a.beginPath().circle(0,0,c).endPath(d).beginPath().circle(0,0,e).endPath(f)},drawTriangleTriangle:function(a,b){var c=b.outerTriangle,d=b.outerStyle,e=b.innerTriangle,f=b.innerStyle;a.beginPath().polygon(c).closePath().endPath(d).beginPath().polygon(e).closePath().endPath(f)},killEnemy:function(a,b){var c=this;c.dispose();var d=this.getExplosionOptions();a.createExplosion(c,b,d)}}),Balance.onUpdate(function(){var a=Balance.enemies.locust.radius,b=0,c=6*a/11,d=3*a/11,e="hsl(40, 100%, 50%)",f="hsl(0, 100%, 30%)";_.merge(Graphics,{enemies:{locust:{visibleRadius:Balance.enemies.locust.radius+1,triangleTriangle:{outerTriangle:Smart.Drawing.polygonFromAngles(0,b,a,[0,130,230]),outerStyle:{fillStyle:e},innerTriangle:Smart.Drawing.polygonFromAngles(0,d,c,[0,130,230]),innerStyle:{fillStyle:f,strokeStyle:"black"}},explosionOptions:{count:20,speed:500,style:{fillStyle:"hsl(40, 100%, 50%)"}}}}})}),EaselJSGraphics.LocustGraphics=Smart.Class(new EaselJSGraphics.BaseEnemyGraphics,{setup:function(){var a=Graphics.enemies.locust;this.visibleRadius=a.visibleRadius},drawEffects:function(a){var b=Graphics.enemies.locust;this.drawTriangleTriangle(a,b.triangleTriangle)},getExplosionOptions:function(){var a=Graphics.enemies.locust;return a.explosionOptions}}),Balance.onUpdate(function(){var a=Balance.enemies.mantis.radius,b="hsl(10, 100%, 50%)",c="hsl(60, 100%, 50%)";Graphics.merge({enemies:{mantis:{radius:a,star1:{radius:a,sides:7,pointSize:.5,color:c},star2:{radius:a,sides:7,pointSize:.7,angle:360/7*.5,color:b},pulse:4,explosionOptions:{count:20,speed:500,style:{fillStyle:b}}}}})}),EaselJSGraphics.MantisGraphics=Smart.Class(new EaselJSGraphics.BaseEnemyGraphics,{setup:function(){var a=Graphics.enemies.mantis;this.visibleRadius=a.radius;var b=Smart.Drawing.createStarPolygon(0,0,a.star1.radius,a.star1.sides,a.star1.pointSize,0),c=Smart.Drawing.createStarPolygon(0,0,a.star2.radius,a.star2.sides,a.star2.pointSize,a.star2.angle);c.push(c.shift()),this.getStar=Smart.Interpolate.arrays(b,c),this.getStarColor=Smart.Interpolate.colors(a.star1.color,a.star2.color),this.star1=b,this.star2=c,this.time=0},drawEffects:function(a,b){var c=Graphics.enemies.mantis;this.time+=b.deltaSeconds;var d=(Math.sin(this.time*Math.PI*2/c.pulse)+1)/2;this.starColor=this.getStarColor(d),a.beginPath().polygon(this.getStar(d)).closePath().fillStyle(this.starColor).fill()},getExplosionOptions:function(){var a=Graphics.enemies.mantis,b=_.defaults({style:{fillStyle:this.starColor}},a.explosionOptions);return b}}),Balance.onUpdate(function(){var a="hsl(100, 100%, 50%)",b=Smart.Color.darken(a,30),c="black";_.merge(Graphics,{enemies:{slug:{radius:Balance.enemies.slug.radius+1,circleCircle:{outerRadius:Balance.enemies.slug.radius+1,outerStyle:{fillStyle:b},innerRadius:.7*Balance.enemies.slug.radius,innerStyle:{fillStyle:a,strokeStyle:c}},explosionOptions:{count:20,speed:300,style:{fillStyle:"hsl(100, 100%, 50%)"}}}}})}),EaselJSGraphics.SlugGraphics=Smart.Class(new EaselJSGraphics.BaseEnemyGraphics,{setup:function(){var a=Graphics.enemies.slug;this.visibleRadius=a.radius},drawStatic:function(a){var b=Graphics.enemies.slug;this.drawCircleCircle(a,b.circleCircle)},getExplosionOptions:function(){var a=Graphics.enemies.slug;return a.explosionOptions}}),EaselJSGraphics.BulletGraphics=Smart.Class(new createjs.Shape,{initialize:function(){this._setupGraphics()},_setupGraphics:function(){var a=this.graphics,b=Graphics.bullets;a.clear(),a.beginStyle(b.strokeStyle).drawCircle(0,0,Graphics.bullets.radius).endStroke()},getKickBack:function(){return Smart.Point.multiply(this.velocity,Balance.bullets.kickBack)}}),Balance.onUpdate(function(){Graphics.merge({explosionOptions:{count:200,speed:800,style:{fillColor:"hsl(60, 100%, 50%)"},radius:4,friction:.9,duration:3}})}),EaselJSGraphics.ExplosionGraphic=Smart.Class(new EaselJSGraphics.Drawing,{setup:function(a,b,c){this.explosionOptions=_.defaults(c,Graphics.explosionOptions);var d=function(){return 1-Math.random()-Math.random()};this.particles=new Array(c.count);for(var e=0,f=c.count;f>e;e++){var g=b.x+c.speed*d(),h=b.y+c.speed*d();this.particles[e]={x:a.x,y:a.y,velocity:{x:g,y:h}}}this.addAnimation().duration(c.duration).easeOut().fade(this,0).queueDispose(this)},drawEffects:function(a,b){var c=this.explosionOptions,d=this.particles,e=b.deltaSeconds,f=Balance.level.bounds;a.beginPath();for(var g=0,h=d.length;h>g;g++){var i=d[g];Smart.Physics.applyVelocity(i,i.velocity,e),Smart.Physics.applyFrictionToVelocity(i.velocity,c.friction,e),Smart.Physics.bounceOffWalls(i,c.radius,i.velocity,f,0),a.moveTo(i.x,i.y).circle(i.x,i.y,c.radius)}a.endPath(c.style)}}),EaselJSGraphics.SpecialEffects={drawElectricLineTo:function(a,b,c,d,e){for(var f={x:c.x-b.x,y:c.y-b.y},g=Smart.Interpolate.points(b,c),h=1;d>=h;h++){var i=g(h/d),j=Math.min(d-h,h)/d,k=j*e*(Math.random()-.5);f.y&&(i.x+=-f.y*k),f.x&&(i.y+=f.x*k),a.lineTo(i.x,i.y)}},drawElectricRectangle:function(a,b,c){var d=b.x||0,e=b.y||0,f=d+b.width,g=e+b.height,h=c.segmentsH,i=c.deviationH,j=c.segmentsV,k=c.deviationV;a.moveTo(d,e),this.drawElectricLineTo(a,{x:d,y:e},{x:f,y:e},h,i),this.drawElectricLineTo(a,{x:f,y:e},{x:f,y:g},j,k),this.drawElectricLineTo(a,{x:f,y:g},{x:d,y:g},h,i),this.drawElectricLineTo(a,{x:d,y:g},{x:d,y:e},j,k),a.closePath()}},Balance.onUpdate(function(){Graphics.merge({textStyles:{"default":{fontWeight:"normal",fontSize:"48px",fontFamily:'"Segoe UI"',color:"white",textAlign:"center",textBaseline:"middle"},powerupActive:{fontSize:"30px",color:"hsl(120, 100%, 80%)",textBaseline:"bottom"},powerupDeactive:{fontSize:"24px",color:"hsl(0, 100%, 80%)",textBaseline:"bottom"},hudText:{fontSize:"12px",color:"white",textBaseline:"middle",textAlign:"left"},menuButton:{fontSize:"40px",color:"white",textBaseline:"middle",textAlign:"center"}}})}),EaselJSGraphics.TextGraphic=Smart.Class(new createjs.Text,{setGfx:function(a){this.gfx=a,this.animation=a.addAnimation(new Smart.Animation),this.start("top")},setText:function(a,b){var c=Graphics.textStyles;this.text=a,"string"==typeof b&&(b=c[b]),b=b?_.defaults({},b,c.default):c.default,this.font=[b.fontWeight,b.fontSize,b.fontFamily].join(" "),this.color=b.color,this.textAlign=b.textAlign,this.textBaseline=b.textBaseline},start:function(a){var b=this.gfx.getHudPoint(a);return this.moveTo(b.x,b.y),this},flyIn:function(a,b){var c=this.gfx.getHudPoint(b||"middle"),d=this;return this.animation.duration(a).easeOut().fade(d,[0,1]).move(d,c).rotate(d,[30,0]).queue().update(0),this},flyOut:function(a,b){var c=this.gfx.getHudPoint(b||"bottom"),d=this;return this.animation.duration(a).easeIn().fade(d,[1,0]).move(d,c).rotate(d,[0,30]).queueDispose(d),this},queue:function(a){return this.animation.queue(a),this},delay:function(a){return this.animation.delay(a),this}}),EaselJSGraphics.BackgroundGraphicsBase=Smart.Class(new createjs.Shape,{BackgroundGraphicsBase_initialize:function(){var a=Balance.level.bounds;this._size={width:2*a.x+a.width,height:2*a.y+a.height},this._setupBackground(),this._setupStars(),this.cache(0,0,this._size.width,this._size.height)},_setupBackground:function(){var a=this.graphics,b=Graphics.background,c=this._size;a.clear(),a.beginFill(b.backgroundColor).drawRect(0,0,c.width,c.height)},_setupStars:function(){for(var a=this.graphics,b=Graphics.background,c=this._size,d=b.starColors,e=0,f=d.length;f>e;e++){var g=d[e%f];a.beginStroke(g);for(var h=Math.floor(b.starCount/f);h--;){var i=Math.floor(Math.random()*c.width),j=Math.floor(Math.random()*c.height);a.moveTo(i,j).lineTo(i+1,j+1)}}a.endStroke()}}),EaselJSGraphics.BackgroundGraphics=Smart.Class(new EaselJSGraphics.BackgroundGraphicsBase,{initialize:function(){this.initialized||(EaselJSGraphics.BackgroundGraphics.prototype.initialized=!0,EaselJSGraphics.BackgroundGraphics.prototype.BackgroundGraphicsBase_initialize())}}),EaselJSGraphics.BombCrystalGraphic=Smart.Class(new createjs.Shape,{initialize:function(){this._setupGraphics()},_setupGraphics:function(){var a=Graphics.bombCrystals;this.visibleRadius=a.radius,this.graphics.clear().beginStyle(a.style).drawPolyStar(0,0,a.radius,a.sides,a.pointSize,0).closePath().endStyle(a.style).beginStyle(a.styleInner).drawPolyStar(0,0,a.radiusInner,a.sides,a.pointSize,0).closePath().endStyle(a.styleInner),this.rotation=360*Math.random(),this.spinRate=a.spinRate},onTick:function(a){this.rotation+=this.spinRate*a.deltaSeconds},gatherBombCrystal:function(a,b){var c=this;return a.addAnimation((new Smart.Animation).duration(Graphics.bombCrystals.gatherDuration).savePosition().easeOut("quint").move(c,b).restorePosition().easeOut("quint").scale(c,[1,2,2.5,2,1,0]).queueDispose(c))}}),EaselJSGraphics.BombGraphic=Smart.Class(new createjs.Shape,{initialize:function(){this.location=this,this.radius=Balance.player.radius},_setupGraphics:function(){var a=Graphics.bombs;this.graphics.clear().beginStyle(a.style).drawCircle(0,0,this.radius).endStyle(a.style)},onTick:function(a){var b=Balance.bombs,c=Balance.level.bounds;this.radius+=b.speed*a.deltaSeconds,this.alpha=1-this.radius/c.totalWidth,this.alpha<=0&&this.dispose(),this._setupGraphics()},getKickBack:function(a){var b=Smart.Point.subtract(a.location,this.location);return Smart.Point.scaleVector(b,Balance.bombs.speed*Balance.bombs.kickBack)}}),EaselJSGraphics.CrystalGraphic=Smart.Class(new createjs.Shape,{initialize:function(){this._setupCrystalGraphic()},_setupCrystalGraphic:function(){var a=Graphics.crystals;this.visibleRadius=a.radius,this.graphics.clear().beginStyle(a.style).drawPolyStar(0,0,a.radius,a.sides,a.pointSize,0).endStyle(a.style),this.rotation=360*Math.random(),this.spinRate=a.spinRate},onTick:function(a){this.rotation+=this.spinRate*a.deltaSeconds},gatherCrystal:function(a,b){var c=this;a.addAnimation((new Smart.Animation).duration(Graphics.crystals.gatherDuration).savePosition().easeIn("quint").move(c,b).restorePosition().scale(c,[.9,.3]).restorePosition().easeOut("quint").tween(function(a){c.spinRate=a},[c.spinRate,Graphics.crystals.spinRateGathered]).queueDispose(c))}}),EaselJSGraphics.LevelGraphics=Smart.Class(new createjs.Shape,{gateStart:null,gateEnd:null,gateOpen:!1,initialize:function(){this.nextChange=0},setGateWidth:function(a){var b=Balance.level.bounds;this.gateStart={x:b.x+(b.width-a)/2,y:b.y},this.gateEnd={x:this.gateStart.x+a,y:b.y},this.gateOpen=!1},openGate:function(){this.gateOpen=!0},closeGate:function(){this.gateOpen=!1},onTick:function(a){if(this.nextChange<=a.time){var b=Graphics.level;this.nextChange=a.time+b.gateElectricityFrequency,this.graphics.clear(),this._drawWalls(),this._drawGate()}},_drawWalls:function(){var a=this.graphics,b=Graphics.level,c=Balance.level.bounds,d=Graphics.level.strokeStyle.strokeWidth-2,e=this.gateStart,f=this.gateEnd,g=Math.PI/2,h={top:3*g,right:0,bottom:g,left:Math.PI},i={left:c.x+b.cornerRadius-d/2,right:c.x+c.width-b.cornerRadius+d,top:c.y+b.cornerRadius-d/2,bottom:c.y+c.height-b.cornerRadius+d};a.beginStyle(b.strokeStyle).moveTo(f.x,f.y).arc(i.right,i.top,b.cornerRadius,h.top,h.right).arc(i.right,i.bottom,b.cornerRadius,h.right,h.bottom).arc(i.left,i.bottom,b.cornerRadius,h.bottom,h.left).arc(i.left,i.top,b.cornerRadius,h.left,h.top).lineTo(e.x,e.y).endStroke()},_drawGate:function(){if(!this.gateOpen){var a=this.graphics,b=Graphics.gate,c=this.gateStart,d=this.gateEnd;this._drawElectricLine(a,b,c,d)}},_drawElectricLine:function(a,b,c,d){var e=b.segments;a.beginStyle(b.strokeStyle).moveTo(c.x,c.y);for(var f={x:d.x-c.x,y:d.y-c.y},g=Smart.Interpolate.points(c,d),h=1;e>=h;h++){var i=g(h/e),j=Math.min(e-h,h)/e,k=j*b.deviation*(Math.random()-.5);f.y&&(i.x+=-f.y*k),f.x&&(i.y+=f.x*k),a.lineTo(i.x,i.y)
}a.endStroke()},levelCollision:function(a,b){var c=Balance.level.bounds,d=Smart.Physics.checkBounds(a,b,c);if(!d)return null;var e="top"===d.edge&&a.x>=this.gateStart.x&&a.x<=this.gateEnd.x;return e&&this.gateOpen&&(d.insideGate=!0,d.insideGateDistance=-d.distance,Smart.Point.distanceTest(a,this.gateStart,b)?d.touchingGate=this.gateStart:Smart.Point.distanceTest(a,this.gateEnd,b)&&(d.touchingGate=this.gateEnd)),d}}),EaselJSGraphics.PowerCrystalGraphic=Smart.Class(new createjs.Shape,{initialize:function(){this._setupGraphics()},_setupGraphics:function(){var a=Graphics.powerCrystals;this.graphics.clear().beginStyle(a.style).drawPolyStar(0,0,a.radius,a.sides,a.pointSize,0).endStyle(a.style).beginStyle(a.styleInner).drawPolyStar(0,0,a.radiusInner,a.sides,a.pointSize,0).endStyle(a.styleInner),this.rotation=360*Math.random(),this.spinRate=a.spinRate},onTick:function(a){this.rotation+=this.spinRate*a.deltaSeconds},gatherPowerCrystal:function(a,b){var c=this;return a.addAnimation((new Smart.Animation).duration(Graphics.powerCrystals.gatherDuration).savePosition().easeOut("quint").move(c,b).restorePosition().easeOut("quint").scale(c,[1,2,2.5,2,1,0]).queueDispose(c))},clearPowerCrystal:function(a){var b=this;return a.addAnimation((new Smart.Animation).duration(2).easeIn().scale(b,0).queueDispose(b))}}),EaselJSGraphics.HudGraphics={},Balance.onUpdate(function(){_.merge(Graphics,{hudGraphics:{backgroundStyle:{fillColor:"hsla(0, 100%, 100%, 0.1)"}}})}),EaselJSGraphics.HudGraphics.HudOverlay=Smart.Class(new createjs.Shape,{initialize:function(){this._setupGraphics()},_setupGraphics:function(){var a=Graphics.hudGraphics,b=Balance.level.bounds;this.graphics.clear().beginStyle(a.backgroundStyle).drawRect(0,0,b.visibleWidth,b.hudHeight).endStyle(a.backgroundStyle)}}),Balance.onUpdate(function(){Graphics.merge({hudGraphics:{button:{padding:5,cornerRadius:4,style:{strokeWidth:1,strokeColor:"hsla(0, 100%, 100%, 0.3)",fillColor:"hsla(0, 100%, 100%, 0.1)"}},pauseButton:{width:80,height:28},pauseIcon:{style:{fillColor:"hsla(0, 100%, 100%, 0.2)"},rectWidth:8,rectHeight:20,iconWidth:22,rectRadius:2},sandwichIcon:{style:{fillColor:"hsla(0, 100%, 100%, 0.2)"},rectWidth:20,rectHeight:4,iconHeight:15,rectRadius:2}}})}),EaselJSGraphics.HudGraphics.HudButton=Smart.Class(new createjs.Container,{Container_initialize:createjs.Container.prototype.initialize,HudButton_initialize:function(a,b,c){this.gfx=a,this.Container_initialize(),this.width=b,this.height=c,this._setupButtonBackground()},_setupButtonBackground:function(){var a=Graphics.hudGraphics.button,b=new createjs.Shape;b.graphics.clear().beginStyle(a.style).drawRoundRect(0,0,this.width,this.height,a.cornerRadius).endStyle(a.style),this.addChild(b)}}),EaselJSGraphics.HudGraphics.HudPauseButton=Smart.Class(new EaselJSGraphics.HudGraphics.HudButton,{initialize:function(a){var b=Graphics.hudGraphics.pauseButton;this.HudButton_initialize(a,b.width,b.height),this._setupGraphics()},_setupGraphics:function(){var a=Graphics.hudGraphics.pauseButton,b=this._createText();b.textAlign="right",b.moveTo(a.width/2,a.height/2),this.addChild(b);var c=this._createSandwichIcon(),d=(a.height-c.height)/2;c.moveTo(a.width-c.width-d,d),this.addChild(c)},_createText:function(){var a=(Graphics.hudGraphics.pauseButton,new EaselJSGraphics.TextGraphic);return a.setText("Pause","hudText"),this.addChild(a),a},_createPauseIcon:function(){var a=Graphics.hudGraphics.pauseIcon,b=new createjs.Shape;return b.graphics.beginStyle(a.style).drawRoundRect(0,0,a.rectWidth,a.rectHeight,a.rectRadius).drawRoundRect(a.iconWidth-a.rectWidth,0,a.rectWidth,a.rectHeight,a.rectRadius).endStyle(a.style),this.addChild(b),b},_createSandwichIcon:function(){var a=Graphics.hudGraphics.sandwichIcon,b=a.iconHeight-a.rectHeight,c=(a.iconHeight-a.rectHeight)/2,d=new createjs.Shape;return d.graphics.beginStyle(a.style).drawRoundRect(0,0,a.rectWidth,a.rectHeight,a.rectRadius).drawRoundRect(0,c,a.rectWidth,a.rectHeight,a.rectRadius).drawRoundRect(0,b,a.rectWidth,a.rectHeight,a.rectRadius).endStyle(a.style),d.width=a.rectWidth,d.height=a.iconHeight,this.addChild(d),d}}),EaselJSGraphics.MenuGraphics={},Balance.onUpdate(function(){Graphics.merge({menuButton:{width:300,height:60,borderRadius:6,buttonStyle:{lineWidth:3,strokeStyle:"hsla(60, 100%, 100%, 0.3)",fillStyle:"hsla(60, 100%, 100%, 0.2)"},buttonActiveStyle:{lineWidth:4,strokeStyle:"hsla(60, 100%, 100%, 0.7)",fillStyle:"hsla(60, 100%, 100%, 0.5)"},backgroundShape:{changeFrequency:1e3/30,segmentsH:20,deviationH:.05,segmentsV:5,deviationV:.5}}})}),EaselJSGraphics.MenuGraphics.MenuButton=Smart.Class(new createjs.Container,{Container_initialize:createjs.Container.prototype.initialize,initialize:function(a){this.Container_initialize(),this.gfx=a,this.background=new EaselJSGraphics.MenuGraphics.MenuButtonBackground,this.addChild(this.background);var b=Graphics.menuButton;this.visibleWidth=b.width,this.visibleHeight=b.height,this.regX=b.width/2,this.regY=b.height/2},setText:function(a){var b=this.gfx.addText(a,"menuButton");this.addChild(b),b.moveTo(this.visibleWidth/2,this.visibleHeight/2)},setActive:function(a){this.isActive!==a&&(this.isActive=a,this.background.isActive=a)}}),EaselJSGraphics.MenuGraphics.MenuButtonBackground=Smart.Class(new EaselJSGraphics.Drawing,{isActive:!1,drawEffects:function(a,b){if(!this.shape||this.nextChange<=b.time){var c=Graphics.menuButton,d=this.shape=new Smart.DrawingQueue;this.nextChange=b.time+c.backgroundShape.changeFrequency,d.beginPath(),EaselJSGraphics.SpecialEffects.drawElectricRectangle(d,c,c.backgroundShape),d.endPath(this.isActive?c.buttonActiveStyle:c.buttonStyle)}a.drawingQueue(this.shape)}});var XQuestInput={};!function(){var a={up:XQuestGame.MenuSceneInputs.menuUp,down:XQuestGame.MenuSceneInputs.menuDown,left:XQuestGame.MenuSceneInputs.menuLeft,right:XQuestGame.MenuSceneInputs.menuRight,enter:XQuestGame.MenuSceneInputs.menuInvoke,escape:XQuestGame.MenuSceneInputs.menuBack,backspace:XQuestGame.MenuSceneInputs.menuBack};XQuestInput.MenuInputKeyboard=Smart.Class({initialize:function(b){this.element=b||document,this.actionsQueue=[],this._setupKeyMap(),this.keyMapper.setKeyMap(a)},_setupKeyMap:function(){this.keyMapper=new XQuestInput.KeyMapper(this.element,this._onActionDown.bind(this))},_onActionDown:function(a){this.actionsQueue.push(a)},onInput:function(a,b){for(var c=0,d=this.actionsQueue.length;d>c;c++){var e=this.actionsQueue[c];b[e]=!0}this.actionsQueue.length=0}})}(),function(){function a(a){a.preventDefault()}var b={keyboardSensitivity:5},c={accelerateUp:"accelerateUp",accelerateDown:"accelerateDown",accelerateLeft:"accelerateLeft",accelerateRight:"accelerateRight",primaryWeapon:"primaryWeapon",secondaryWeapon:"secondaryWeapon",pauseGame:"pauseGame"},d={gatherClosestCrystal:"gatherClosestCrystal",spawnEnemy:"spawnEnemy",killPlayer:"killPlayer",toggleFPS:"toggleFPS",toggleDebugStats:"toggleDebugStats",activateInvincible:"activateInvincible",activateRapidFire:"activateRapidFire",activateTripleShot:"activateTripleShot",activateAutoAim:"activateAutoAim",addBomb:"addBomb",spawnPowerCrystal:"spawnPowerCrystal"},e={escape:c.pauseGame,contextMenu:c.pauseGame,up:c.accelerateUp,down:c.accelerateDown,left:c.accelerateLeft,right:c.accelerateRight,space:c.primaryWeapon,enter:c.secondaryWeapon,numpad8:c.accelerateUp,numpad2:c.accelerateDown,numpad4:c.accelerateLeft,numpad6:c.accelerateRight,numpadadd:c.primaryWeapon,numpadenter:c.secondaryWeapon,c:d.gatherClosestCrystal,s:d.spawnEnemy,d:d.killPlayer,p:d.toggleFPS,1:d.activateInvincible,2:d.activateRapidFire,3:d.activateTripleShot,4:d.activateAutoAim,5:d.addBomb,0:d.spawnPowerCrystal};XQuestInput.PlayerInputKeyboard=Smart.Class({initialize:function(a,b){this.game=a,b||(b=document),this.keyMapper=new XQuestInput.KeyMapper(b,this._onActionDown.bind(this)),this.keyMapper.disableContextMenu(),this.setKeyMap(e)},setKeyMap:function(a){this.keyMapper.setKeyMap(a)},_onActionDown:function(a){switch(a){case c.pauseGame:this.game.pauseGame();break;case d.gatherClosestCrystal:this.game.debug().gatherClosestCrystal();break;case d.spawnEnemy:this.game.debug().spawnEnemy();break;case d.spawnPowerCrystal:this.game.debug().spawnPowerCrystal();break;case d.killPlayer:this.game.debug().killPlayer();break;case d.toggleFPS:this.game.debug().toggleFPS();break;case d.toggleDebugStats:this.game.debug().toggleDebugStats();break;case d.activateInvincible:this.game.debug().activatePowerup("invincible");break;case d.activateRapidFire:this.game.debug().activatePowerup("rapidFire");break;case d.activateTripleShot:this.game.debug().activatePowerup("tripleShot");break;case d.activateAutoAim:this.game.debug().activatePowerup("autoAim");break;case d.addBomb:this.game.debug().addBomb()}},onInput:function(a,d){var e=b.keyboardSensitivity,f=this.keyMapper.getDownActions(),g=4;f[c.primaryWeapon]?d.primaryWeapon=!0:g--,f[c.secondaryWeapon]?d.secondaryWeapon=!0:g--,f[c.accelerateLeft]?d.accelerationX+=-e:f[c.accelerateRight]?d.accelerationX+=e:g--,f[c.accelerateUp]?d.accelerationY+=-e:f[c.accelerateDown]?d.accelerationY+=e:g--,g>=1&&(d.engaged=!0)}}),XQuestInput.KeyMapper=Smart.Class({element:null,onActionDown:null,codes:{8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"escape",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",93:"contextMenu",96:"numpad0",97:"numpad1",98:"numpad2",99:"numpad3",100:"numpad4",101:"numpad5",102:"numpad6",103:"numpad7",104:"numpad8",105:"numpad9",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock"},keyMap:null,downKeys:null,downActions:null,initialize:function(a,b){this.element=a,this.onActionDown=b,this.codes=_.clone(this.codes),this.downKeys=[],this.downActions={},this.element.addEventListener("keydown",this._onKeydown.bind(this)),this.element.addEventListener("keyup",this._onKeyup.bind(this))},_onKeydown:function(a){var b=this._getKeyName(a),c=this.keyMap[b];if(c){a.preventDefault();var d=this.downKeys.indexOf(b),e=-1!==d;if(!e){this.downKeys.push(b);var f=(this.downActions[c]||0)+1;this.downActions[c]=f,1===f&&this.onActionDown(c)}}},_onKeyup:function(a){var b=this._getKeyName(a),c=this.keyMap[b];if(c){var d=this.downKeys.indexOf(b),e=-1!==d;if(e){this.downKeys.splice(d,1),a.preventDefault();var f=(this.downActions[c]||1)-1;this.downActions[c]=f}}},_getKeyName:function(a){var b="";a.ctrlKey&&(b+="ctrl+"),a.altKey&&(b+="alt+"),a.shiftKey&&(b+="shift+");var c=this.codes[a.keyCode]||a.keyIdentifier&&-1===a.keyIdentifier.indexOf("U+")&&a.keyIdentifier.toLowerCase()||a.key&&-1===a.key.indexOf("U+")&&a.key.toLowerCase()||String.fromCharCode(a.keyCode).toLowerCase()||"unknown";return b+c},getDownActions:function(){return this.downActions},setKeyMap:function(a){this.keyMap=a},disableContextMenu:function(b){void 0===b&&(b=!0),b?window.addEventListener("contextmenu",a):window.removeEventListener("contextmenu",a)}})}(),function(){function a(a,b){for(var c in b)b.hasOwnProperty(c)&&a.addEventListener(c,b[c])}function b(a,b){for(;b;){if(b===a)return!0;b=b.parentNode}return!1}function c(a){return{width:a.clientWidth,height:a.clientHeight}}function d(a){return{x:a.clientX,y:a.clientY}}function e(a){switch(a.which||a.button){case 1:return"left";case 2:return"middle";case 3:return"right";case 4:return"xbutton1";case 5:return"xbutton2";default:return"none"}}var f={mouseSensitivity:10,sensitivityScale:100,mouseBiasSensitivity:2,maxMouseMove:40},g="primaryWeapon",h="secondaryWeapon",i={left:g,right:h};XQuestInput.PlayerInputMouse=Smart.Class({element:null,elementSize:null,mouseState:null,previousMousePosition:null,initialize:function(b,c){this.game=b,this.element=c,this.mouseMap=i,a(this.element,{mouseover:this._onMouseOver.bind(this),mouseout:this._onMouseOut.bind(this),mousedown:this._onMouseDown.bind(this),mouseup:this._onMouseUp.bind(this),mousemove:this._onMouseMove.bind(this)}),a(window,{resize:this._onWindowResize.bind(this)}),this._onWindowResize(),this.game.onGamePaused(this._onGamePaused.bind(this)),this._onGamePaused(!1),this._resetMouseState()},_resetMouseState:function(){this.mouseState={engaged:!0,accelerationX:0,accelerationY:0}},_onWindowResize:function(){this.elementSize=c(this.element),this.previousMousePosition=null},_onGamePaused:function(a){this.element.style.cursor=a?null:"none",this.previousMousePosition=null,this._resetMouseState()},_onMouseOver:function(a){var c=b(this.element,a.target);c&&(this.mouseState.engaged=!0)},_onMouseOut:function(a){var c=b(this.element,a.relatedTarget);c||(this.mouseState.engaged=!1,this.game.pauseGame(!0))},_onMouseDown:function(a){var b=e(a),c=this.mouseMap[b];c&&(this.mouseState[c]=!0,a.preventDefault())},_onMouseUp:function(a){var b=e(a),c=this.mouseMap[b];c&&(this.mouseState[c]=!1)},_onMouseMove:function(a){var b=d(a),c=this.previousMousePosition;if(this.previousMousePosition=b,c){var e={x:Math.min(b.x-c.x,f.maxMouseMove),y:Math.min(b.y-c.y,f.maxMouseMove)},g=this._adjustForSensitivity(e,b);this.mouseState.accelerationX+=g.x,this.mouseState.accelerationY+=g.y}},_adjustForSensitivity:function(a,b){var c=this.elementSize,d=f.mouseSensitivity*f.sensitivityScale,e=f.mouseBiasSensitivity,g=a.x/c.width,h=a.y/c.height,i=2*(b.x/c.width)-1,j=2*(b.y/c.height)-1,k=this._getBias(i,a.x,e),l=this._getBias(j,a.y,e),m={x:g*d*k,y:h*d*l};return m},_getBias:function(a,b,c){var d=0>a&&0>b||a>0&&b>0;return a=Math.abs(a),d?1+a*(c-1):1-a+a/c},onInput:function(a,b){var c=this.mouseState;c.primaryWeapon&&(b.primaryWeapon=!0),c.secondaryWeapon&&(b.secondaryWeapon=!0),c.accelerationX&&(b.accelerationX+=c.accelerationX),c.accelerationY&&(b.accelerationY+=c.accelerationY),c.engaged&&(b.engaged=!0),c.accelerationX=0,c.accelerationY=0}})}(),function(){function a(a,b){for(var c in b)b.hasOwnProperty(c)&&a.addEventListener(c,b[c])}function b(a){return{width:a.clientWidth,height:a.clientHeight}}function c(a){return{x:a.clientX,y:a.clientY}}var d={touchSensitivity:2,inactiveTouchTimeout:4};XQuestInput.PlayerInputTouch=Smart.Class({element:null,elementSize:null,touches:null,touchState:null,initialize:function(b,c){this.game=b,this.element=c,this.touchState={},a(this.element,{touchstart:this._onTouchStart.bind(this),touchend:this._onTouchEnd.bind(this),touchleave:this._onTouchEnd.bind(this),touchcancel:this._onTouchEnd.bind(this),touchmove:this._onTouchMove.bind(this)}),a(window,{resize:this._onWindowResize.bind(this)}),this._onWindowResize()},_onWindowResize:function(){this.elementSize=b(this.element)},_onTouchStart:function(a){a.preventDefault();for(var b=a.changedTouches,d=0,e=b.length;e>d;d++){var f=b[d];if(this.touchState.engaged)this.touchState.primaryWeapon?this.touchState.secondaryWeapon||(this.touchState.secondaryWeapon={identifier:f.identifier}):this.touchState.primaryWeapon={identifier:f.identifier};else{this.touchState.engaged={identifier:f.identifier};var g=c(f);this._updateTouchPosition(g)}}},_onTouchEnd:function(a){a.preventDefault();for(var b=a.changedTouches,c=0,d=b.length;d>c;c++){var e=b[c];this.touchState.engaged&&this.touchState.engaged.identifier===e.identifier?this.touchState.engaged=!1:this.touchState.primaryWeapon&&this.touchState.primaryWeapon.identifier===e.identifier?this.touchState.primaryWeapon=!1:this.touchState.secondaryWeapon&&this.touchState.secondaryWeapon.identifier===e.identifier&&(this.touchState.secondaryWeapon=!1)}},_onTouchMove:function(a){a.preventDefault();for(var b=a.changedTouches,d=0,e=b.length;e>d;d++){var f=b[d];if(this.touchState.engaged&&this.touchState.engaged.identifier===f.identifier){var g=c(f),h=this._updateTouchPosition(g);if(!h)continue;var i=this._adjustForSensitivity(h,g,this.elementSize);this.touchState.accelerationX+=i.x,this.touchState.accelerationY+=i.y}}},_updateTouchPosition:function(a){var b=null;return this.previousTouchPosition&&(b={x:a.x-this.previousTouchPosition.x,y:a.y-this.previousTouchPosition.y}),this.previousTouchPosition=a,b},_adjustForSensitivity:function(a){var b=d.touchSensitivity,c={x:a.x*b,y:a.y*b};return c},onInput:function(a,b){var c=this.touchState;c.primaryWeapon&&(b.primaryWeapon=!0),c.secondaryWeapon&&(b.secondaryWeapon=!0),c.accelerationX&&(b.accelerationX+=c.accelerationX),c.accelerationY&&(b.accelerationY+=c.accelerationY),c.engaged&&(b.engaged=!0),c.accelerationX=0,c.accelerationY=0}})}(),XQuestGame.XQuestHost=Smart.Class(new Smart.Disposable,{initialize:function(a){this.scenes=[],Balance.setGameMode("arcade"),this._setupCanvas(a),this._setupTimer(),this._setupBackgroundGraphics(),this._setupMenuScene(),this._loadStartMenu()},_setupCanvas:function(a){if(!a){var b=Balance.level.bounds;a=this._createFullScreenCanvas(b.visibleWidth,b.visibleHeight)}this.canvas=a},_createFullScreenCanvas:function(a,b){var c=document.createElement("div");c.innerHTML='<section tabindex="1" style="position: fixed; top: 0; left: 0; bottom: 0; right: 0; background-color: hsl(0, 0%, 5%); outline: none; "><canvas style="position: absolute; top: 0; left: 0; bottom: 0; right: 0; margin: auto;"></canvas></section>';var d=c.childNodes[0],e=d.childNodes[0];return e.setAttribute("width",a),e.setAttribute("height",b),document.body.appendChild(d),document.body.style.overflow="hidden",this.onDispose(function(){document.body.removeChild(d),document.body.style.overflow=null}),d.focus(),this._contain(d,e,a,b),e},_contain:function(a,b,c,d){function e(){var e=a.offsetWidth,f=a.offsetHeight,g=c/d>e/f;g?(b.style.width="100%",b.style.height="auto"):(b.style.width="auto",b.style.height="100%")}window.addEventListener("resize",e),e()},_setupTimer:function(){this.timer=new EaselJSTimer,this.timer.addTickHandler(this._tickHandler.bind(this)),this.onDispose(function(){this.timer.dispose()}.bind(this))},_tickHandler:function(a){this.timeAdjust&&(a.deltaSeconds*=this.timeAdjust),this.backgroundGraphics.onDraw(a),this.scenes.forEach(function(b){b.updateScene(a)})},_setupBackgroundGraphics:function(){this.backgroundGraphics=new EaselJSGraphics(this.canvas)},_setupMenuScene:function(){var a=this,b=new EaselJSGraphics(this.canvas);b.showBackgroundStars(!0),this.menuScene=new XQuestGame.MenuScene(b,a),this.menuScene.addSceneItem(new XQuestInput.MenuInputKeyboard),this.scenes.push(this.menuScene)},_loadStartMenu:function(){var a=new XQuestGame.CommonMenus.StartMenu(this.menuScene);this.menuScene.addMenu(a),a.onStartGame(this._startArcadeGame.bind(this))},_startArcadeGame:function(){var a=new EaselJSGraphics(this.canvas);a.showBackgroundStars(!0),this.game=new XQuestGame.ArcadeGame(a),this.game.addSceneItem(new XQuestInput.PlayerInputKeyboard(this.game,null)),this.game.addSceneItem(new XQuestInput.PlayerInputMouse(this.game,this.canvas.parentNode)),this.game.addSceneItem(new XQuestInput.PlayerInputTouch(this.game,this.canvas.parentNode)),this.game.onGamePaused(this._showPauseMenu.bind(this)),this.game.startArcadeGame(),this.scenes=[this.game,this.menuScene],this.menuScene.gfx.showBackgroundStars(!1)},X_showPauseMenu:function(a){if(a){var b=new EaselJSGraphics(this.canvas);this.pauseMenu=new XQuestGame.PauseMenu(b),this.scenes.push(this.pauseMenu),this.pauseMenu.addSceneItem(new XQuestInput.MenuInputKeyboard),this.pauseMenu.onMenuExit(function(){this.scenes.pop(),this.game.pauseGame(!1)}.bind(this))}},_showPauseMenu:function(a){if(a){var b=new XQuestGame.CommonMenus.PauseMenu(this.menuScene);this.menuScene.addMenu(b),b.onResumeGame(function(){this.game.pauseGame(!1)}.bind(this))}}});